/*! For license information please see srr_visualizer_bin.js.LICENSE.txt */
(()=>{var t={721:(t,e,n)=>{"use strict";n.d(e,{DN:()=>h});var i=n(683);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(a=i.key,o=void 0,o=function(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"),"symbol"===r(o)?o:String(o)),i)}var a,o}var o=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=n,this.cast=i||n,this.attribute=e}var e,n,i;return e=t,(n=[{key:"cast_value",value:function(t){switch(this.cast){case"string":case"function":return t;case"number":return Number(t);case"boolean":return Boolean("true"===t.toLowerCase());case"object":return JSON.parse(t);case"undefined":return;case"bigint":return BigInt(t);case"symbol":return Symbol(t);case"null":return null}}}])&&a(e.prototype,n),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function s(t){var e=document.querySelectorAll(".config"),n=function(t){var e={};return Object.keys(t).forEach((function(n){var i=t[n];e[i.attribute]={type:i,name:n}})),e}(t),r=["class","id"],a={};return e.forEach((function(t){Array.from(t.attributes).forEach((function(e){r.includes(e.name)||n.hasOwnProperty(e.name)&&(a[n[e.name].name]=n[e.name].type.cast_value(function(t,e){var n=t.getAttribute(e);return n||((0,i.Xj)("error","Configuration Error","No ".concat(e," found, please reload the page")),setTimeout((function(){window.location.reload()}),3e3)),n}(t,e.name)))}))})),Object.keys(t).forEach((function(t){a.hasOwnProperty(t)||(0,i.Xj)("error","Configuration Error","No ".concat(t," found, please reload the page"))})),a}function h(){return s({csrf_token:new o("data-csrf-token","string"),recent_verification:new o("data-recent-verification","string"),resend_verification:new o("data-resend-verification","string")})}},888:(t,e,n)=>{"use strict";n.d(e,{AO:()=>d});var i=n(721);function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(){h=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var a=e&&e.prototype instanceof p?e:p,o=Object.create(a.prototype),s=new T(r||[]);return i(o,"_invoke",{value:S(t,n,s)}),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var f={};function p(){}function g(){}function v(){}var y={};c(y,o,(function(){return this}));var m=Object.getPrototypeOf,b=m&&m(m(A([])));b&&b!==e&&n.call(b,o)&&(y=b);var x=v.prototype=p.prototype=Object.create(y);function _(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function a(i,o,s,h){var l=u(t[i],t,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==r(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){a("next",t,s,h)}),(function(t){a("throw",t,s,h)})):e.resolve(d).then((function(t){c.value=t,s(c)}),(function(t){return a("throw",t,s,h)}))}h(l.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){a(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function S(t,e,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return L()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var h=u(t,e,n);if("normal"===h.type){if(i=n.done?"completed":"suspendedYield",h.arg===f)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i="completed",n.method="throw",n.arg=h.arg)}}}function k(t,e){var n=e.method,i=t.iterator[n];if(void 0===i)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var r=u(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function A(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:L}}function L(){return{value:void 0,done:!0}}return g.prototype=v,i(x,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:g,configurable:!0}),g.displayName=c(v,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},_(w.prototype),c(w.prototype,s,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new w(d(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},_(x),c(x,l,"Generator"),c(x,o,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=A,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return o.type="throw",o.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(s&&h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;P(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function l(t,e,n,i,r,a,o){try{var s=t[a](o),h=s.value}catch(t){return void n(t)}s.done?e(h):Promise.resolve(h).then(i,r)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){l(a,i,r,o,s,"next",t)}function s(t){l(a,i,r,o,s,"throw",t)}o(void 0)}))}}function d(t,e){return u.apply(this,arguments)}function u(){return u=c(h().mark((function t(e,n){var r,a,s,l,c=arguments;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:{},t.next=4,fetch(n,{method:e,headers:o({"Content-Type":"application/json","X-CSRFToken":(0,i.DN)().csrf_token},a),body:"GET"===e?void 0:JSON.stringify(r)});case 4:return s=t.sent,t.prev=5,t.next=8,s.json();case 8:return l=t.sent,t.abrupt("return",{data:l.data,code:s.status,message:l.message});case 12:return t.prev=12,t.t0=t.catch(5),t.abrupt("return",{code:s.status,message:"An unknown error has occured, "+t.t0.message});case 15:case"end":return t.stop()}}),t,null,[[5,12]])}))),u.apply(this,arguments)}},683:(t,e,n)=>{"use strict";function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",h=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var r=e&&e.prototype instanceof p?e:p,o=Object.create(r.prototype),s=new T(i||[]);return a(o,"_invoke",{value:S(t,n,s)}),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var f={};function p(){}function g(){}function v(){}var y={};c(y,s,(function(){return this}));var m=Object.getPrototypeOf,b=m&&m(m(A([])));b&&b!==e&&n.call(b,s)&&(y=b);var x=v.prototype=p.prototype=Object.create(y);function _(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(a,o,s,h){var l=u(t[a],t,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==i(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,s,h)}),(function(t){r("throw",t,s,h)})):e.resolve(d).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,h)}))}h(l.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function S(t,e,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return L()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=k(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var h=u(t,e,n);if("normal"===h.type){if(i=n.done?"completed":"suspendedYield",h.arg===f)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i="completed",n.method="throw",n.arg=h.arg)}}}function k(t,e){var n=e.method,i=t.iterator[n];if(void 0===i)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var r=u(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function A(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:L}}function L(){return{value:void 0,done:!0}}return g.prototype=v,a(x,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:g,configurable:!0}),g.displayName=c(v,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},_(w.prototype),c(w.prototype,h,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new w(d(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},_(x),c(x,l,"Generator"),c(x,s,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=A,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return o.type="throw",o.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(s&&h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;P(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function a(t,e,n,i,r,a,o){try{var s=t[a](o),h=s.value}catch(t){return void n(t)}s.done?e(h):Promise.resolve(h).then(i,r)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(t){a(o,i,r,s,h,"next",t)}function h(t){a(o,i,r,s,h,"throw",t)}s(void 0)}))}}function s(t){return new Promise((function(e){return setTimeout(e,t)}))}function h(t,e,n){var i=function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a='\n        \x3c!-- Continue --\x3e\n        <button type="submit" class="btn yes btn-'.concat(i,' btn-lg w-75">\n            Continue\n        </button>\n\n        \x3c!-- Continue --\x3e\n        <button type="submit" class="btn no btn-danger btn-lg w-25 error">\n            Cancel\n        </button>\n    ');return'\n        <div\n            style="z-index: 9999; position: fixed; top: 0; left: 0; width: 100vw;\n                height: 100vh; background-color: rgba(0, 0, 0, 0.5);">\n\n            \x3c!-- Modal --\x3e\n            <div class="modal d-flex justify-content-center align-items-center"\n                style="z-index: 9999; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; \n                background-color: rgba(0, 0, 0, 0.5);">\n\n                \x3c!-- Modal content --\x3e\n                <div \n                    class="modal-content bg-dark text-light rounded\n                    p-xxl-5 p-xl-5 p-lg-5 p-md-3 p-sm-3 p-2"\n                    style="width: 500px;"\n                >\n\n                    \x3c!-- Header --\x3e\n                    <div class="mb-2 justify-content-start header">\n                        \x3c!-- Header --\x3e\n                        <h1 class="fw-bold ">'.concat(t,'</h1>\n\n                        \x3c!-- Descriptiopn --\x3e\n                        <p class="text-muted">').concat(e,'</p>\n                    </div>\n                    \n                    \x3c!-- Custom --\x3e\n                    <div class="d-flex justify-content-lg-start justify-content-center flex-column custom">\n                        ').concat(r||"",'\n                    </div>\n                    \n                    \x3c!-- Buttons --\x3e\n                    <div class="justify-content-lg-start justify-content-center d-flex buttons w-100 pop-up-buttons">\n                        ').concat(n?a:"","\n                    </div>\n                </div>\n            </div>\n        </div>\n    ")}(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Are you sure?",n,!0,"danger"),a=document.createElement("div");a.innerHTML=i;var s=a.querySelector(".yes"),h=a.querySelector(".no");s.addEventListener("click",o(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t(),a.remove();case 2:case"end":return e.stop()}}),e)})))),h.addEventListener("click",o(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(),a.remove();case 2:case"end":return t.stop()}}),t)})))),document.body.appendChild(a)}n.d(e,{Xj:()=>l,_v:()=>s,y6:()=>h});var l=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},a=document.getElementById("toasts");if(!a)throw new Error("No toasts element found");var o="\n        <div \n            toast-type='".concat(t,"'\n            class='\n                toast\n                d-flex\n                align-items-center\n                justify-content-start\n            '\n        >\n            \x3c!-- Icon, pinned to the top --\x3e\n            <div class='toast-icon col-1'>\n                <i class=\"fa-regular fa-circle-check\" icon='success'></i>\n                <i class=\"fa-solid fa-triangle-exclamation\" icon='warning'></i>\n                <i class=\"fa-solid fa-exclamation\" icon='error'></i>\n                <i class=\"fa-solid fa-circle-info\" icon='info'></i>\n            </div>\n\n            \x3c!-- Content --\x3e\n            <div class='toast-content col-9'>\n                <p class='toast-content-header m-0'>").concat(e,"</p>\n                <p class='toast-content-text m-0'>").concat(n,"</p>\n                <p class='toast-content-time m-0'>Now</p>\n            </div>\n\n            \x3c!-- Close button --\x3e\n            <div class='toast-close col-2'>\n                <i class=\"fa-solid fa-times\"></i>\n            </div>\n        </div>\n    "),s=document.createElement("div");s.innerHTML=o;var h=s.querySelector(".toast-close"),l=s.querySelector(".toast-content-time"),d=new Date,u=setInterval((function(){var t,e,n;l.innerText=(t=d,e=(Date.now()-t.getTime())/1e3,((n=[{threshold:0,label:"Just now"},{threshold:6e4,label:"A few seconds ago"},{threshold:36e5,label:"A few minutes ago"},{threshold:864e5,label:"A few hours ago"},{threshold:6048e5,label:"A few days ago"},{threshold:1/0,label:"A while ago"}]).find((function(t){var n=t.threshold;return e<=n}))||n[n.length-1]).label)}),1e3);h.addEventListener("click",(function(){c(s,a),clearInterval(u),r()})),setTimeout((function(){c(s,a),clearInterval(u),r()}),i),a.appendChild(s)};function c(t,e){return d.apply(this,arguments)}function d(){return(d=o(r().mark((function t(e,n){var i,a,o,h,l,c,d,u,f,p,g;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=1e3,e.classList.add("toast-out"),a=e.children[0],o=getComputedStyle(a),h=o.getPropertyValue("margin-bottom"),l=e.offsetHeight+parseInt(h),c=n.children,d=Array.from(c).indexOf(e),e.style.animation&&(e.style.animation=""),u=0;case 8:if(!(u<c.length)){t.next=19;break}if(f=c[u],!(u<=d)){t.next=12;break}return t.abrupt("continue",16);case 12:if(!f.classList.contains("toast-out")){t.next=14;break}return t.abrupt("continue",16);case 14:f.style.setProperty("--toast-adjust-height","-".concat(l,"px")),f.style.animation="toast_adjust ".concat(i,"ms ease-in-out");case 16:u++,t.next=8;break;case 19:return t.next=21,s(i);case 21:e.classList.remove("toast-out"),p=0;case 23:if(!(p<c.length)){t.next=31;break}if(g=c[p],!(p<=d)){t.next=27;break}return t.abrupt("continue",28);case 27:g.style.animation="";case 28:p++,t.next=23;break;case 31:e.remove();case 32:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},78:function(t){t.exports=function(){"use strict";function t(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function e(t){var e=t.getBoundingClientRect();return{top:e.top+(document.documentElement.scrollTop||document.body.scrollTop),left:e.left+(document.documentElement.scrollLeft||document.body.scrollLeft)}}function n(t){return null===t.offsetParent}function i(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function r(t){var e=window.getComputedStyle(t),n=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight);return t.clientWidth-n}function a(t,e,n){var i=document.createEvent("HTMLEvents");for(var r in i.initEvent(e,!0,!0),n)i[r]=n[r];return t.dispatchEvent(i)}function o(t){return t.titleHeight+t.margins.top+t.paddings.top}function s(t){return t.margins.left+t.paddings.left}function h(t){return t.margins.top+t.margins.bottom+t.paddings.top+t.paddings.bottom+t.titleHeight+t.legendHeight}function l(t){return t.margins.left+t.margins.right+t.paddings.left+t.paddings.right}function c(t){return parseFloat(t.toFixed(2))}function d(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n||(n=i?t[0]:t[t.length-1]);var r=new Array(Math.abs(e)).fill(n);return i?r.concat(t):t.concat(r)}function u(t,e){return(t+"").length*e}function f(t,e){return{x:Math.sin(t*Zt)*e,y:Math.cos(t*Zt)*e}}function p(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(Number.isNaN(t)||void 0===t||!Number.isFinite(t)||e&&t<0)}function g(t){return Number(Math.round(t+"e4")+"e-4")}function v(t){var e=void 0,n=void 0,i=void 0;if(t instanceof Date)return new Date(t.getTime());if("object"!==(void 0===t?"undefined":Ft(t))||null===t)return t;for(i in e=Array.isArray(t)?[]:{},t)n=t[i],e[i]=v(n);return e}function y(t,e){var n=void 0,i=void 0;return t<=e?(n=e-t,i=t):(n=t-e,i=e),[n,i]}function m(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-t.length;return n>0?t=d(t,n):e=d(e,n),[t,e]}function b(t,e){if(t)return t.length>e?t.slice(0,e-3)+"...":t}function x(t){var e=void 0;if("number"==typeof t)e=t;else if("string"==typeof t&&(e=Number(t),Number.isNaN(e)))return t;var n=Math.floor(Math.log10(Math.abs(e)));if(n<=2)return e;var i=Math.floor(n/3),r=Math.pow(10,n-3*i)*+(e/Math.pow(10,n)).toFixed(1);return Math.round(100*r)/100+" "+["","K","M","B","T"][i]}function _(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i],e[i]]);var r=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return{length:Math.sqrt(Math.pow(n,2)+Math.pow(i,2)),angle:Math.atan2(i,n)}},a=function(t,e,n,i){var a=r(e||t,n||t),o=a.angle+(i?Math.PI:0),s=.2*a.length;return[t[0]+Math.cos(o)*s,t[1]+Math.sin(o)*s]};return function(t,e){return t.reduce((function(t,n,i,r){return 0===i?n[0]+","+n[1]:t+" "+e(n,i,r)}),"")}(n,(function(t,e,n){var i=a(n[e-1],n[e-2],t),r=a(t,n[e-1],n[e+1],!0);return"C "+i[0]+","+i[1]+" "+r[0]+","+r[1]+" "+t[0]+","+t[1]}))}function w(t){return t>255?255:t<0?0:t}function S(t,e){var n=ne(t),i=!1;"#"==n[0]&&(n=n.slice(1),i=!0);var r=parseInt(n,16),a=w((r>>16)+e),o=w((r>>8&255)+e);return(i?"#":"")+(w((255&r)+e)|o<<8|a<<16).toString(16)}function k(t){var e=/(^\s*)(rgb|hsl)(a?)[(]\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*,\s*([\d.]+\s*%?)\s*(?:,\s*([\d.]+)\s*)?[)]$/i;return/(^\s*)(#)((?:[A-Fa-f0-9]{3}){1,2})$/i.test(t)||e.test(t)}function C(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function P(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var i in e){var r=e[i];if("inside"===i)C(r).appendChild(n);else if("around"===i){var a=C(r);a.parentNode.insertBefore(n,a),n.appendChild(a)}else"styles"===i?"object"===(void 0===r?"undefined":Ft(r))&&Object.keys(r).map((function(t){n.style[t]=r[t]})):("className"===i&&(i="class"),"innerHTML"===i?n.textContent=r:n.setAttribute(i,r))}return n}function T(t,e){return P("linearGradient",{inside:t,id:e,x1:0,x2:0,y1:0,y2:1})}function A(t,e,n,i){return P("stop",{inside:t,style:"stop-color: "+n,offset:e,"stop-opacity":i})}function L(t,e,n,i){return P("svg",{className:e,inside:t,width:n,height:i})}function E(t){return P("defs",{inside:t})}function O(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n={className:t,transform:arguments.length>1&&void 0!==arguments[1]?arguments[1]:""};return e&&(n.inside=e),P("g",n)}function M(t){return P("path",{className:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",d:t,styles:{stroke:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",fill:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none","stroke-width":arguments.length>4&&void 0!==arguments[4]?arguments[4]:2}})}function D(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=n.x+t.x,s=n.y+t.y,h=n.x+e.x,l=n.y+e.y;return"M"+n.x+" "+n.y+"\n\t\tL"+o+" "+s+"\n\t\tA "+i+" "+i+" 0 "+a+" "+(r?1:0)+"\n\t\t"+h+" "+l+" z"}function G(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=n.x+t.x,s=n.y+t.y,h=n.x+e.x,l=2*n.y,c=n.y+e.y;return"M"+n.x+" "+n.y+"\n\t\tL"+o+" "+s+"\n\t\tA "+i+" "+i+" 0 "+a+" "+(r?1:0)+"\n\t\t"+h+" "+l+" z\n\t\tL"+o+" "+l+"\n\t\tA "+i+" "+i+" 0 "+a+" "+(r?1:0)+"\n\t\t"+h+" "+c+" z"}function R(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return"M"+(n.x+t.x)+" "+(n.y+t.y)+"\n\t\tA "+i+" "+i+" 0 "+a+" "+(r?1:0)+"\n\t\t"+(n.x+e.x)+" "+(n.y+e.y)}function I(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=n.x+t.x,s=n.y+t.y,h=n.x+e.x,l=2*i+s;return"M"+o+" "+s+"\n\t\tA "+i+" "+i+" 0 "+a+" "+(r?1:0)+"\n\t\t"+h+" "+l+"\n\t\tM"+o+" "+l+"\n\t\tA "+i+" "+i+" 0 "+a+" "+(r?1:0)+"\n\t\t"+h+" "+(n.y+t.y)}function N(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i="path-fill-gradient-"+e+"-"+(n?"lighter":"default"),r=T(t,i),a=[1,.6,.2];return n&&(a=[.4,.2,0]),A(r,"0%",e,a[0]),A(r,"50%",e,a[1]),A(r,"100%",e,a[2]),i}function F(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Kt,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none";return P("rect",{className:"percentage-bar",x:t,y:e,width:n,height:i,fill:a,styles:{stroke:S(a,-25),"stroke-dasharray":"0, "+(i+n)+", "+n+", "+i,"stroke-width":r}})}function j(t,e,n,i,r){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},o={className:t,x:e,y:n,width:i,height:i,rx:r,fill:arguments.length>5&&void 0!==arguments[5]?arguments[5]:"none"};return Object.keys(a).map((function(t){o[t]=a[t]})),P("rect",o)}function z(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments[4];r=arguments.length>5&&void 0!==arguments[5]&&arguments[5]?b(r,ae):r;var a={className:"legend-bar",x:0,y:0,width:n,height:"2px",fill:i},o=P("text",{className:"legend-dataset-text",x:0,y:0,dy:2*oe+"px","font-size":1.2*oe+"px","text-anchor":"start",fill:he,innerHTML:r}),s=P("g",{transform:"translate("+t+", "+e+")"});return s.appendChild(P("rect",a)),s.appendChild(o),s}function B(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments[4];r=arguments.length>5&&void 0!==arguments[5]&&arguments[5]?b(r,ae):r;var a={className:"legend-dot",cx:0,cy:0,r:n,fill:i},o=P("text",{className:"legend-dataset-text",x:0,y:0,dx:oe+"px",dy:oe/3+"px","font-size":1.2*oe+"px","text-anchor":"start",fill:he,innerHTML:r}),s=P("g",{transform:"translate("+t+", "+e+")"});return s.appendChild(P("circle",a)),s.appendChild(o),s}function H(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=r.fontSize||oe;return P("text",{className:t,x:e,y:n,dy:(void 0!==r.dy?r.dy:a/2)+"px","font-size":a+"px",fill:r.fill||he,"text-anchor":r.textAnchor||"start",innerHTML:i})}function W(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.stroke||(r.stroke=se);var a=P("line",{className:"line-vertical "+r.className,x1:0,x2:0,y1:n,y2:i,styles:{stroke:r.stroke}}),o=P("text",{x:0,y:n>i?n+re:n-re-oe,dy:oe+"px","font-size":oe+"px","text-anchor":"middle",innerHTML:e+""}),s=P("g",{transform:"translate("+t+", 0)"});return s.appendChild(a),s.appendChild(o),s}function Y(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.stroke||(r.stroke=se),r.lineType||(r.lineType=""),r.shortenNumbers&&(e=x(e));var a=P("line",{className:"line-horizontal "+r.className+("dashed"===r.lineType?"dashed":""),x1:n,x2:i,y1:0,y2:0,styles:{stroke:r.stroke}}),o=P("text",{x:n<i?n-re:n+re,y:0,dy:oe/2-2+"px","font-size":oe+"px","text-anchor":n<i?"end":"start",innerHTML:e+""}),s=P("g",{transform:"translate(0, "+t+")","stroke-opacity":1});return 0!==o&&"0"!==o||(s.style.stroke="rgba(27, 31, 35, 0.6)"),s.appendChild(a),s.appendChild(o),s}function X(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};p(t)||(t=0),i.pos||(i.pos="left"),i.offset||(i.offset=0),i.mode||(i.mode="span"),i.stroke||(i.stroke=se),i.className||(i.className="");var r=-1*ie,a="span"===i.mode?n+ie:0;return"tick"===i.mode&&"right"===i.pos&&(r=n+ie,a=n),Y(t,e,r+=i.offset,a+=i.offset,{stroke:i.stroke,className:i.className,lineType:i.lineType,shortenNumbers:i.shortenNumbers})}function q(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};p(t)||(t=0),i.pos||(i.pos="bottom"),i.offset||(i.offset=0),i.mode||(i.mode="span"),i.stroke||(i.stroke=se),i.className||(i.className="");var r=n+ie,a="span"===i.mode?-1*ie:n;return"tick"===i.mode&&"top"===i.pos&&(r=-1*ie,a=0),W(t,e,r,a,{stroke:i.stroke,className:i.className,lineType:i.lineType})}function U(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i.labelPos||(i.labelPos="right");var r=P("text",{className:"chart-label",x:"left"===i.labelPos?re:n-u(e,5)-re,y:0,dy:oe/-2+"px","font-size":oe+"px","text-anchor":"start",innerHTML:e+""}),a=Y(t,"",0,n,{stroke:i.stroke||se,className:i.className||"",lineType:i.lineType});return a.appendChild(r),a}function V(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=t-e,o=P("rect",{className:"bar mini",styles:{fill:"rgba(228, 234, 239, 0.49)",stroke:se,"stroke-dasharray":n+", "+a},x:0,y:0,width:n,height:a});r.labelPos||(r.labelPos="right");var s=P("text",{className:"chart-label",x:"left"===r.labelPos?re:n-u(i+"",4.5)-re,y:0,dy:oe/-2+"px","font-size":oe+"px","text-anchor":"start",innerHTML:i+""}),h=P("g",{transform:"translate(0, "+e+")"});return h.appendChild(o),h.appendChild(s),h}function K(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},h=y(e,s.zeroLine),l=Yt(h,2),c=l[0],d=l[1];d-=o,0===c&&(c=s.minHeight,d-=s.minHeight),p(t)||(t=0),p(d)||(d=0),p(c,!0)||(c=0),p(n,!0)||(n=0);var u=P("rect",{className:"bar mini",style:"fill: "+i,"data-point-index":a,x:t,y:d,width:n,height:c});if((r+="")||r.length){u.setAttribute("y",0),u.setAttribute("x",0);var f=P("text",{className:"data-point-value",x:n/2,y:0,dy:oe/2*-1+"px","font-size":oe+"px","text-anchor":"middle",innerHTML:r}),g=P("g",{"data-point-index":a,transform:"translate("+t+", "+d+")"});return g.appendChild(u),g.appendChild(f),g}return u}function J(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=P("circle",{style:"fill: "+i,"data-point-index":a,cx:t,cy:e,r:n});if((r+="")||r.length){o.setAttribute("cy",0),o.setAttribute("cx",0);var s=P("text",{className:"data-point-value",x:0,y:0,dy:oe/2*-1-n+"px","font-size":oe+"px","text-anchor":"middle",innerHTML:r}),h=P("g",{"data-point-index":a,transform:"translate("+t+", "+e+")"});return h.appendChild(o),h.appendChild(s),h}return o}function Q(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=e.map((function(e,n){return t[n]+","+e})).join("L");i.spline&&(a=_(t,e));var o=M("M"+a,"line-graph-path",n);if(i.heatline){var s=N(r.svgDefs,n);o.style.stroke="url(#"+s+")"}var h={path:o};if(i.regionFill){var l=N(r.svgDefs,n,!0),c="M"+t[0]+","+r.zeroLine+"L"+a+"L"+t.slice(-1)[0]+","+r.zeroLine;h.region=M(c,"region-fill","none","url(#"+l+")")}return h}function $(t,e,n,i){var r="string"==typeof e?e:e.join(", ");return[t,{transform:n.join(", ")},i,ge,"translate",{transform:r}]}function Z(t,e,n){return $(t,[n,0],[e,0],fe)}function tt(t,e,n){return $(t,[0,n],[0,e],fe)}function et(t,e,n,i){var r=e-n,a=t.childNodes[0];return[[a,{height:r,"stroke-dasharray":a.getAttribute("width")+", "+r},fe,ge],$(t,[0,i],[0,n],fe)]}function nt(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=y(n,(arguments.length>5&&void 0!==arguments[5]?arguments[5]:{}).zeroLine),o=Yt(a,2),s=o[0],h=o[1];return h-=r,"rect"!==t.nodeName?[[t.childNodes[0],{width:i,height:s},de,ge],$(t,t.getAttribute("transform").split("(")[1].slice(0,-1),[e,h],fe)]:[[t,{width:i,height:s,x:e,y:h},de,ge]]}function it(t,e,n){return"circle"!==t.nodeName?[$(t,t.getAttribute("transform").split("(")[1].slice(0,-1),[e,n],fe)]:[[t,{cx:e,cy:n},de,ge]]}function rt(t,e,n,i,r){var a=[],o=n.map((function(t,n){return e[n]+","+t})).join("L");r&&(o=_(e,n));var s=[t.path,{d:"M"+o},ue,ge];if(a.push(s),t.region){var h=e[0]+","+i+"L",l="L"+e.slice(-1)[0]+", "+i,c=[t.region,{d:"M"+h+o+l},ue,ge];a.push(c)}return a}function at(t,e){return[t,{d:e},de,ge]}function ot(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"linear",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=t.cloneNode(!0),s=t.cloneNode(!0);for(var h in e){var l=void 0;l="transform"===h?document.createElementNS("http://www.w3.org/2000/svg","animateTransform"):document.createElementNS("http://www.w3.org/2000/svg","animate");var c=a[h]||t.getAttribute(h),d=e[h],u={attributeName:h,from:c,to:d,begin:"0s",dur:n/1e3+"s",values:c+";"+d,keySplines:ve[i],keyTimes:"0;1",calcMode:"spline",fill:"freeze"};for(var f in r&&(u.type=r),u)l.setAttribute(f,u[f]);o.appendChild(l),r?s.setAttribute(h,"translate("+d+")"):s.setAttribute(h,d)}return[o,s]}function st(t,e){t.style.transform=e,t.style.webkitTransform=e,t.style.msTransform=e,t.style.mozTransform=e,t.style.oTransform=e}function ht(t,e){var n=[],i=[];e.map((function(t){var e=t[0],r=e.parentNode,a=void 0,o=void 0;t[0]=e;var s=ot.apply(void 0,Xt(t)),h=Yt(s,2);a=h[0],o=h[1],n.push(o),i.push([a,r]),r&&r.replaceChild(a,e)}));var r=t.cloneNode(!0);return i.map((function(t,i){t[1]&&(t[1].replaceChild(n[i],t[0]),e[i][0]=n[i])})),r}function lt(t,e,n){if(0!==n.length){var i=ht(e,n);e.parentNode==t&&(t.removeChild(e),t.appendChild(i)),setTimeout((function(){i.parentNode==t&&(t.removeChild(i),t.appendChild(e))}),pe)}}function ct(t,e){var n=document.createElement("a");n.style="display: none";var i=new Blob(e,{type:"image/svg+xml; charset=utf-8"}),r=window.URL.createObjectURL(i);n.href=r,n.download=t,document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),window.URL.revokeObjectURL(r)}),300)}function dt(e){var n=e.cloneNode(!0);n.classList.add("chart-container"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var i=t.create("style",{innerHTML:ye});n.insertBefore(i,n.firstChild);var r=t.create("div");return r.appendChild(n),r.innerHTML}function ut(t){var e=new Date(t);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}function ft(t){var e=t.getDate(),n=t.getMonth()+1;return[t.getFullYear(),(n>9?"":"0")+n,(e>9?"":"0")+e].join("-")}function pt(t){return new Date(t.getTime())}function gt(t,e){var n=xt(t);return Math.ceil(vt(n,e)/xe)}function vt(t,e){var n=we*_e;return(ut(e)-ut(t))/n}function yt(t,e){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}function mt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Se[t];return e?n.slice(0,3):n}function bt(t,e){return new Date(e,t+1,0)}function xt(t){var e=pt(t),n=e.getDay();return 0!==n&&_t(e,-1*n),e}function _t(t,e){t.setDate(t.getDate()+e)}function wt(t,e,n){var i=Object.keys(Pe).filter((function(e){return t.includes(e)})),r=Pe[i[0]];return Object.assign(r,{constants:e,getData:n}),new Ce(r)}function St(t){if(0===t)return[0,0];if(isNaN(t))return{mantissa:-6755399441055744,exponent:972};var e=t>0?1:-1;if(!isFinite(t))return{mantissa:4503599627370496*e,exponent:972};t=Math.abs(t);var n=Math.floor(Math.log10(t));return[e*(t/Math.pow(10,n)),n]}function kt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Math.ceil(t),i=Math.floor(e),r=n-i,a=r,o=1;r>5&&(r%2!=0&&(r=++n-i),a=r/2,o=2),r<=2&&(o=r/(a=4)),0===r&&(a=5,o=1);for(var s=[],h=0;h<=a;h++)s.push(i+o*h);return s}function Ct(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=St(t),i=Yt(n,2),r=i[0],a=i[1],o=e?e/Math.pow(10,a):0,s=kt(r=r.toFixed(6),o);return s.map((function(t){return t*Math.pow(10,a)}))}function Pt(t){function e(t,e){for(var n=Ct(t),i=n[1]-n[0],r=0,a=1;r<e;a++)r+=i,n.unshift(-1*r);return n}var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Math.max.apply(Math,Xt(t)),r=Math.min.apply(Math,Xt(t)),a=[];if(i>=0&&r>=0)St(i)[1],a=n?Ct(i,r):Ct(i);else if(i>0&&r<0){var o=Math.abs(r);i>=o?(St(i)[1],a=e(i,o)):(St(o)[1],a=e(o,i).reverse().map((function(t){return-1*t})))}else if(i<=0&&r<=0){var s=Math.abs(r),h=Math.abs(i);St(s)[1],a=(a=n?Ct(s,h):Ct(s)).reverse().map((function(t){return-1*t}))}return a}function Tt(t){var e=At(t);return t.indexOf(0)>=0?t.indexOf(0):t[0]>0?-1*t[0]/e:-1*t[t.length-1]/e+(t.length-1)}function At(t){return t[1]-t[0]}function Lt(t){return t[t.length-1]-t[0]}function Et(t,e){return c(e.zeroLine-t*e.scaleMultiplier)}function Ot(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.reduce((function(e,n){return Math.abs(n-t)<Math.abs(e-t)?n:e}),[]);return n?e.indexOf(i):i}function Mt(t,e){for(var n=Math.max.apply(Math,Xt(t)),i=1/(e-1),r=[],a=0;a<e;a++){var o=n*(i*a);r.push(o)}return r}function Dt(t,e){return e.filter((function(e){return e<t})).length}function Gt(t,e){t.labels=t.labels||[];var n=t.labels.length,i=t.datasets,r=new Array(n).fill(0);return i||(i=[{values:r}]),i.map((function(t){if(t.values){var i=t.values;i=(i=i.map((function(t){return isNaN(t)?0:t}))).length>n?i.slice(0,n):d(i,n-i.length,0),t.values=i}else t.values=r;t.chartType||(Vt.includes(e),t.chartType=e)})),t.yRegions&&t.yRegions.map((function(t){if(t.end<t.start){var e=[t.end,t.start];t.start=e[0],t.end=e[1]}})),t}function Rt(t){var e=t.labels.length,n=new Array(e).fill(0),i={labels:t.labels.slice(0,-1),datasets:t.datasets.map((function(t){return{name:"",values:n.slice(0,-1),chartType:t.chartType}}))};return t.yMarkers&&(i.yMarkers=[{value:0,label:""}]),t.yRegions&&(i.yRegions=[{start:0,end:0,label:""}]),i}function It(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t/e.length;i<=0&&(i=1);var r=i/Jt,a=void 0;if(n){var o=Math.max.apply(Math,Xt(e.map((function(t){return t.length}))));a=Math.ceil(o/r)}return e.map((function(t,e){return(t+="").length>r&&(n?e%a!=0&&(t=""):t=r-3>0?t.slice(0,r-3)+" ...":t.slice(0,r)+".."),t}))}function Nt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"line",e=arguments[1],n=arguments[2];return"axis-mixed"===t?(n.type="line",new Ee(e,n)):Me[t]?new Me[t](e,n):void console.error("Undefined chart type: "+t)}!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}('.chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ol,.graph-svg-tip ul{padding-left:0;display:-webkit-box;display:-ms-flexbox;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;-webkit-box-flex:1;-ms-flex:1;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:" ";border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}');var Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise((function(n,r){var s={key:t,arg:e,resolve:n,reject:r,next:null};o?o=o.next=s:(a=o=s,i(t,e))}))}function i(n,a){try{var o=e[n](a),s=o.value;s instanceof t?Promise.resolve(s.value).then((function(t){i("next",t)}),(function(t){i("throw",t)})):r(o.done?"return":"normal",o.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":a.resolve({value:e,done:!0});break;case"throw":a.reject(e);break;default:a.resolve({value:e,done:!1})}(a=a.next)?i(a.key,a.arg):o=null}var a,o;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),zt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Bt=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,n,i)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(i):void 0},Ht=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Wt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Yt=function(){function t(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Xt=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};t.create=function(e,n){var i=document.createElement(e);for(var r in n){var a=n[r];if("inside"===r)t(a).appendChild(i);else if("around"===r){var o=t(a);o.parentNode.insertBefore(i,o),i.appendChild(o)}else"styles"===r?"object"===(void 0===a?"undefined":Ft(a))&&Object.keys(a).map((function(t){i.style[t]=a[t]})):r in i?i[r]=a:i.setAttribute(r,a)}return i};var qt={margins:{top:10,bottom:10,left:20,right:20},paddings:{top:20,bottom:40,left:30,right:10},baseHeight:240,titleHeight:20,legendHeight:30,titleFontSize:12},Ut=700,Vt=["line","bar"],Kt=2,Jt=7,Qt=["light-blue","blue","violet","red","orange","yellow","green","light-green","purple","magenta","light-grey","dark-grey"],$t={bar:Qt,line:Qt,pie:Qt,percentage:Qt,heatmap:["#ebedf0","#c6e48b","#7bc96f","#239a3b","#196127"],donut:Qt},Zt=Math.PI/180,te=function(){function e(t){var n=t.parent,i=void 0===n?null:n,r=t.colors,a=void 0===r?[]:r;jt(this,e),this.parent=i,this.colors=a,this.titleName="",this.titleValue="",this.listValues=[],this.titleValueFirst=0,this.x=0,this.y=0,this.top=0,this.left=0,this.setup()}return zt(e,[{key:"setup",value:function(){this.makeTooltip()}},{key:"refresh",value:function(){this.fill(),this.calcPosition()}},{key:"makeTooltip",value:function(){var e=this;this.container=t.create("div",{inside:this.parent,className:"graph-svg-tip comparison",innerHTML:'<span class="title"></span>\n\t\t\t\t<ul class="data-point-list"></ul>\n\t\t\t\t<div class="svg-pointer"></div>'}),this.hideTip(),this.title=this.container.querySelector(".title"),this.dataPointList=this.container.querySelector(".data-point-list"),this.parent.addEventListener("mouseleave",(function(){e.hideTip()}))}},{key:"fill",value:function(){var e=this,n=void 0;this.index&&this.container.setAttribute("data-point-index",this.index),n=this.titleValueFirst?"<strong>"+this.titleValue+"</strong>"+this.titleName:this.titleName+"<strong>"+this.titleValue+"</strong>",this.title.innerHTML=n,this.dataPointList.innerHTML="",this.listValues.map((function(n,i){var r=e.colors[i]||"black",a=0===n.formatted||n.formatted?n.formatted:n.value,o=t.create("li",{styles:{"border-top":"3px solid "+r},innerHTML:'<strong style="display: block;">'+(0===a||a?a:"")+"</strong>\n\t\t\t\t\t"+(n.title?n.title:"")});e.dataPointList.appendChild(o)}))}},{key:"calcPosition",value:function(){var t=this.container.offsetWidth;this.top=this.y-this.container.offsetHeight-5,this.left=this.x-t/2;var e=this.parent.offsetWidth-t,n=this.container.querySelector(".svg-pointer");if(this.left<0)n.style.left="calc(50% - "+-1*this.left+"px)",this.left=0;else if(this.left>e){var i="calc(50% + "+(this.left-e)+"px)";n.style.left=i,this.left=e}else n.style.left="50%"}},{key:"setValues",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1;this.titleName=n.name,this.titleValue=n.value,this.listValues=i,this.x=t,this.y=e,this.titleValueFirst=n.valueFirst||0,this.index=r,this.refresh()}},{key:"hideTip",value:function(){this.container.style.top="0px",this.container.style.left="0px",this.container.style.opacity="0"}},{key:"showTip",value:function(){this.container.style.top=this.top+"px",this.container.style.left=this.left+"px",this.container.style.opacity="1"}}]),e}(),ee={"light-blue":"#7cd6fd",blue:"#5e64ff",violet:"#743ee2",red:"#ff5858",orange:"#ffa00a",yellow:"#feef72",green:"#28a745","light-green":"#98d85b",purple:"#b554ff",magenta:"#ffa3ef",black:"#36114C",grey:"#bdd3e6","light-grey":"#f0f4f7","dark-grey":"#b8c2cc"},ne=function(t){return/rgb[a]{0,1}\([\d, ]+\)/gim.test(t)?/\D+(\d*)\D+(\d*)\D+(\d*)/gim.exec(t).map((function(t,e){return 0!==e?Number(t).toString(16):"#"})).reduce((function(t,e){return""+t+e})):ee[t]||t},ie=6,re=4,ae=15,oe=10,se="#dadada",he="#555b51",le={bar:function(t){var e=void 0;"rect"!==t.nodeName&&(e=t.getAttribute("transform"),t=t.childNodes[0]);var n=t.cloneNode();return n.style.fill="#000000",n.style.opacity="0.4",e&&n.setAttribute("transform",e),n},dot:function(t){var e=void 0;"circle"!==t.nodeName&&(e=t.getAttribute("transform"),t=t.childNodes[0]);var n=t.cloneNode(),i=t.getAttribute("r"),r=t.getAttribute("fill");return n.setAttribute("r",parseInt(i)+4),n.setAttribute("fill",r),n.style.opacity="0.6",e&&n.setAttribute("transform",e),n},heat_square:function(t){var e=void 0;"circle"!==t.nodeName&&(e=t.getAttribute("transform"),t=t.childNodes[0]);var n=t.cloneNode(),i=t.getAttribute("r"),r=t.getAttribute("fill");return n.setAttribute("r",parseInt(i)+4),n.setAttribute("fill",r),n.style.opacity="0.6",e&&n.setAttribute("transform",e),n}},ce={bar:function(t,e){var n=void 0;"rect"!==t.nodeName&&(n=t.getAttribute("transform"),t=t.childNodes[0]);var i=["x","y","width","height"];Object.values(t.attributes).filter((function(t){return i.includes(t.name)&&t.specified})).map((function(t){e.setAttribute(t.name,t.nodeValue)})),n&&e.setAttribute("transform",n)},dot:function(t,e){var n=void 0;"circle"!==t.nodeName&&(n=t.getAttribute("transform"),t=t.childNodes[0]);var i=["cx","cy"];Object.values(t.attributes).filter((function(t){return i.includes(t.name)&&t.specified})).map((function(t){e.setAttribute(t.name,t.nodeValue)})),n&&e.setAttribute("transform",n)},heat_square:function(t,e){var n=void 0;"circle"!==t.nodeName&&(n=t.getAttribute("transform"),t=t.childNodes[0]);var i=["cx","cy"];Object.values(t.attributes).filter((function(t){return i.includes(t.name)&&t.specified})).map((function(t){e.setAttribute(t.name,t.nodeValue)})),n&&e.setAttribute("transform",n)}},de=350,ue=350,fe=de,pe=250,ge="easein",ve={ease:"0.25 0.1 0.25 1",linear:"0 0 1 1",easein:"0.1 0.8 0.2 1",easeout:"0 0 0.58 1",easeinout:"0.42 0 0.58 1"},ye=".chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ul{padding-left:0;display:flex}.graph-svg-tip ol{padding-left:0;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:' ';border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}",me=function(){function e(t,n){if(jt(this,e),n=v(n),this.parent="string"==typeof t?document.querySelector(t):t,!(this.parent instanceof HTMLElement))throw new Error("No `parent` element to render on was provided.");this.rawChartArgs=n,this.title=n.title||"",this.type=n.type||"",this.realData=this.prepareData(n.data),this.data=this.prepareFirstData(this.realData),this.colors=this.validateColors(n.colors,this.type),this.config={showTooltip:1,showLegend:1,isNavigable:n.isNavigable||0,animate:void 0!==n.animate?n.animate:1,truncateLegends:n.truncateLegends||1},this.measures=JSON.parse(JSON.stringify(qt));var i=this.measures;this.setMeasures(n),this.title.length||(i.titleHeight=0),this.config.showLegend||(i.legendHeight=0),this.argHeight=n.height||i.baseHeight,this.state={},this.options={},this.initTimeout=Ut,this.config.isNavigable&&(this.overlays=[]),this.configure(n)}return zt(e,[{key:"prepareData",value:function(t){return t}},{key:"prepareFirstData",value:function(t){return t}},{key:"validateColors",value:function(t,e){var n=[];return(t=(t||[]).concat($t[e])).forEach((function(t){var e=ne(t);k(e)?n.push(e):console.warn('"'+t+'" is not a valid color.')})),n}},{key:"setMeasures",value:function(){}},{key:"configure",value:function(){var t=this,e=this.argHeight;this.baseHeight=e,this.height=e-h(this.measures),this.boundDrawFn=function(){return t.draw(!0)},ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.boundDrawFn),this.resizeObserver.observe(this.parent)),window.addEventListener("resize",this.boundDrawFn),window.addEventListener("orientationchange",this.boundDrawFn)}},{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),window.removeEventListener("resize",this.boundDrawFn),window.removeEventListener("orientationchange",this.boundDrawFn)}},{key:"setup",value:function(){this.makeContainer(),this.updateWidth(),this.makeTooltip(),this.draw(!1,!0)}},{key:"makeContainer",value:function(){this.parent.innerHTML="";var e={inside:this.parent,className:"chart-container"};this.independentWidth&&(e.styles={width:this.independentWidth+"px"}),this.container=t.create("div",e)}},{key:"makeTooltip",value:function(){this.tip=new te({parent:this.container,colors:this.colors}),this.bindTooltip()}},{key:"bindTooltip",value:function(){}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&n(this.parent)||(this.updateWidth(),this.calc(e),this.makeChartArea(),this.setupComponents(),this.components.forEach((function(e){return e.setup(t.drawArea)})),this.render(this.components,!1),i&&(this.data=this.realData,setTimeout((function(){t.update(t.data)}),this.initTimeout)),this.renderLegend(),this.setupNavigation(i))}},{key:"calc",value:function(){}},{key:"updateWidth",value:function(){this.baseWidth=r(this.parent),this.width=this.baseWidth-l(this.measures)}},{key:"makeChartArea",value:function(){this.svg&&this.container.removeChild(this.svg);var t=this.measures;this.svg=L(this.container,"frappe-chart chart",this.baseWidth,this.baseHeight),this.svgDefs=E(this.svg),this.title.length&&(this.titleEL=H("title",t.margins.left,t.margins.top,this.title,{fontSize:t.titleFontSize,fill:"#666666",dy:t.titleFontSize}));var e=o(t);this.drawArea=O(this.type+"-chart chart-draw-area","translate("+s(t)+", "+e+")"),this.config.showLegend&&(e+=this.height+t.paddings.bottom,this.legendArea=O("chart-legend","translate("+s(t)+", "+e+")")),this.title.length&&this.svg.appendChild(this.titleEL),this.svg.appendChild(this.drawArea),this.config.showLegend&&this.svg.appendChild(this.legendArea),this.updateTipOffset(s(t),o(t))}},{key:"updateTipOffset",value:function(t,e){this.tip.offset={x:t,y:e}}},{key:"setupComponents",value:function(){this.components=new Map}},{key:"update",value:function(t){t||console.error("No data to update."),this.data=this.prepareData(t),this.calc(),this.render(this.components,this.config.animate),this.renderLegend()}},{key:"render",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.components,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.config.isNavigable&&this.overlays.map((function(t){return t.parentNode.removeChild(t)}));var i=[];e.forEach((function(t){i=i.concat(t.update(n))})),i.length>0?(lt(this.container,this.svg,i),setTimeout((function(){e.forEach((function(t){return t.make()})),t.updateNav()}),400)):(e.forEach((function(t){return t.make()})),this.updateNav())}},{key:"updateNav",value:function(){this.config.isNavigable&&(this.makeOverlay(),this.bindUnits())}},{key:"renderLegend",value:function(){}},{key:"setupNavigation",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.config.isNavigable&&e&&(this.bindOverlay(),this.keyActions={13:this.onEnterKey.bind(this),37:this.onLeftArrow.bind(this),38:this.onUpArrow.bind(this),39:this.onRightArrow.bind(this),40:this.onDownArrow.bind(this)},document.addEventListener("keydown",(function(e){i(t.container)&&(e=e||window.event,t.keyActions[e.keyCode]&&t.keyActions[e.keyCode]())})))}},{key:"makeOverlay",value:function(){}},{key:"updateOverlay",value:function(){}},{key:"bindOverlay",value:function(){}},{key:"bindUnits",value:function(){}},{key:"onLeftArrow",value:function(){}},{key:"onRightArrow",value:function(){}},{key:"onUpArrow",value:function(){}},{key:"onDownArrow",value:function(){}},{key:"onEnterKey",value:function(){}},{key:"addDataPoint",value:function(){}},{key:"removeDataPoint",value:function(){}},{key:"getDataPoint",value:function(){}},{key:"setCurrentDataPoint",value:function(){}},{key:"updateDataset",value:function(){}},{key:"export",value:function(){var t=dt(this.svg);ct(this.title||"Chart",[t])}}]),e}(),be=function(t){function e(t,n){return jt(this,e),Wt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}return Ht(e,t),zt(e,[{key:"configure",value:function(t){Bt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"configure",this).call(this,t),this.config.formatTooltipY=(t.tooltipOptions||{}).formatTooltipY,this.config.maxSlices=t.maxSlices||20,this.config.maxLegendPoints=t.maxLegendPoints||20}},{key:"calc",value:function(){var t=this,e=this.state,n=this.config.maxSlices;e.sliceTotals=[];var i=this.data.labels.map((function(e,n){var i=0;return t.data.datasets.map((function(t){i+=t.values[n]})),[i,e]})).filter((function(t){return t[0]>=0})),r=i;if(i.length>n){i.sort((function(t,e){return e[0]-t[0]})),r=i.slice(0,n-1);var a=0;i.slice(n-1).map((function(t){a+=t[0]})),r.push([a,"Rest"]),this.colors[n-1]="grey"}e.labels=[],r.map((function(t){e.sliceTotals.push(g(t[0])),e.labels.push(t[1])})),e.grandTotal=e.sliceTotals.reduce((function(t,e){return t+e}),0),this.center={x:this.width/2,y:this.height/2}}},{key:"renderLegend",value:function(){var t=this,e=this.state;this.legendArea.textContent="",this.legendTotals=e.sliceTotals.slice(0,this.config.maxLegendPoints);var n=0,i=0;this.legendTotals.map((function(r,a){var o=150,s=Math.floor((t.width-l(t.measures))/o);t.legendTotals.length<s&&(o=t.width/t.legendTotals.length),n>s&&(n=0,i+=20);var h=o*n+5,c=t.config.truncateLegends?b(e.labels[a],o/10):e.labels[a],d=t.config.formatTooltipY?t.config.formatTooltipY(r):r,u=B(h,i,5,t.colors[a],c+": "+d,!1);t.legendArea.appendChild(u),n++}))}}]),e}(me),xe=7,_e=1e3,we=86400,Se=["January","February","March","April","May","June","July","August","September","October","November","December"],ke=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Ce=function(){function t(e){var n=e.layerClass,i=void 0===n?"":n,r=e.layerTransform,a=void 0===r?"":r,o=e.constants,s=e.getData,h=e.makeElements,l=e.animateElements;jt(this,t),this.layerTransform=a,this.constants=o,this.makeElements=h,this.getData=s,this.animateElements=l,this.store=[],this.labels=[],this.layerClass=i,this.layerClass="function"==typeof this.layerClass?this.layerClass():this.layerClass,this.refresh()}return zt(t,[{key:"refresh",value:function(t){this.data=t||this.getData()}},{key:"setup",value:function(t){this.layer=O(this.layerClass,this.layerTransform,t)}},{key:"make",value:function(){this.render(this.data),this.oldData=this.data}},{key:"render",value:function(t){var e=this;this.store=this.makeElements(t),this.layer.textContent="",this.store.forEach((function(t){e.layer.appendChild(t)})),this.labels.forEach((function(t){e.layer.appendChild(t)}))}},{key:"update",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.refresh();var e=[];return t&&(e=this.animateElements(this.data)||[]),e}}]),t}(),Pe={donutSlices:{layerClass:"donut-slices",makeElements:function(t){return t.sliceStrings.map((function(e,n){var i=M(e,"donut-path",t.colors[n],"none",t.strokeWidth);return i.style.transition="transform .3s;",i}))},animateElements:function(t){return this.store.map((function(e,n){return at(e,t.sliceStrings[n])}))}},pieSlices:{layerClass:"pie-slices",makeElements:function(t){return t.sliceStrings.map((function(e,n){var i=M(e,"pie-path","none",t.colors[n]);return i.style.transition="transform .3s;",i}))},animateElements:function(t){return this.store.map((function(e,n){return at(e,t.sliceStrings[n])}))}},percentageBars:{layerClass:"percentage-bars",makeElements:function(t){var e=this;return t.xPositions.map((function(n,i){return F(n,0,t.widths[i],e.constants.barHeight,e.constants.barDepth,t.colors[i])}))},animateElements:function(t){if(t)return[]}},yAxis:{layerClass:"y axis",makeElements:function(t){var e=this;return t.positions.map((function(n,i){return X(n,t.labels[i],e.constants.width,{mode:e.constants.mode,pos:e.constants.pos,shortenNumbers:e.constants.shortenNumbers})}))},animateElements:function(t){var e=t.positions,n=t.labels,i=this.oldData.positions,r=this.oldData.labels,a=m(i,e),o=Yt(a,2);i=o[0],e=o[1];var s=m(r,n),h=Yt(s,2);return r=h[0],n=h[1],this.render({positions:i,labels:n}),this.store.map((function(t,n){return tt(t,e[n],i[n])}))}},xAxis:{layerClass:"x axis",makeElements:function(t){var e=this;return t.positions.map((function(n,i){return q(n,t.calcLabels[i],e.constants.height,{mode:e.constants.mode,pos:e.constants.pos})}))},animateElements:function(t){var e=t.positions,n=t.calcLabels,i=this.oldData.positions,r=this.oldData.calcLabels,a=m(i,e),o=Yt(a,2);i=o[0],e=o[1];var s=m(r,n),h=Yt(s,2);return r=h[0],n=h[1],this.render({positions:i,calcLabels:n}),this.store.map((function(t,n){return Z(t,e[n],i[n])}))}},yMarkers:{layerClass:"y-markers",makeElements:function(t){var e=this;return t.map((function(t){return U(t.position,t.label,e.constants.width,{labelPos:t.options.labelPos,mode:"span",lineType:"dashed"})}))},animateElements:function(t){var e=m(this.oldData,t),n=Yt(e,2);this.oldData=n[0];var i=(t=n[1]).map((function(t){return t.position})),r=t.map((function(t){return t.label})),a=t.map((function(t){return t.options})),o=this.oldData.map((function(t){return t.position}));return this.render(o.map((function(t,e){return{position:o[e],label:r[e],options:a[e]}}))),this.store.map((function(t,e){return tt(t,i[e],o[e])}))}},yRegions:{layerClass:"y-regions",makeElements:function(t){var e=this;return t.map((function(t){return V(t.startPos,t.endPos,e.constants.width,t.label,{labelPos:t.options.labelPos})}))},animateElements:function(t){var e=m(this.oldData,t),n=Yt(e,2);this.oldData=n[0];var i=(t=n[1]).map((function(t){return t.endPos})),r=t.map((function(t){return t.label})),a=t.map((function(t){return t.startPos})),o=t.map((function(t){return t.options})),s=this.oldData.map((function(t){return t.endPos})),h=this.oldData.map((function(t){return t.startPos}));this.render(s.map((function(t,e){return{startPos:h[e],endPos:s[e],label:r[e],options:o[e]}})));var l=[];return this.store.map((function(t,e){l=l.concat(et(t,a[e],i[e],s[e]))})),l}},heatDomain:{layerClass:function(){return"heat-domain domain-"+this.constants.index},makeElements:function(t){var e=this,n=this.constants,i=n.index,r=n.colWidth,a=n.rowHeight,o=n.squareSize,s=n.radius,h=n.xTranslate,l=0;return this.serializedSubDomains=[],t.cols.map((function(t,n){1===n&&e.labels.push(H("domain-name",h,-12,mt(i,!0).toUpperCase(),{fontSize:9})),t.map((function(t,n){if(t.fill){var i={"data-date":t.yyyyMmDd,"data-value":t.dataValue,"data-day":n},r=j("day",h,l,o,s,t.fill,i);e.serializedSubDomains.push(r)}l+=a})),l=0,h+=r})),this.serializedSubDomains},animateElements:function(t){if(t)return[]}},barGraph:{layerClass:function(){return"dataset-units dataset-bars dataset-"+this.constants.index},makeElements:function(t){var e=this.constants;return this.unitType="bar",this.units=t.yPositions.map((function(n,i){return K(t.xPositions[i],n,t.barWidth,e.color,t.labels[i],i,t.offsets[i],{zeroLine:t.zeroLine,barsWidth:t.barsWidth,minHeight:e.minHeight})})),this.units},animateElements:function(t){var e=t.xPositions,n=t.yPositions,i=t.offsets,r=t.labels,a=this.oldData.xPositions,o=this.oldData.yPositions,s=this.oldData.offsets,h=this.oldData.labels,l=m(a,e),c=Yt(l,2);a=c[0],e=c[1];var d=m(o,n),u=Yt(d,2);o=u[0],n=u[1];var f=m(s,i),p=Yt(f,2);s=p[0],i=p[1];var g=m(h,r),v=Yt(g,2);h=v[0],r=v[1],this.render({xPositions:a,yPositions:o,offsets:s,labels:r,zeroLine:this.oldData.zeroLine,barsWidth:this.oldData.barsWidth,barWidth:this.oldData.barWidth});var y=[];return this.store.map((function(r,a){y=y.concat(nt(r,e[a],n[a],t.barWidth,i[a],{zeroLine:t.zeroLine}))})),y}},lineGraph:{layerClass:function(){return"dataset-units dataset-line dataset-"+this.constants.index},makeElements:function(t){var e=this.constants;return this.unitType="dot",this.paths={},e.hideLine||(this.paths=Q(t.xPositions,t.yPositions,e.color,{heatline:e.heatline,regionFill:e.regionFill,spline:e.spline},{svgDefs:e.svgDefs,zeroLine:t.zeroLine})),this.units=[],e.hideDots||(this.units=t.yPositions.map((function(n,i){return J(t.xPositions[i],n,t.radius,e.color,e.valuesOverPoints?t.values[i]:"",i)}))),Object.values(this.paths).concat(this.units)},animateElements:function(t){var e=t.xPositions,n=t.yPositions,i=t.values,r=this.oldData.xPositions,a=this.oldData.yPositions,o=this.oldData.values,s=m(r,e),h=Yt(s,2);r=h[0],e=h[1];var l=m(a,n),c=Yt(l,2);a=c[0],n=c[1];var d=m(o,i),u=Yt(d,2);o=u[0],i=u[1],this.render({xPositions:r,yPositions:a,values:i,zeroLine:this.oldData.zeroLine,radius:this.oldData.radius});var f=[];return Object.keys(this.paths).length&&(f=f.concat(rt(this.paths,e,n,t.zeroLine,this.constants.spline))),this.units.length&&this.units.map((function(t,i){f=f.concat(it(t,e[i],n[i]))})),f}}},Te=function(t){function n(t,e){jt(this,n);var i=Wt(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i.type="percentage",i.setup(),i}return Ht(n,t),zt(n,[{key:"setMeasures",value:function(t){var e=this.measures;this.barOptions=t.barOptions||{};var n=this.barOptions;n.height=n.height||20,n.depth=n.depth||Kt,e.paddings.right=30,e.legendHeight=60,e.baseHeight=8*(n.height+.5*n.depth)}},{key:"setupComponents",value:function(){var t=this.state,e=[["percentageBars",{barHeight:this.barOptions.height,barDepth:this.barOptions.depth},function(){return{xPositions:t.xPositions,widths:t.widths,colors:this.colors}}.bind(this)]];this.components=new Map(e.map((function(t){var e=wt.apply(void 0,Xt(t));return[t[0],e]})))}},{key:"calc",value:function(){var t=this;Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"calc",this).call(this);var e=this.state;e.xPositions=[],e.widths=[];var i=0;e.sliceTotals.map((function(n){var r=t.width*n/e.grandTotal;e.widths.push(r),e.xPositions.push(i),i+=r}))}},{key:"makeDataByIndex",value:function(){}},{key:"bindTooltip",value:function(){var t=this,n=this.state;this.container.addEventListener("mousemove",(function(i){var r=t.components.get("percentageBars").store,a=i.target;if(r.includes(a)){var o=r.indexOf(a),s=e(t.container),h=e(a),l=h.left-s.left+parseInt(a.getAttribute("width"))/2,c=h.top-s.top,d=(t.formattedLabels&&t.formattedLabels.length>0?t.formattedLabels[o]:t.state.labels[o])+": ",u=n.sliceTotals[o]/n.grandTotal;t.tip.setValues(l,c,{name:d,value:(100*u).toFixed(1)+"%"}),t.tip.showTip()}}))}}]),n}(be),Ae=function(t){function n(t,e){jt(this,n);var i=Wt(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i.type="pie",i.initTimeout=0,i.init=1,i.setup(),i}return Ht(n,t),zt(n,[{key:"configure",value:function(t){Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"configure",this).call(this,t),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=t.hoverRadio||.1,this.config.startAngle=t.startAngle||0,this.clockWise=t.clockWise||!1}},{key:"calc",value:function(){var t=this;Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"calc",this).call(this);var e=this.state;this.radius=this.height>this.width?this.center.x:this.center.y;var i=this.radius,r=this.clockWise,a=e.slicesProperties||[];e.sliceStrings=[],e.slicesProperties=[];var o=180-this.config.startAngle;e.sliceTotals.map((function(n,s){var h=o,l=n/e.grandTotal*360,c=l>180?1:0,d=r?-l:l,u=o+=d,p=f(h,i),g=f(u,i),v=t.init&&a[s],y=void 0,m=void 0;t.init?(y=v?v.startPosition:p,m=v?v.endPosition:p):(y=p,m=g);var b=360===l?G(y,m,t.center,t.radius,r,c):D(y,m,t.center,t.radius,r,c);e.sliceStrings.push(b),e.slicesProperties.push({startPosition:p,endPosition:g,value:n,total:e.grandTotal,startAngle:h,endAngle:u,angle:d})})),this.init=0}},{key:"setupComponents",value:function(){var t=this.state,e=[["pieSlices",{},function(){return{sliceStrings:t.sliceStrings,colors:this.colors}}.bind(this)]];this.components=new Map(e.map((function(t){var e=wt.apply(void 0,Xt(t));return[t[0],e]})))}},{key:"calTranslateByAngle",value:function(t){var e=this.radius,n=this.hoverRadio,i=f(t.startAngle+t.angle/2,e);return"translate3d("+i.x*n+"px,"+i.y*n+"px,0)"}},{key:"hoverSlice",value:function(t,n,i,r){if(t){var a=this.colors[n];if(i){st(t,this.calTranslateByAngle(this.state.slicesProperties[n])),t.style.fill=S(a,50);var o=e(this.svg),s=r.pageX-o.left+10,h=r.pageY-o.top-10,l=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[n]:this.state.labels[n])+": ",c=(100*this.state.sliceTotals[n]/this.state.grandTotal).toFixed(1);this.tip.setValues(s,h,{name:l,value:c+"%"}),this.tip.showTip()}else st(t,"translate3d(0,0,0)"),this.tip.hideTip(),t.style.fill=a}}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(t){var e=t.target,n=this.components.get("pieSlices").store,i=this.curActiveSliceIndex,r=this.curActiveSlice;if(n.includes(e)){var a=n.indexOf(e);this.hoverSlice(r,i,!1),this.curActiveSlice=e,this.curActiveSliceIndex=a,this.hoverSlice(e,a,!0,t)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),n}(be),Le=function(t){function e(t,n){jt(this,e);var i=Wt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.type="heatmap",i.countLabel=n.countLabel||"";var r=["Sunday","Monday"],a=r.includes(n.startSubDomain)?n.startSubDomain:"Sunday";return i.startSubDomainIndex=r.indexOf(a),i.setup(),i}return Ht(e,t),zt(e,[{key:"setMeasures",value:function(t){var e=this.measures;this.discreteDomains=0===t.discreteDomains?0:1,e.paddings.top=36,e.paddings.bottom=0,e.legendHeight=24,e.baseHeight=12*xe+h(e);var n=this.data,i=this.discreteDomains?12:0;this.independentWidth=12*(gt(n.start,n.end)+i)+l(e)}},{key:"updateWidth",value:function(){var t=this.discreteDomains?12:0,e=this.state.noOfWeeks?this.state.noOfWeeks:52;this.baseWidth=12*(e+t)+l(this.measures)}},{key:"prepareData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data;if(t.start&&t.end&&t.start>t.end)throw new Error("Start date cannot be greater than end date.");if(t.start||(t.start=new Date,t.start.setFullYear(t.start.getFullYear()-1)),t.end||(t.end=new Date),t.dataPoints=t.dataPoints||{},parseInt(Object.keys(t.dataPoints)[0])>1e5){var e={};Object.keys(t.dataPoints).forEach((function(n){var i=new Date(n*_e);e[ft(i)]=t.dataPoints[n]})),t.dataPoints=e}return t}},{key:"calc",value:function(){var t=this.state;t.start=pt(this.data.start),t.end=pt(this.data.end),t.firstWeekStart=pt(t.start),t.noOfWeeks=gt(t.start,t.end),t.distribution=Mt(Object.values(this.data.dataPoints),5),t.domainConfigs=this.getDomains()}},{key:"setupComponents",value:function(){var t=this,e=this.state,n=this.discreteDomains?0:1,i=e.domainConfigs.map((function(i,r){return["heatDomain",{index:i.index,colWidth:12,rowHeight:12,squareSize:10,radius:t.rawChartArgs.radius||0,xTranslate:12*e.domainConfigs.filter((function(t,e){return e<r})).map((function(t){return t.cols.length-n})).reduce((function(t,e){return t+e}),0)},function(){return e.domainConfigs[r]}.bind(t)]}));this.components=new Map(i.map((function(t,e){var n=wt.apply(void 0,Xt(t));return[t[0]+"-"+e,n]})));var r=0;ke.forEach((function(e,n){if([1,3,5].includes(n)){var i=H("subdomain-name",-6,r,e,{fontSize:10,dy:8,textAnchor:"end"});t.drawArea.appendChild(i)}r+=12}))}},{key:"update",value:function(t){t||console.error("No data to update."),this.data=this.prepareData(t),this.draw(),this.bindTooltip()}},{key:"bindTooltip",value:function(){var t=this;this.container.addEventListener("mousemove",(function(e){t.components.forEach((function(n){var i=n.store,r=e.target;if(i.includes(r)){var a=r.getAttribute("data-value"),o=r.getAttribute("data-date").split("-"),s=mt(parseInt(o[1])-1,!0),h=t.container.getBoundingClientRect(),l=r.getBoundingClientRect(),c=parseInt(e.target.getAttribute("width")),d=l.left-h.left+c/2,u=l.top-h.top,f=a+" "+t.countLabel,p=" on "+s+" "+o[0]+", "+o[2];t.tip.setValues(d,u,{name:p,value:f,valueFirst:1},[]),t.tip.showTip()}}))}))}},{key:"renderLegend",value:function(){var t=this;this.legendArea.textContent="";var e=0,n=this.rawChartArgs.radius||0,i=H("subdomain-name",e,12,"Less",{fontSize:11,dy:9});e=30,this.legendArea.appendChild(i),this.colors.slice(0,5).map((function(i,r){var a=j("heatmap-legend-unit",e+15*r,12,10,n,i);t.legendArea.appendChild(a)}));var r=H("subdomain-name",e+75+3,12,"More",{fontSize:11,dy:9});this.legendArea.appendChild(r)}},{key:"getDomains",value:function(){for(var t=this.state,e=[t.start.getMonth(),t.start.getFullYear()],n=e[0],i=e[1],r=[t.end.getMonth(),t.end.getFullYear()],a=r[0]-n+1+12*(r[1]-i),o=[],s=pt(t.start),h=0;h<a;h++){var l=t.end;if(!yt(s,t.end)){var c=[s.getMonth(),s.getFullYear()];l=bt(c[0],c[1])}o.push(this.getDomainConfig(s,l)),_t(l,1),s=l}return o}},{key:"getDomainConfig",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[t.getMonth(),t.getFullYear()],i=n[0],r=n[1],a=xt(t),o={index:i,cols:[]};_t(e=pt(e)||bt(i,r),1);for(var s=gt(a,e),h=[],l=void 0,c=0;c<s;c++)l=this.getCol(a,i),h.push(l),_t(a=new Date(l[xe-1].yyyyMmDd),1);return void 0!==l[xe-1].dataValue&&(_t(a,1),h.push(this.getCol(a,i,!0))),o.cols=h,o}},{key:"getCol",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.state,r=pt(t),a=[],o=0;o<xe;o++,_t(r,1)){var s={},h=r>=i.start&&r<=i.end;n||r.getMonth()!==e||!h?s.yyyyMmDd=ft(r):s=this.getSubDomainConfig(r),a.push(s)}return a}},{key:"getSubDomainConfig",value:function(t){var e=ft(t),n=this.data.dataPoints[e];return{yyyyMmDd:e,dataValue:n||0,fill:this.colors[Dt(n,this.state.distribution)]}}}]),e}(me),Ee=function(t){function n(t,e){jt(this,n);var i=Wt(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i.barOptions=e.barOptions||{},i.lineOptions=e.lineOptions||{},i.type=e.type||"line",i.init=1,i.setup(),i}return Ht(n,t),zt(n,[{key:"setMeasures",value:function(){this.data.datasets.length<=1&&(this.config.showLegend=0,this.measures.paddings.bottom=30)}},{key:"configure",value:function(t){Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"configure",this).call(this,t),t.axisOptions=t.axisOptions||{},t.tooltipOptions=t.tooltipOptions||{},this.config.xAxisMode=t.axisOptions.xAxisMode||"span",this.config.yAxisMode=t.axisOptions.yAxisMode||"span",this.config.xIsSeries=t.axisOptions.xIsSeries||0,this.config.shortenYAxisNumbers=t.axisOptions.shortenYAxisNumbers||0,this.config.formatTooltipX=t.tooltipOptions.formatTooltipX,this.config.formatTooltipY=t.tooltipOptions.formatTooltipY,this.config.valuesOverPoints=t.valuesOverPoints}},{key:"prepareData",value:function(){return Gt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data,this.type)}},{key:"prepareFirstData",value:function(){return Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.data)}},{key:"calc",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.calcXPositions(),t||this.calcYAxisParameters(this.getAllYValues(),"line"===this.type),this.makeDataByIndex()}},{key:"calcXPositions",value:function(){var t=this.state,e=this.data.labels;t.datasetLength=e.length,t.unitWidth=this.width/t.datasetLength,t.xOffset=t.unitWidth/2,t.xAxis={labels:e,positions:e.map((function(e,n){return c(t.xOffset+n*t.unitWidth)}))}}},{key:"calcYAxisParameters",value:function(t){var e=Pt(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false"),n=this.height/Lt(e),i=At(e)*n,r=this.height-Tt(e)*i;this.state.yAxis={labels:e,positions:e.map((function(t){return r-t*n})),scaleMultiplier:n,zeroLine:r},this.calcDatasetPoints(),this.calcYExtremes(),this.calcYRegions()}},{key:"calcDatasetPoints",value:function(){var t=this.state,e=function(e){return e.map((function(e){return Et(e,t.yAxis)}))};t.datasets=this.data.datasets.map((function(t,n){var i=t.values,r=t.cumulativeYs||[];return{name:t.name&&t.name.replace(/<|>|&/g,(function(t){return"&"==t?"&amp;":"<"==t?"&lt;":"&gt;"})),index:n,chartType:t.chartType,values:i,yPositions:e(i),cumulativeYs:r,cumulativeYPos:e(r)}}))}},{key:"calcYExtremes",value:function(){var t=this.state;this.barOptions.stacked?t.yExtremes=t.datasets[t.datasets.length-1].cumulativeYPos:(t.yExtremes=new Array(t.datasetLength).fill(9999),t.datasets.map((function(e){e.yPositions.map((function(e,n){e<t.yExtremes[n]&&(t.yExtremes[n]=e)}))})))}},{key:"calcYRegions",value:function(){var t=this.state;this.data.yMarkers&&(this.state.yMarkers=this.data.yMarkers.map((function(e){return e.position=Et(e.value,t.yAxis),e.options||(e.options={}),e}))),this.data.yRegions&&(this.state.yRegions=this.data.yRegions.map((function(e){return e.startPos=Et(e.start,t.yAxis),e.endPos=Et(e.end,t.yAxis),e.options||(e.options={}),e})))}},{key:"getAllYValues",value:function(){var t,e=this,n="values";if(this.barOptions.stacked){n="cumulativeYs";var i=new Array(this.state.datasetLength).fill(0);this.data.datasets.map((function(t,r){var a=e.data.datasets[r].values;t[n]=i=i.map((function(t,e){return t+a[e]}))}))}var r=this.data.datasets.map((function(t){return t[n]}));return this.data.yMarkers&&r.push(this.data.yMarkers.map((function(t){return t.value}))),this.data.yRegions&&this.data.yRegions.map((function(t){r.push([t.end,t.start])})),(t=[]).concat.apply(t,Xt(r))}},{key:"setupComponents",value:function(){var t=this,e=[["yAxis",{mode:this.config.yAxisMode,width:this.width,shortenNumbers:this.config.shortenYAxisNumbers},function(){return this.state.yAxis}.bind(this)],["xAxis",{mode:this.config.xAxisMode,height:this.height},function(){var t=this.state;return t.xAxis.calcLabels=It(this.width,t.xAxis.labels,this.config.xIsSeries),t.xAxis}.bind(this)],["yRegions",{width:this.width,pos:"right"},function(){return this.state.yRegions}.bind(this)]],n=this.state.datasets.filter((function(t){return"bar"===t.chartType})),i=this.state.datasets.filter((function(t){return"line"===t.chartType})),r=n.map((function(e){var i=e.index;return["barGraph-"+e.index,{index:i,color:t.colors[i],stacked:t.barOptions.stacked,valuesOverPoints:t.config.valuesOverPoints,minHeight:0*t.height},function(){var t=this.state,e=t.datasets[i],r=this.barOptions.stacked,a=this.barOptions.spaceRatio||.5,o=t.unitWidth*(1-a),s=o/(r?1:n.length),h=t.xAxis.positions.map((function(t){return t-o/2}));r||(h=h.map((function(t){return t+s*i})));var l=new Array(t.datasetLength).fill("");this.config.valuesOverPoints&&(l=r&&e.index===t.datasets.length-1?e.cumulativeYs:e.values);var c=new Array(t.datasetLength).fill(0);return r&&(c=e.yPositions.map((function(t,n){return t-e.cumulativeYPos[n]}))),{xPositions:h,yPositions:e.yPositions,offsets:c,labels:l,zeroLine:t.yAxis.zeroLine,barsWidth:o,barWidth:s}}.bind(t)]})),a=i.map((function(e){var n=e.index;return["lineGraph-"+e.index,{index:n,color:t.colors[n],svgDefs:t.svgDefs,heatline:t.lineOptions.heatline,regionFill:t.lineOptions.regionFill,spline:t.lineOptions.spline,hideDots:t.lineOptions.hideDots,hideLine:t.lineOptions.hideLine,valuesOverPoints:t.config.valuesOverPoints},function(){var t=this.state,e=t.datasets[n],i=t.yAxis.positions[0]<t.yAxis.zeroLine?t.yAxis.positions[0]:t.yAxis.zeroLine;return{xPositions:t.xAxis.positions,yPositions:e.yPositions,values:e.values,zeroLine:i,radius:this.lineOptions.dotSize||4}}.bind(t)]})),o=[["yMarkers",{width:this.width,pos:"right"},function(){return this.state.yMarkers}.bind(this)]];e=e.concat(r,a,o);var s=["yMarkers","yRegions"];this.dataUnitComponents=[],this.components=new Map(e.filter((function(e){return!s.includes(e[0])||t.state[e[0]]})).map((function(e){var n=wt.apply(void 0,Xt(e));return(e[0].includes("lineGraph")||e[0].includes("barGraph"))&&t.dataUnitComponents.push(n),[e[0],n]})))}},{key:"makeDataByIndex",value:function(){var t=this;this.dataByIndex={};var e=this.state,n=this.config.formatTooltipX,i=this.config.formatTooltipY;e.xAxis.labels.map((function(r,a){var o=t.state.datasets.map((function(e,n){var r=e.values[a];return{title:e.name,value:r,yPos:e.yPositions[a],color:t.colors[n],formatted:i?i(r):r}}));t.dataByIndex[a]={label:r,formattedLabel:n?n(r):r,xPos:e.xAxis.positions[a],values:o,yExtreme:e.yExtremes[a]}}))}},{key:"bindTooltip",value:function(){var t=this;this.container.addEventListener("mousemove",(function(n){var i=t.measures,r=e(t.container),a=n.pageX-r.left-s(i),h=n.pageY-r.top;h<t.height+o(i)&&h>o(i)?t.mapTooltipXPosition(a):t.tip.hideTip()}))}},{key:"mapTooltipXPosition",value:function(t){var e=this.state;if(e.yExtremes){var n=Ot(t,e.xAxis.positions,!0);if(n>=0){var i=this.dataByIndex[n];this.tip.setValues(i.xPos+this.tip.offset.x,i.yExtreme+this.tip.offset.y,{name:i.formattedLabel,value:""},i.values,n),this.tip.showTip()}}}},{key:"renderLegend",value:function(){var t=this,e=this.data;e.datasets.length>1&&(this.legendArea.textContent="",e.datasets.map((function(e,n){var i=z(100*n,"0",100,t.colors[n],e.name,t.config.truncateLegends);t.legendArea.appendChild(i)})))}},{key:"makeOverlay",value:function(){var t=this;this.init?this.init=0:(this.overlayGuides&&this.overlayGuides.forEach((function(t){var e=t.overlay;e.parentNode.removeChild(e)})),this.overlayGuides=this.dataUnitComponents.map((function(t){return{type:t.unitType,overlay:void 0,units:t.units}})),void 0===this.state.currentIndex&&(this.state.currentIndex=this.state.datasetLength-1),this.overlayGuides.map((function(e){var n=e.units[t.state.currentIndex];e.overlay=le[e.type](n),t.drawArea.appendChild(e.overlay)})))}},{key:"updateOverlayGuides",value:function(){this.overlayGuides&&this.overlayGuides.forEach((function(t){var e=t.overlay;e.parentNode.removeChild(e)}))}},{key:"bindOverlay",value:function(){var t=this;this.parent.addEventListener("data-select",(function(){t.updateOverlay()}))}},{key:"bindUnits",value:function(){var t=this;this.dataUnitComponents.map((function(e){e.units.map((function(e){e.addEventListener("click",(function(){var n=e.getAttribute("data-point-index");t.setCurrentDataPoint(n)}))}))})),this.tip.container.addEventListener("click",(function(){var e=t.tip.container.getAttribute("data-point-index");t.setCurrentDataPoint(e)}))}},{key:"updateOverlay",value:function(){var t=this;this.overlayGuides.map((function(e){var n=e.units[t.state.currentIndex];ce[e.type](n,e.overlay)}))}},{key:"onLeftArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex-1)}},{key:"onRightArrow",value:function(){this.setCurrentDataPoint(this.state.currentIndex+1)}},{key:"getDataPoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.currentIndex,e=this.state;return{index:t,label:e.xAxis.labels[t],values:e.datasets.map((function(e){return e.values[t]}))}}},{key:"setCurrentDataPoint",value:function(t){var e=this.state;(t=parseInt(t))<0&&(t=0),t>=e.xAxis.labels.length&&(t=e.xAxis.labels.length-1),t!==e.currentIndex&&(e.currentIndex=t,a(this.parent,"data-select",this.getDataPoint()))}},{key:"addDataPoint",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.state.datasetLength;Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"addDataPoint",this).call(this,t,e,i),this.data.labels.splice(i,0,t),this.data.datasets.map((function(t,n){t.values.splice(i,0,e[n])})),this.update(this.data)}},{key:"removeDataPoint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.datasetLength-1;this.data.labels.length<=1||(Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"removeDataPoint",this).call(this,t),this.data.labels.splice(t,1),this.data.datasets.map((function(e){e.values.splice(t,1)})),this.update(this.data))}},{key:"updateDataset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.data.datasets[e].values=t,this.update(this.data)}},{key:"updateDatasets",value:function(t){this.data.datasets.map((function(e,n){t[n]&&(e.values=t[n])})),this.update(this.data)}}]),n}(me),Oe=function(t){function n(t,e){jt(this,n);var i=Wt(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i.type="donut",i.initTimeout=0,i.init=1,i.setup(),i}return Ht(n,t),zt(n,[{key:"configure",value:function(t){Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"configure",this).call(this,t),this.mouseMove=this.mouseMove.bind(this),this.mouseLeave=this.mouseLeave.bind(this),this.hoverRadio=t.hoverRadio||.1,this.config.startAngle=t.startAngle||0,this.clockWise=t.clockWise||!1,this.strokeWidth=t.strokeWidth||30}},{key:"calc",value:function(){var t=this;Bt(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"calc",this).call(this);var e=this.state;this.radius=this.height>this.width?this.center.x-this.strokeWidth/2:this.center.y-this.strokeWidth/2;var i=this.radius,r=this.clockWise,a=e.slicesProperties||[];e.sliceStrings=[],e.slicesProperties=[];var o=180-this.config.startAngle;e.sliceTotals.map((function(n,s){var h=o,l=n/e.grandTotal*360,c=l>180?1:0,d=r?-l:l,u=o+=d,p=f(h,i),g=f(u,i),v=t.init&&a[s],y=void 0,m=void 0;t.init?(y=v?v.startPosition:p,m=v?v.endPosition:p):(y=p,m=g);var b=360===l?I(y,m,t.center,t.radius,t.clockWise,c):R(y,m,t.center,t.radius,t.clockWise,c);e.sliceStrings.push(b),e.slicesProperties.push({startPosition:p,endPosition:g,value:n,total:e.grandTotal,startAngle:h,endAngle:u,angle:d})})),this.init=0}},{key:"setupComponents",value:function(){var t=this.state,e=[["donutSlices",{},function(){return{sliceStrings:t.sliceStrings,colors:this.colors,strokeWidth:this.strokeWidth}}.bind(this)]];this.components=new Map(e.map((function(t){var e=wt.apply(void 0,Xt(t));return[t[0],e]})))}},{key:"calTranslateByAngle",value:function(t){var e=this.radius,n=this.hoverRadio,i=f(t.startAngle+t.angle/2,e);return"translate3d("+i.x*n+"px,"+i.y*n+"px,0)"}},{key:"hoverSlice",value:function(t,n,i,r){if(t){var a=this.colors[n];if(i){st(t,this.calTranslateByAngle(this.state.slicesProperties[n])),t.style.stroke=S(a,50);var o=e(this.svg),s=r.pageX-o.left+10,h=r.pageY-o.top-10,l=(this.formatted_labels&&this.formatted_labels.length>0?this.formatted_labels[n]:this.state.labels[n])+": ",c=(100*this.state.sliceTotals[n]/this.state.grandTotal).toFixed(1);this.tip.setValues(s,h,{name:l,value:c+"%"}),this.tip.showTip()}else st(t,"translate3d(0,0,0)"),this.tip.hideTip(),t.style.stroke=a}}},{key:"bindTooltip",value:function(){this.container.addEventListener("mousemove",this.mouseMove),this.container.addEventListener("mouseleave",this.mouseLeave)}},{key:"mouseMove",value:function(t){var e=t.target,n=this.components.get("donutSlices").store,i=this.curActiveSliceIndex,r=this.curActiveSlice;if(n.includes(e)){var a=n.indexOf(e);this.hoverSlice(r,i,!1),this.curActiveSlice=e,this.curActiveSliceIndex=a,this.hoverSlice(e,a,!0,t)}else this.mouseLeave()}},{key:"mouseLeave",value:function(){this.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,!1)}}]),n}(be),Me={bar:Ee,line:Ee,percentage:Te,heatmap:Le,pie:Ae,donut:Oe},De=function t(e,n){return jt(this,t),Nt(n.type,e,n)},Ge=Object.freeze({Chart:De,PercentageChart:Te,PieChart:Ae,Heatmap:Le,AxisChart:Ee}),Re={NAME:"Frappe Charts",VERSION:"1.6.2"};return Object.assign({},Re,Ge)}()}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,n),a.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i={};(()=>{"use strict";n.d(i,{O9:()=>Ii,DN:()=>Gi,Ej:()=>Fi,s8:()=>Ni,mL:()=>Ri,tv:()=>ji});var t=Math.PI/180;const e="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},r={_global:e,version:"8.4.2",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:e=>r.angleDeg?e*t:e,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>r.DD.isDragging,isDragReady:()=>!!r.DD.node,releaseCanvasOnDestroy:!0,document:e.document,_injectGlobal(t){e.Konva=t}},a=t=>{r[t.prototype.getClassName()]=t};r._injectGlobal(r);class o{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new o(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){var e=Math.cos(t),n=Math.sin(t),i=this.m[0]*e+this.m[2]*n,r=this.m[1]*e+this.m[3]*n,a=this.m[0]*-n+this.m[2]*e,o=this.m[1]*-n+this.m[3]*e;return this.m[0]=i,this.m[1]=r,this.m[2]=a,this.m[3]=o,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){var n=this.m[0]+this.m[2]*e,i=this.m[1]+this.m[3]*e,r=this.m[2]+this.m[0]*t,a=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=i,this.m[2]=r,this.m[3]=a,this}multiply(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],i=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=a,this.m[5]=o,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,i=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=a,this.m[5]=o,this}getMatrix(){return this.m}decompose(){var t=this.m[0],e=this.m[1],n=this.m[2],i=this.m[3],r=t*i-e*n;let a={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){var o=Math.sqrt(t*t+e*e);a.rotation=e>0?Math.acos(t/o):-Math.acos(t/o),a.scaleX=o,a.scaleY=r/o,a.skewX=(t*n+e*i)/r,a.skewY=0}else if(0!=n||0!=i){var s=Math.sqrt(n*n+i*i);a.rotation=Math.PI/2-(i>0?Math.acos(-n/s):-Math.acos(n/s)),a.scaleX=r/s,a.scaleY=s,a.skewX=0,a.skewY=(t*n+e*i)/r}return a.rotation=p._getRotation(a.rotation),a}}var s=Math.PI/180,h=180/Math.PI,l="Konva error: ",c={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,u=[];const f="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},p={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;var e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){u.push(t),1===u.length&&f((function(){const t=u;u=[],t.forEach((function(t){t()}))}))},createCanvasElement(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>document.createElement("img"),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){var n=p.createImageElement();n.onload=function(){e(n)},n.src=t},_rgbToHex:(t,e,n)=>((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t="0"+t;return"#"+t},getRGB(t){var e;return t in c?{r:(e=c[t])[0],g:e[1],b:e[2]}:"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=d.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",p._namedColorToRBA(t)||p._hex3ColorToRGBA(t)||p._hex4ColorToRGBA(t)||p._hex6ColorToRGBA(t)||p._hex8ColorToRGBA(t)||p._rgbColorToRGBA(t)||p._rgbaColorToRGBA(t)||p._hslColorToRGBA(t)),_namedColorToRBA(t){var e=c[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){var e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){var e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t)));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),i=Number(n[0])/360,r=Number(n[1])/100,a=Number(n[2])/100;let o,s,h;if(0===r)return h=255*a,{r:Math.round(h),g:Math.round(h),b:Math.round(h),a:1};o=a<.5?a*(1+r):a+r-a*r;const l=2*a-o,c=[0,0,0];for(let t=0;t<3;t++)s=i+1/3*-(t-1),s<0&&s++,s>1&&s--,h=6*s<1?l+6*(o-l)*s:2*s<1?o:3*s<2?l+(o-l)*(2/3-s)*6:l,c[t]=255*h;return{r:Math.round(c[0]),g:Math.round(c[1]),b:Math.round(c[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){var e={};for(var n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*s,radToDeg:t=>t*h,_degToRad:t=>(p.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),p.degToRad(t)),_radToDeg:t=>(p.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),p.radToDeg(t)),_getRotation:t=>r.angleDeg?p.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(l+t)},error(t){console.error(l+t)},warn(t){r.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(var n in t)e(n,t[n])},_inRange:(t,e,n)=>e<=t&&t<n,_getProjectionToSegment(t,e,n,i,r,a){var o,s,h,l=(t-n)*(t-n)+(e-i)*(e-i);if(0==l)o=t,s=e,h=(r-n)*(r-n)+(a-i)*(a-i);else{var c=((r-t)*(n-t)+(a-e)*(i-e))/l;c<0?(o=t,s=e,h=(t-r)*(t-r)+(e-a)*(e-a)):c>1?(o=n,s=i,h=(n-r)*(n-r)+(i-a)*(i-a)):h=((o=t+c*(n-t))-r)*(o-r)+((s=e+c*(i-e))-a)*(s-a)}return[o,s,h]},_getProjectionToLine(t,e,n){var i=p.cloneObject(t),r=Number.MAX_VALUE;return e.forEach((function(a,o){if(n||o!==e.length-1){var s=e[(o+1)%e.length],h=p._getProjectionToSegment(a.x,a.y,s.x,s.y,t.x,t.y),l=h[0],c=h[1],d=h[2];d<r&&(i.x=l,i.y=c,r=d)}})),i},_prepareArrayForTween(t,e,n){var i,r=[],a=[];if(t.length>e.length){var o=e;e=t,t=o}for(i=0;i<t.length;i+=2)r.push({x:t[i],y:t[i+1]});for(i=0;i<e.length;i+=2)a.push({x:e[i],y:e[i+1]});var s=[];return a.forEach((function(t){var e=p._getProjectionToLine(t,r,n);s.push(e.x),s.push(e.y)})),s},_prepareToStringify(t){var e;for(var n in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n])if(e=Object.getOwnPropertyDescriptor(t,n),t[n].visitedByCircularReferenceRemoval||p._isElement(t[n])){if(!e.configurable)return null;delete t[n]}else if(null===p._prepareToStringify(t[n])){if(!e.configurable)return null;delete t[n]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(var n in e)t[n]=e[n];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){r.releaseCanvasOnDestroy&&t.forEach((t=>{t.width=0,t.height=0}))},drawRoundedRectPath(t,e,n,i){let r=0,a=0,o=0,s=0;"number"==typeof i?r=a=o=s=Math.min(i,e/2,n/2):(r=Math.min(i[0]||0,e/2,n/2),a=Math.min(i[1]||0,e/2,n/2),s=Math.min(i[2]||0,e/2,n/2),o=Math.min(i[3]||0,e/2,n/2)),t.moveTo(r,0),t.lineTo(e-a,0),t.arc(e-a,a,a,3*Math.PI/2,0,!1),t.lineTo(e,n-s),t.arc(e-s,n-s,s,0,Math.PI/2,!1),t.lineTo(o,n),t.arc(o,n-o,o,Math.PI/2,Math.PI,!1),t.lineTo(0,r),t.arc(r,r,r,Math.PI,3*Math.PI/2,!1)}};function g(t){return p._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||p._isBoolean(t)?t:Object.prototype.toString.call(t)}function v(t){return t>255?255:t<0?0:Math.round(t)}function y(){if(r.isUnminified)return function(t,e){return p._isNumber(t)||p.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function m(t){if(r.isUnminified)return function(e,n){let i=p._isNumber(e),r=p._isArray(e)&&e.length==t;return i||r||p.warn(g(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function b(){if(r.isUnminified)return function(t,e){return p._isNumber(t)||"auto"===t||p.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function x(){if(r.isUnminified)return function(t,e){return p._isString(t)||p.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function _(){if(r.isUnminified)return function(t,e){const n=p._isString(t),i="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return n||i||p.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function w(){if(r.isUnminified)return function(t,e){return!0===t||!1===t||p.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}var S="get",k="set";const C={addGetterSetter(t,e,n,i,r){C.addGetter(t,e,n),C.addSetter(t,e,i,r),C.addOverloadedGetterSetter(t,e)},addGetter(t,e,n){var i=S+p._capitalize(e);t.prototype[i]=t.prototype[i]||function(){var t=this.attrs[e];return void 0===t?n:t}},addSetter(t,e,n,i){var r=k+p._capitalize(e);t.prototype[r]||C.overWriteSetter(t,e,n,i)},overWriteSetter(t,e,n,i){var r=k+p._capitalize(e);t.prototype[r]=function(t){return n&&null!=t&&(t=n.call(this,t,e)),this._setAttr(e,t),i&&i.call(this),this}},addComponentsGetterSetter(t,e,n,i,a){var o,s,h=n.length,l=p._capitalize,c=S+l(e),d=k+l(e);t.prototype[c]=function(){var t={};for(o=0;o<h;o++)t[s=n[o]]=this.getAttr(e+l(s));return t};var u=function(t){if(r.isUnminified)return function(e,n){return null==e||p.isObject(e)||p.warn(g(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(n);t.prototype[d]=function(t){var r,o=this.attrs[e];for(r in i&&(t=i.call(this,t)),u&&u.call(this,t,e),t)t.hasOwnProperty(r)&&this._setAttr(e+l(r),t[r]);return t||n.forEach((t=>{this._setAttr(e+l(t),void 0)})),this._fireChangeEvent(e,o,t),a&&a.call(this),this},C.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){var n=p._capitalize(e),i=k+n,r=S+n;t.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[r]()}},addDeprecatedGetterSetter(t,e,n,i){p.error("Adding deprecated "+e);var r=S+p._capitalize(e),a=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[r]=function(){p.error(a);var t=this.attrs[e];return void 0===t?n:t},C.addSetter(t,e,i,(function(){p.error(a)})),C.addOverloadedGetterSetter(t,e)},backCompat(t,e){p.each(e,(function(e,n){var i=t.prototype[n],r=S+p._capitalize(e),a=k+p._capitalize(e);function o(){i.apply(this,arguments),p.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}t.prototype[e]=o,t.prototype[r]=o,t.prototype[a]=o}))},afterSetFilter(){this._filterUpToDate=!1}};var P=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];class T{constructor(t){this.canvas=t,r.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var n,i,r,a,o=this.traceArr,s=o.length,h="";for(n=0;n<s;n++)(r=(i=o[n]).method)?(a=i.args,h+=r,t?h+="()":p._isArray(a[0])?h+="(["+a.join(",")+"])":(e&&(a=a.map((t=>"number"==typeof t?Math.floor(t):t))),h+="("+a.join(",")+")")):(h+=i.property,t||(h+="="+i.val)),h+=";";return h}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr;e.push(t),e.length>=100&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){var e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,n,i,r,a){this._context.arc(t,e,n,i,r,a)}arcTo(t,e,n,i,r){this._context.arcTo(t,e,n,i,r)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,n,i,r,a){this._context.bezierCurveTo(t,e,n,i,r,a)}clearRect(t,e,n,i){this._context.clearRect(t,e,n,i)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(t,e){var n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,n,i){return this._context.createLinearGradient(t,e,n,i)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,n,i,r,a){return this._context.createRadialGradient(t,e,n,i,r,a)}drawImage(t,e,n,i,r,a,o,s,h){var l=arguments,c=this._context;3===l.length?c.drawImage(t,e,n):5===l.length?c.drawImage(t,e,n,i,r):9===l.length&&c.drawImage(t,e,n,i,r,a,o,s,h)}ellipse(t,e,n,i,r,a,o,s){this._context.ellipse(t,e,n,i,r,a,o,s)}isPointInPath(t,e,n,i){return n?this._context.isPointInPath(n,t,e,i):this._context.isPointInPath(t,e,i)}fill(t){t?this._context.fill(t):this._context.fill()}fillRect(t,e,n,i){this._context.fillRect(t,e,n,i)}strokeRect(t,e,n,i){this._context.strokeRect(t,e,n,i)}fillText(t,e,n,i){i?this._context.fillText(t,e,n,i):this._context.fillText(t,e,n)}measureText(t){return this._context.measureText(t)}getImageData(t,e,n,i){return this._context.getImageData(t,e,n,i)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,n,i){this._context.rect(t,e,n,i)}putImageData(t,e,n){this._context.putImageData(t,e,n)}quadraticCurveTo(t,e,n,i){this._context.quadraticCurveTo(t,e,n,i)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,n,i,r,a){this._context.setTransform(t,e,n,i,r,a)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,n,i){this._context.strokeText(t,e,n,i)}transform(t,e,n,i,r,a){this._context.transform(t,e,n,i,r,a)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t,e,n=this,i=P.length,r=this.setAttr,a=function(t){var i,r=n[t];n[t]=function(){return e=function(t){var e,n,i=[],r=t.length,a=p;for(e=0;e<r;e++)n=t[e],a._isNumber(n)?n=Math.round(1e3*n)/1e3:a._isString(n)||(n+=""),i.push(n);return i}(Array.prototype.slice.call(arguments,0)),i=r.apply(n,arguments),n._trace({method:t,args:e}),i}};for(t=0;t<i;t++)a(P[t]);n.setAttr=function(){r.apply(n,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),n._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach((function(t){Object.defineProperty(T.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})}));class A extends T{constructor(t){super(t),this._context=t._canvas.getContext("2d")}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){var e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)this._fillColor(t);else{var i=t.getFillPatternImage();if(i&&"pattern"===n)this._fillPattern(t);else{var r=t.getFillLinearGradientColorStops();if(r&&"linear-gradient"===n)this._fillLinearGradient(t);else{var a=t.getFillRadialGradientColorStops();a&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):i?this._fillPattern(t):r?this._fillLinearGradient(t):a&&this._fillRadialGradient(t)}}}}_strokeLinearGradient(t){var e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),i=t.getStrokeLinearGradientColorStops(),r=this.createLinearGradient(e.x,e.y,n.x,n.y);if(i){for(var a=0;a<i.length;a+=2)r.addColorStop(i[a],i[a+1]);this.setAttr("strokeStyle",r)}}_stroke(t){var e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var e,n,i,r=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",a=null!==(n=t.getShadowBlur())&&void 0!==n?n:5,o=null!==(i=t.getShadowOffset())&&void 0!==i?i:{x:0,y:0},s=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),l=s.x*h,c=s.y*h;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",a*Math.min(Math.abs(l),Math.abs(c))),this.setAttr("shadowOffsetX",o.x*l),this.setAttr("shadowOffsetY",o.y*c)}}class L extends T{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t);var i=t.hitStrokeWidth(),r="auto"===i?t.strokeWidth():i;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}var E;class O{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||r.pixelRatio||function(){if(E)return E;var t=p.createCanvasElement(),e=t.getContext("2d");return E=(r._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),p.releaseCanvas(t),E}();this.pixelRatio=e,this._canvas=p.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return p.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}C.addGetterSetter(O,"pixelRatio",void 0,y());class M extends O{constructor(t={width:0,height:0}){super(t),this.context=new A(this),this.setSize(t.width,t.height)}}class D extends O{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new L(this),this.setSize(t.width,t.height)}}const G={get isDragging(){var t=!1;return G._dragElements.forEach((e=>{"dragging"===e.dragStatus&&(t=!0)})),t},justDragged:!1,get node(){var t;return G._dragElements.forEach((e=>{t=e.node})),t},_dragElements:new Map,_drag(t){const e=[];G._dragElements.forEach(((n,i)=>{const{node:r}=n,a=r.getStage();a.setPointersPositions(t),void 0===n.pointerId&&(n.pointerId=p._getFirstPointerId(t));const o=a._changedPointerPositions.find((t=>t.id===n.pointerId));if(o){if("dragging"!==n.dragStatus){var s=r.dragDistance();if(Math.max(Math.abs(o.x-n.startPointerPos.x),Math.abs(o.y-n.startPointerPos.y))<s)return;if(r.startDrag({evt:t}),!r.isDragging())return}r._setDragPosition(t,n),e.push(r)}})),e.forEach((e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)}))},_endDragBefore(t){const e=[];G._dragElements.forEach((n=>{const{node:i}=n,a=i.getStage();t&&a.setPointersPositions(t);if(!a._changedPointerPositions.find((t=>t.id===n.pointerId)))return;"dragging"!==n.dragStatus&&"stopped"!==n.dragStatus||(G.justDragged=!0,r._mouseListenClick=!1,r._touchListenClick=!1,r._pointerListenClick=!1,n.dragStatus="stopped");const o=n.node.getLayer()||n.node instanceof r.Stage&&n.node;o&&-1===e.indexOf(o)&&e.push(o)})),e.forEach((t=>{t.draw()}))},_endDragAfter(t){G._dragElements.forEach(((e,n)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&G._dragElements.delete(n)}))}};r.isBrowser&&(window.addEventListener("mouseup",G._endDragBefore,!0),window.addEventListener("touchend",G._endDragBefore,!0),window.addEventListener("mousemove",G._drag),window.addEventListener("touchmove",G._drag),window.addEventListener("mouseup",G._endDragAfter,!1),window.addEventListener("touchend",G._endDragAfter,!1));var R="absoluteOpacity",I="allEventListeners",N="absoluteTransform",F="absoluteScale",j="canvas",z="listening",B="mouseenter",H="mouseleave",W="Shape",Y=" ",X="stage",q="transform",U="visible",V=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Y);let K=1;class J{constructor(t){this._id=K++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==q&&t!==N||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){var n=this._cache.get(t);return(void 0===n||(t===q||t===N)&&!0===n.dirty)&&(n=e.call(this),this._cache.set(t,n)),n}_calculate(t,e,n){if(!this._attachedDepsListeners.get(t)){const n=e.map((t=>t+"Change.konva")).join(Y);this.on(n,(()=>{this._clearCache(t)})),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get(j)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===N&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(j)){const{scene:t,filter:e,hit:n}=this._cache.get(j);p.releaseCanvas(t,e,n),this._cache.delete(j)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},n={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var i=Math.ceil(e.width||n.width),r=Math.ceil(e.height||n.height),a=e.pixelRatio,o=void 0===e.x?Math.floor(n.x):e.x,s=void 0===e.y?Math.floor(n.y):e.y,h=e.offset||0,l=e.drawBorder||!1,c=e.hitCanvasPixelRatio||1;if(i&&r){o-=h,s-=h;var d=new M({pixelRatio:a,width:i+=2*h+1,height:r+=2*h+1}),u=new M({pixelRatio:a,width:0,height:0}),f=new D({pixelRatio:c,width:i,height:r}),g=d.getContext(),v=f.getContext();return f.isCache=!0,d.isCache=!0,this._cache.delete(j),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(d.getContext()._context.imageSmoothingEnabled=!1,u.getContext()._context.imageSmoothingEnabled=!1),g.save(),v.save(),g.translate(-o,-s),v.translate(-o,-s),this._isUnderCache=!0,this._clearSelfAndDescendantCache(R),this._clearSelfAndDescendantCache(F),this.drawScene(d,this),this.drawHit(f,this),this._isUnderCache=!1,g.restore(),v.restore(),l&&(g.save(),g.beginPath(),g.rect(0,0,i,r),g.closePath(),g.setAttr("strokeStyle","red"),g.setAttr("lineWidth",5),g.stroke(),g.restore()),this._cache.set(j,{scene:d,filter:u,hit:f,x:o,y:s}),this._requestDraw(),this}p.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")}isCached(){return this._cache.has(j)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var n,i,r,a,o=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],s=this.getAbsoluteTransform(e);return o.forEach((function(t){var e=s.point(t);void 0===n&&(n=r=e.x,i=a=e.y),n=Math.min(n,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),a=Math.max(a,e.y)})),{x:n,y:i,width:r-n,height:a-i}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var n=this._getCachedSceneCanvas(),i=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/i,n.height/i),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t,e,n,i,r=this.filters(),a=this._getCanvasCache(),o=a.scene,s=a.filter,h=s.getContext();if(r){if(!this._filterUpToDate){var l=o.pixelRatio;s.setSize(o.width/o.pixelRatio,o.height/o.pixelRatio);try{for(t=r.length,h.clear(),h.drawImage(o._canvas,0,0,o.getWidth()/l,o.getHeight()/l),e=h.getImageData(0,0,s.getWidth(),s.getHeight()),n=0;n<t;n++)"function"==typeof(i=r[n])?(i.call(this,e),h.putImageData(e,0,0)):p.error("Filter should be type of function, but got "+typeof i+" instead. Please check correct filters")}catch(t){p.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return s}return o}on(t,e){if(this._cache&&this._cache.delete(I),3===arguments.length)return this._delegate.apply(this,arguments);var n,i,r,a,o=t.split(Y),s=o.length;for(n=0;n<s;n++)r=(i=o[n].split("."))[0],a=i[1]||"",this.eventListeners[r]||(this.eventListeners[r]=[]),this.eventListeners[r].push({name:a,handler:e});return this}off(t,e){var n,i,r,a,o,s=(t||"").split(Y),h=s.length;if(this._cache&&this._cache.delete(I),!t)for(i in this.eventListeners)this._off(i);for(n=0;n<h;n++)if(a=(r=s[n].split("."))[0],o=r[1],a)this.eventListeners[a]&&this._off(a,o,e);else for(i in this.eventListeners)this._off(i,o,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,(function(t){e.call(this,t.evt)})),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,n){var i=this;this.on(t,(function(t){for(var r=t.target.findAncestors(e,!0,i),a=0;a<r.length;a++)(t=p.cloneObject(t)).currentTarget=r[a],n.call(r[a],t)}))}remove(){return this.isDragging()&&this.stopDrag(),G._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(R),this._clearSelfAndDescendantCache(F),this._clearSelfAndDescendantCache(X),this._clearSelfAndDescendantCache(U),this._clearSelfAndDescendantCache(z)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+p._capitalize(t);return p._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges((()=>{var e,n;if(!t)return this;for(e in t)"children"!==e&&(n="set"+p._capitalize(e),p._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]))})),this}isListening(){return this._getCache(z,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(U,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var n=this.getLayer(),i=!1;G._dragElements.forEach((t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===n)&&(i=!0)}));var a=!e&&!r.hitOnDragEnabled&&i;return this.isListening()&&this.isVisible()&&!a}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t,e,n,i,r=this.getDepth(),a=this,o=0;return"Stage"!==a.nodeType&&function s(h){for(t=[],e=h.length,n=0;n<e;n++)i=h[n],o++,i.nodeType!==W&&(t=t.concat(i.getChildren().slice())),i._id===a._id&&(n=e);t.length>0&&t[0].getDepth()<=r&&s(t)}(a.getStage().getChildren()),o}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(q),this._clearSelfAndDescendantCache(N)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges((()=>{this.x(t.x),this.y(t.y)})),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var t=this.getStage().getPointerPosition();if(!t)return null;var e=this.getAbsoluteTransform().copy();return e.invert(),e.point(t)}getAbsolutePosition(t){let e=!1,n=this.parent;for(;n;){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);var i=this.getAbsoluteTransform(t).getMatrix(),r=new o,a=this.offset();return r.m=i.slice(),r.translate(a.x,a.y),r.getTranslation()}setAbsolutePosition(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache(q);var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(t.x,t.y),t={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache(q),this._clearSelfAndDescendantCache(N),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,n=t.y,i=this.x(),r=this.y();return void 0!==e&&(i+=e),void 0!==n&&(r+=n),this.setPosition({x:i,y:r}),this}_eachAncestorReverse(t,e){var n,i,r=[],a=this.getParent();if(!e||e._id!==this._id){for(r.unshift(this);a&&(!e||a._id!==e._id);)r.unshift(a),a=a.parent;for(n=r.length,i=0;i<n;i++)t(r[i])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return p.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return p.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return p.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return p.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return p.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&p.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(R,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t,e,n,i,r={},a=this.getAttrs();for(t in r.attrs={},a)e=a[t],p.isObject(e)&&!p._isPlainObject(e)&&!p._isArray(e)||(n="function"==typeof this[t]&&this[t],delete a[t],i=n?n.call(this):null,a[t]=e,i!==e&&(r.attrs[t]=e));return r.className=this.getClassName(),p._prepareToStringify(r)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,n){var i=[];e&&this._isMatch(t)&&i.push(this);for(var r=this.parent;r;){if(r===n)return i;r._isMatch(t)&&i.push(r),r=r.parent}return i}isAncestorOf(t){return!1}findAncestor(t,e,n){return this.findAncestors(t,e,n)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);var e,n,i=t.replace(/ /g,"").split(","),r=i.length;for(e=0;e<r;e++)if(n=i[e],p.isValidSelector(n)||(p.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),p.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),p.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(X,this._getStage)}_getStage(){var t=this.getParent();return t?t.getStage():void 0}fire(t,e={},n){return e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(N,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new o,this._eachAncestorReverse((function(t){var n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())}),t),e;e=this._cache.get(N)||new o,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var n=this.transformsEnabled();if("all"===n)e.multiply(this.getTransform());else if("position"===n){const t=this.attrs.x||0,n=this.attrs.y||0,i=this.attrs.offsetX||0,r=this.attrs.offsetY||0;e.translate(t-i,n-r)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(q,this._getTransform)}_getTransform(){var t,e,n=this._cache.get(q)||new o;n.reset();var i=this.x(),a=this.y(),s=r.getAngle(this.rotation()),h=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,l=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,c=this.attrs.skewX||0,d=this.attrs.skewY||0,u=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return 0===i&&0===a||n.translate(i,a),0!==s&&n.rotate(s),0===c&&0===d||n.skew(c,d),1===h&&1===l||n.scale(h,l),0===u&&0===f||n.translate(-1*u,-1*f),n.dirty=!1,n}clone(t){var e,n,i,r,a,o=p.cloneObject(this.attrs);for(e in t)o[e]=t[e];var s=new this.constructor(o);for(e in this.eventListeners)for(i=(n=this.eventListeners[e]).length,r=0;r<i;r++)(a=n[r]).name.indexOf("konva")<0&&(s.eventListeners[e]||(s.eventListeners[e]=[]),s.eventListeners[e].push(a));return s}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),n=this.getStage(),i=void 0!==t.x?t.x:Math.floor(e.x),r=void 0!==t.y?t.y:Math.floor(e.y),a=t.pixelRatio||1,o=new M({width:t.width||Math.ceil(e.width)||(n?n.width():0),height:t.height||Math.ceil(e.height)||(n?n.height():0),pixelRatio:a}),s=o.getContext();return!1===t.imageSmoothingEnabled&&(s._context.imageSmoothingEnabled=!1),s.save(),(i||r)&&s.translate(-1*i,-1*r),this.drawScene(o),s.restore(),o}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){var e=(t=t||{}).mimeType||null,n=t.quality||null,i=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(i),i}toImage(t){return new Promise(((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,p._urlToImage(this.toDataURL(t),(function(t){e(t),null==n||n(t)}))}catch(t){n(t)}}))}toBlob(t){return new Promise(((e,n)=>{try{const n=null==t?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob((t=>{e(t),null==n||n(t)}))}catch(t){n(t)}}))}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():r.dragDistance}_off(t,e,n){var i,r,a,o=this.eventListeners[t];for(i=0;i<o.length;i++)if(r=o[i].name,a=o[i].handler,!("konva"===r&&"konva"!==e||e&&r!==e||n&&n!==a)){if(o.splice(i,1),0===o.length){delete this.eventListeners[t];break}i--}}_fireChangeEvent(t,e,n){this._fire(t+"Change",{oldVal:e,newVal:n})}addName(t){if(!this.hasName(t)){var e=this.name(),n=e?e+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){var e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.name(e.join(" "))),this}setAttr(t,e){var n=this["set"+p._capitalize(t)];return p._isFunction(n)?n.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(r.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){var n=this.attrs[t];(n!==e||p.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,e),this._requestDraw())}_setComponentAttr(t,e,n){var i;void 0!==n&&((i=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,i,n))}_fireAndBubble(t,e,n){if(e&&this.nodeType===W&&(e.target=this),!((t===B||t===H)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(t,e);var i=(t===B||t===H)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){let e=this._cache.get(I);if(!e){e={};let t=Object.getPrototypeOf(this);for(;t;)if(t.eventListeners){for(var n in t.eventListeners){const i=t.eventListeners[n],r=e[n]||[];e[n]=i.concat(r)}t=Object.getPrototypeOf(t)}else t=Object.getPrototypeOf(t);this._cache.set(I,e)}return e[t]}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const n=this._getProtoListeners(t);if(n)for(var i=0;i<n.length;i++)n[i].handler.call(this,e);const r=this.eventListeners[t];if(r)for(i=0;i<r.length;i++)r[i].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,n=this.getStage(),i=this.getAbsolutePosition(),r=n._getPointerById(e)||n._changedPointerPositions[0]||i;G._dragElements.set(this._id,{node:this,startPointerPos:r,offset:{x:r.x-i.x,y:r.y-i.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){G._dragElements.has(this._id)||this._createDragElement(t);G._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const n=this.getStage()._getPointerById(e.pointerId);if(n){var i={x:n.x-e.offset.x,y:n.y-e.offset.y},r=this.dragBoundFunc();if(void 0!==r){const e=r.call(this,i,t);e?i=e:p.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}}stopDrag(t){const e=G._dragElements.get(this._id);e&&(e.dragStatus="stopped"),G._endDragBefore(t),G._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=G._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(t){if((!(void 0!==t.evt.button)||r.dragButtons.indexOf(t.evt.button)>=0)&&!this.isDragging()){var e=!1;G._dragElements.forEach((t=>{this.isAncestorOf(t.node)&&(e=!0)})),e||this._createDragElement(t)}}))}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=G._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,n=t&&"ready"===t.dragStatus;e?this.stopDrag():n&&G._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const n={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return p.haveIntersection(n,this.getClientRect())}static create(t,e){return p._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var n,i,a,o=J.prototype.getClassName.call(t),s=t.children;e&&(t.attrs.container=e),r[o]||(p.warn('Can not find a node with class name "'+o+'". Fallback to "Shape".'),o="Shape");if(n=new(0,r[o])(t.attrs),s)for(i=s.length,a=0;a<i;a++)n.add(J._createNode(s[a]));return n}}J.prototype.nodeType="Node",J.prototype._attrsAffectingSize=[],J.prototype.eventListeners={},J.prototype.on.call(J.prototype,V,(function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(q),this._clearSelfAndDescendantCache(N))})),J.prototype.on.call(J.prototype,"visibleChange.konva",(function(){this._clearSelfAndDescendantCache(U)})),J.prototype.on.call(J.prototype,"listeningChange.konva",(function(){this._clearSelfAndDescendantCache(z)})),J.prototype.on.call(J.prototype,"opacityChange.konva",(function(){this._clearSelfAndDescendantCache(R)}));const Q=C.addGetterSetter;Q(J,"zIndex"),Q(J,"absolutePosition"),Q(J,"position"),Q(J,"x",0,y()),Q(J,"y",0,y()),Q(J,"globalCompositeOperation","source-over",x()),Q(J,"opacity",1,y()),Q(J,"name","",x()),Q(J,"id","",x()),Q(J,"rotation",0,y()),C.addComponentsGetterSetter(J,"scale",["x","y"]),Q(J,"scaleX",1,y()),Q(J,"scaleY",1,y()),C.addComponentsGetterSetter(J,"skew",["x","y"]),Q(J,"skewX",0,y()),Q(J,"skewY",0,y()),C.addComponentsGetterSetter(J,"offset",["x","y"]),Q(J,"offsetX",0,y()),Q(J,"offsetY",0,y()),Q(J,"dragDistance",null,y()),Q(J,"width",0,y()),Q(J,"height",0,y()),Q(J,"listening",!0,w()),Q(J,"preventDefault",!0,w()),Q(J,"filters",null,(function(t){return this._filterUpToDate=!1,t})),Q(J,"visible",!0,w()),Q(J,"transformsEnabled","all",x()),Q(J,"size"),Q(J,"dragBoundFunc"),Q(J,"draggable",!1,w()),C.backCompat(J,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class $ extends J{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var n=[];return e.forEach((function(e){t(e)&&n.push(e)})),n}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0,t.remove()})),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0,t.destroy()})),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const n=t[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var n=[];return this._descendants((i=>{const r=i._isMatch(t);return r&&n.push(i),!(!r||!e)})),n}_descendants(t){let e=!1;const n=this.getChildren();for(const i of n){if(e=t(i),e)return!0;if(i.hasChildren()&&(e=i._descendants(t),e))return!0}return!1}toObject(){var t=J.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach((e=>{t.children.push(e.toObject())})),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=J.prototype.clone.call(this,t);return this.getChildren().forEach((function(t){e.add(t.clone())})),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach((function(n){n.isVisible()&&n.intersects(t)&&e.push(n)})),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach((function(e){e._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach((function(t,e){t.index=e})),this._requestDraw()}drawScene(t,e){var n=this.getLayer(),i=t||n&&n.getCanvas(),r=i&&i.getContext(),a=this._getCanvasCache(),o=a&&a.scene,s=i&&i.isCache;if(!this.isVisible()&&!s)return this;if(o){r.save();var h=this.getAbsoluteTransform(e).getMatrix();r.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(r),r.restore()}else this._drawChildren("drawScene",i,e);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var n=this.getLayer(),i=t||n&&n.hitCanvas,r=i&&i.getContext(),a=this._getCanvasCache();if(a&&a.hit){r.save();var o=this.getAbsoluteTransform(e).getMatrix();r.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this._drawCachedHitCanvas(r),r.restore()}else this._drawChildren("drawHit",i,e);return this}_drawChildren(t,e,n){var i,r=e&&e.getContext(),a=this.clipWidth(),o=this.clipHeight(),s=this.clipFunc(),h=a&&o||s;const l=n===this;if(h){r.save();var c=this.getAbsoluteTransform(n),d=c.getMatrix();if(r.transform(d[0],d[1],d[2],d[3],d[4],d[5]),r.beginPath(),s)s.call(this,r,this);else{var u=this.clipX(),f=this.clipY();r.rect(u,f,a,o)}r.clip(),d=c.copy().invert().getMatrix(),r.transform(d[0],d[1],d[2],d[3],d[4],d[5])}var p=!l&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;p&&(r.save(),r._applyGlobalCompositeOperation(this)),null===(i=this.children)||void 0===i||i.forEach((function(i){i[t](e,n)})),p&&r.restore(),h&&r.restore()}getClientRect(t){var e,n,i,r,a,o=(t=t||{}).skipTransform,s=t.relativeTo,h={x:1/0,y:1/0,width:0,height:0},l=this;null===(e=this.children)||void 0===e||e.forEach((function(e){if(e.visible()){var o=e.getClientRect({relativeTo:l,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===o.width&&0===o.height||(void 0===n?(n=o.x,i=o.y,r=o.x+o.width,a=o.y+o.height):(n=Math.min(n,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x+o.width),a=Math.max(a,o.y+o.height)))}}));for(var c=this.find("Shape"),d=!1,u=0;u<c.length;u++){if(c[u]._isVisible(this)){d=!0;break}}return h=d&&void 0!==n?{x:n,y:i,width:r-n,height:a-i}:{x:0,y:0,width:0,height:0},o?h:this._transformedRect(h,s)}}C.addComponentsGetterSetter($,"clip",["x","y","width","height"]),C.addGetterSetter($,"clipX",void 0,y()),C.addGetterSetter($,"clipY",void 0,y()),C.addGetterSetter($,"clipWidth",void 0,y()),C.addGetterSetter($,"clipHeight",void 0,y()),C.addGetterSetter($,"clipFunc");const Z=new Map,tt=void 0!==r._global.PointerEvent;function et(t){return Z.get(t)}function nt(t){return{evt:t,pointerId:t.pointerId}}function it(t,e){return Z.get(t)===e}function rt(t,e){at(t);e.getStage()&&(Z.set(t,e),tt&&e._fire("gotpointercapture",nt(new PointerEvent("gotpointercapture"))))}function at(t,e){const n=Z.get(t);if(!n)return;const i=n.getStage();i&&i.content,Z.delete(t),tt&&n._fire("lostpointercapture",nt(new PointerEvent("lostpointercapture")))}var ot="mouseleave",st="mouseover",ht="mouseenter",lt="mousemove",ct="mousedown",dt="mouseup",ut="pointermove",ft="pointerdown",pt="pointerup",gt="pointercancel",vt="pointerout",yt="pointerleave",mt="pointerover",bt="pointerenter",xt="contextmenu",_t="touchstart",wt="touchend",St="touchmove",kt="touchcancel",Ct="wheel",Pt=[[ht,"_pointerenter"],[ct,"_pointerdown"],[lt,"_pointermove"],[dt,"_pointerup"],[ot,"_pointerleave"],[_t,"_pointerdown"],[St,"_pointermove"],[wt,"_pointerup"],[kt,"_pointercancel"],[st,"_pointerover"],[Ct,"_wheel"],[xt,"_contextmenu"],[ft,"_pointerdown"],[ut,"_pointermove"],[pt,"_pointerup"],[gt,"_pointercancel"],["lostpointercapture","_lostpointercapture"]];const Tt={mouse:{[vt]:"mouseout",[yt]:ot,[mt]:st,[bt]:ht,[ut]:lt,[ft]:ct,[pt]:dt,[gt]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[vt]:"touchout",[yt]:"touchleave",[mt]:"touchover",[bt]:"touchenter",[ut]:St,[ft]:_t,[pt]:wt,[gt]:kt,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[vt]:vt,[yt]:yt,[mt]:mt,[bt]:bt,[ut]:ut,[ft]:ft,[pt]:pt,[gt]:gt,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},At=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",Lt=t=>{const e=At(t);return"pointer"===e?r.pointerEventsEnabled&&Tt.pointer:"touch"===e?Tt.touch:"mouse"===e?Tt.mouse:void 0};function Et(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&p.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const Ot=[];class Mt extends ${constructor(t){super(Et(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Ot.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",(()=>{Et(this.attrs)})),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),n="FastLayer"===t.getType();e||n||p.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){if("."===t.charAt(0)){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var n;n="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(n)}if(!t)throw"Can not find container in document with id "+n}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var t,e=this.children,n=e.length;for(t=0;t<n;t++)e[t].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),$.prototype.clone.call(this,t)}destroy(){super.destroy();var t=this.content;t&&p._isInDocument(t)&&this.container().removeChild(t);var e=Ot.indexOf(this);return e>-1&&Ot.splice(e,1),p.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(p.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find((e=>e.id===t))}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();var e=new M({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),n=e.getContext()._context,i=this.children;return(t.x||t.y)&&n.translate(-1*t.x,-1*t.y),i.forEach((function(e){if(e.isVisible()){var i=e._toKonvaCanvas(t);n.drawImage(i._canvas,t.x,t.y,i.getWidth()/i.getPixelRatio(),i.getHeight()/i.getPixelRatio())}})),e}getIntersection(t){if(!t)return null;var e,n=this.children;for(e=n.length-1;e>=0;e--){const i=n[e].getIntersection(t);if(i)return i}return null}_resizeDOM(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach((n=>{n.setSize({width:t,height:e}),n.draw()}))}add(t,...e){if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}super.add(t);var i=this.children.length;return i>5&&p.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),r.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){rt(t,this)}releaseCapture(t){at(t)}getLayers(){return this.children}_bindContentEvents(){r.isBrowser&&Pt.forEach((([t,e])=>{this.content.addEventListener(t,(t=>{this[e](t)}),{passive:!1})}))}_pointerenter(t){this.setPointersPositions(t);const e=Lt(t.type);this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=Lt(t.type);this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=Lt(t.type),n=At(t.type);if(e){this.setPointersPositions(t);var i=this._getTargetShape(n),a=!G.isDragging||r.hitOnDragEnabled;i&&a?(i._fireAndBubble(e.pointerout,{evt:t}),i._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[n+"targetShape"]=null):a&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(t){const e=Lt(t.type),n=At(t.type);if(e){this.setPointersPositions(t);var i=!1;this._changedPointerPositions.forEach((a=>{var o=this.getIntersection(a);G.justDragged=!1,r["_"+n+"ListenClick"]=!0;if(!(o&&o.isListening()))return;r.capturePointerEventsEnabled&&o.setPointerCapture(a.id),this[n+"ClickStartShape"]=o,o._fireAndBubble(e.pointerdown,{evt:t,pointerId:a.id}),i=!0;const s=t.type.indexOf("touch")>=0;o.preventDefault()&&t.cancelable&&s&&t.preventDefault()})),i||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(t){const e=Lt(t.type),n=At(t.type);if(!e)return;if(G.isDragging&&G.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t),!(!G.isDragging||r.hitOnDragEnabled))return;var i={};let a=!1;var o=this._getTargetShape(n);this._changedPointerPositions.forEach((r=>{const s=et(r.id)||this.getIntersection(r),h=r.id,l={evt:t,pointerId:h};var c=o!==s;if(c&&o&&(o._fireAndBubble(e.pointerout,Object.assign({},l),s),o._fireAndBubble(e.pointerleave,Object.assign({},l),s)),s){if(i[s._id])return;i[s._id]=!0}s&&s.isListening()?(a=!0,c&&(s._fireAndBubble(e.pointerover,Object.assign({},l),o),s._fireAndBubble(e.pointerenter,Object.assign({},l),o),this[n+"targetShape"]=s),s._fireAndBubble(e.pointermove,Object.assign({},l))):o&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:h}),this[n+"targetShape"]=null)})),a||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=Lt(t.type),n=At(t.type);if(!e)return;this.setPointersPositions(t);const i=this[n+"ClickStartShape"],a=this[n+"ClickEndShape"];var o={};let s=!1;this._changedPointerPositions.forEach((h=>{const l=et(h.id)||this.getIntersection(h);if(l){if(l.releaseCapture(h.id),o[l._id])return;o[l._id]=!0}const c=h.id,d={evt:t,pointerId:c};let u=!1;r["_"+n+"InDblClickWindow"]?(u=!0,clearTimeout(this[n+"DblTimeout"])):G.justDragged||(r["_"+n+"InDblClickWindow"]=!0,clearTimeout(this[n+"DblTimeout"])),this[n+"DblTimeout"]=setTimeout((function(){r["_"+n+"InDblClickWindow"]=!1}),r.dblClickWindow),l&&l.isListening()?(s=!0,this[n+"ClickEndShape"]=l,l._fireAndBubble(e.pointerup,Object.assign({},d)),r["_"+n+"ListenClick"]&&i&&i===l&&(l._fireAndBubble(e.pointerclick,Object.assign({},d)),u&&a&&a===l&&l._fireAndBubble(e.pointerdblclick,Object.assign({},d)))):(this[n+"ClickEndShape"]=null,r["_"+n+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:c}),u&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:c}))})),s||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r["_"+n+"ListenClick"]=!1,t.cancelable&&"touch"!==n&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(xt,{evt:t}):this._fire(xt,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(Ct,{evt:t}):this._fire(Ct,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=et(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(pt,nt(t)),at(t.pointerId)}_lostpointercapture(t){at(t.pointerId)}setPointersPositions(t){var e=this._getContentPosition(),n=null,i=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,(t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})),Array.prototype.forEach.call(t.changedTouches||t.touches,(t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}))):(n=(t.clientX-e.left)/e.scaleX,i=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:n,y:i},this._pointerPositions=[{x:n,y:i,id:p._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:i,id:p._getFirstPointerId(t)}])}_setPointerPosition(t){p.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new M({width:this.width(),height:this.height()}),this.bufferHitCanvas=new D({pixelRatio:1,width:this.width(),height:this.height()}),r.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}}cache(){return p.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach((function(t){t.batchDraw()})),this}}Mt.prototype.nodeType="Stage",a(Mt),C.addGetterSetter(Mt,"container");var Dt="hasShadow",Gt="shadowRGBA",Rt="patternImage",It="linearGradient",Nt="radialGradient";let Ft;function jt(){return Ft||(Ft=p.createCanvasElement().getContext("2d"),Ft)}const zt={};class Bt extends J{constructor(t){let e;for(super(t);e=p.getRandomColor(),!e||e in zt;);this.colorKey=e,zt[e]=this}getContext(){return p.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return p.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Dt,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Rt,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=jt().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new o;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(r.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=e.getMatrix(),i="undefined"==typeof DOMMatrix?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);t.setTransform(i)}return t}}_getLinearGradient(){return this._getCache(It,this.__getLinearGradient)}__getLinearGradient(){var t=this.fillLinearGradientColorStops();if(t){for(var e=jt(),n=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),r=e.createLinearGradient(n.x,n.y,i.x,i.y),a=0;a<t.length;a+=2)r.addColorStop(t[a],t[a+1]);return r}}_getRadialGradient(){return this._getCache(Nt,this.__getRadialGradient)}__getRadialGradient(){var t=this.fillRadialGradientColorStops();if(t){for(var e=jt(),n=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),r=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius()),a=0;a<t.length;a+=2)r.addColorStop(t[a],t[a+1]);return r}}getShadowRGBA(){return this._getCache(Gt,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var t=p.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],(()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],(()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops())))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){var e=this.getStage().bufferHitCanvas;return e.getContext().clear(),this.drawHit(e,null,!0),e.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return J.prototype.destroy.call(this),delete zt[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!this.getStage())return!1;if(!(null===(e=this.attrs.perfectDrawEnabled)||void 0===e||e))return!1;const n=t||this.hasFill(),i=this.hasStroke(),r=1!==this.getAbsoluteOpacity();if(n&&i&&r)return!0;const a=this.hasShadow(),o=this.shadowForStrokeEnabled();return!!(n&&i&&a&&o)}setStrokeHitEnabled(t){p.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){const e=t.skipTransform,n=t.relativeTo,i=this.getSelfRect(),r=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,a=i.width+r,o=i.height+r,s=!t.skipShadow&&this.hasShadow(),h=s?this.shadowOffsetX():0,l=s?this.shadowOffsetY():0,c=a+Math.abs(h),d=o+Math.abs(l),u=s&&this.shadowBlur()||0,f={width:c+2*u,height:d+2*u,x:-(r/2+u)+Math.min(h,0)+i.x,y:-(r/2+u)+Math.min(l,0)+i.y};return e?f:this._transformedRect(f,n)}drawScene(t,e){var n,i,r=this.getLayer(),a=t||r.getCanvas(),o=a.getContext(),s=this._getCanvasCache(),h=this.getSceneFunc(),l=this.hasShadow(),c=a.isCache,d=e===this;if(!this.isVisible()&&!d)return this;if(s){o.save();var u=this.getAbsoluteTransform(e).getMatrix();return o.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedSceneCanvas(o),o.restore(),this}if(!h)return this;if(o.save(),this._useBufferCanvas()&&!c){(i=(n=this.getStage().bufferCanvas).getContext()).clear(),i.save(),i._applyLineJoin(this);var f=this.getAbsoluteTransform(e).getMatrix();i.transform(f[0],f[1],f[2],f[3],f[4],f[5]),h.call(this,i,this),i.restore();var p=n.pixelRatio;l&&o._applyShadow(this),o._applyOpacity(this),o._applyGlobalCompositeOperation(this),o.drawImage(n._canvas,0,0,n.width/p,n.height/p)}else{if(o._applyLineJoin(this),!d){f=this.getAbsoluteTransform(e).getMatrix();o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),o._applyOpacity(this),o._applyGlobalCompositeOperation(this)}l&&o._applyShadow(this),h.call(this,o,this)}return o.restore(),this}drawHit(t,e,n=!1){if(!this.shouldDrawHit(e,n))return this;var i=this.getLayer(),r=t||i.hitCanvas,a=r&&r.getContext(),o=this.hitFunc()||this.sceneFunc(),s=this._getCanvasCache(),h=s&&s.hit;if(this.colorKey||p.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),h){a.save();var l=this.getAbsoluteTransform(e).getMatrix();return a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(a),a.restore(),this}if(!o)return this;a.save(),a._applyLineJoin(this);if(!(this===e)){var c=this.getAbsoluteTransform(e).getMatrix();a.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return o.call(this,a,this),a.restore(),this}drawHitFromCache(t=0){var e,n,i,r,a,o=this._getCanvasCache(),s=this._getCachedSceneCanvas(),h=o.hit,l=h.getContext(),c=h.getWidth(),d=h.getHeight();l.clear(),l.drawImage(s._canvas,0,0,c,d);try{for(i=(n=(e=l.getImageData(0,0,c,d)).data).length,r=p._hexToRgb(this.colorKey),a=0;a<i;a+=4)n[a+3]>t?(n[a]=r.r,n[a+1]=r.g,n[a+2]=r.b,n[a+3]=255):n[a+3]=0;l.putImageData(e,0,0)}catch(t){p.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return it(t,this)}setPointerCapture(t){rt(t,this)}releaseCapture(t){at(t)}}Bt.prototype._fillFunc=function(t){t.fill()},Bt.prototype._strokeFunc=function(t){t.stroke()},Bt.prototype._fillFuncHit=function(t){t.fill()},Bt.prototype._strokeFuncHit=function(t){t.stroke()},Bt.prototype._centroid=!1,Bt.prototype.nodeType="Shape",a(Bt),Bt.prototype.eventListeners={},Bt.prototype.on.call(Bt.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(Dt)})),Bt.prototype.on.call(Bt.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(Gt)})),Bt.prototype.on.call(Bt.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",(function(){this._clearCache(Rt)})),Bt.prototype.on.call(Bt.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",(function(){this._clearCache(It)})),Bt.prototype.on.call(Bt.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",(function(){this._clearCache(Nt)})),C.addGetterSetter(Bt,"stroke",void 0,_()),C.addGetterSetter(Bt,"strokeWidth",2,y()),C.addGetterSetter(Bt,"fillAfterStrokeEnabled",!1),C.addGetterSetter(Bt,"hitStrokeWidth","auto",b()),C.addGetterSetter(Bt,"strokeHitEnabled",!0,w()),C.addGetterSetter(Bt,"perfectDrawEnabled",!0,w()),C.addGetterSetter(Bt,"shadowForStrokeEnabled",!0,w()),C.addGetterSetter(Bt,"lineJoin"),C.addGetterSetter(Bt,"lineCap"),C.addGetterSetter(Bt,"sceneFunc"),C.addGetterSetter(Bt,"hitFunc"),C.addGetterSetter(Bt,"dash"),C.addGetterSetter(Bt,"dashOffset",0,y()),C.addGetterSetter(Bt,"shadowColor",void 0,x()),C.addGetterSetter(Bt,"shadowBlur",0,y()),C.addGetterSetter(Bt,"shadowOpacity",1,y()),C.addComponentsGetterSetter(Bt,"shadowOffset",["x","y"]),C.addGetterSetter(Bt,"shadowOffsetX",0,y()),C.addGetterSetter(Bt,"shadowOffsetY",0,y()),C.addGetterSetter(Bt,"fillPatternImage"),C.addGetterSetter(Bt,"fill",void 0,_()),C.addGetterSetter(Bt,"fillPatternX",0,y()),C.addGetterSetter(Bt,"fillPatternY",0,y()),C.addGetterSetter(Bt,"fillLinearGradientColorStops"),C.addGetterSetter(Bt,"strokeLinearGradientColorStops"),C.addGetterSetter(Bt,"fillRadialGradientStartRadius",0),C.addGetterSetter(Bt,"fillRadialGradientEndRadius",0),C.addGetterSetter(Bt,"fillRadialGradientColorStops"),C.addGetterSetter(Bt,"fillPatternRepeat","repeat"),C.addGetterSetter(Bt,"fillEnabled",!0),C.addGetterSetter(Bt,"strokeEnabled",!0),C.addGetterSetter(Bt,"shadowEnabled",!0),C.addGetterSetter(Bt,"dashEnabled",!0),C.addGetterSetter(Bt,"strokeScaleEnabled",!0),C.addGetterSetter(Bt,"fillPriority","color"),C.addComponentsGetterSetter(Bt,"fillPatternOffset",["x","y"]),C.addGetterSetter(Bt,"fillPatternOffsetX",0,y()),C.addGetterSetter(Bt,"fillPatternOffsetY",0,y()),C.addComponentsGetterSetter(Bt,"fillPatternScale",["x","y"]),C.addGetterSetter(Bt,"fillPatternScaleX",1,y()),C.addGetterSetter(Bt,"fillPatternScaleY",1,y()),C.addComponentsGetterSetter(Bt,"fillLinearGradientStartPoint",["x","y"]),C.addComponentsGetterSetter(Bt,"strokeLinearGradientStartPoint",["x","y"]),C.addGetterSetter(Bt,"fillLinearGradientStartPointX",0),C.addGetterSetter(Bt,"strokeLinearGradientStartPointX",0),C.addGetterSetter(Bt,"fillLinearGradientStartPointY",0),C.addGetterSetter(Bt,"strokeLinearGradientStartPointY",0),C.addComponentsGetterSetter(Bt,"fillLinearGradientEndPoint",["x","y"]),C.addComponentsGetterSetter(Bt,"strokeLinearGradientEndPoint",["x","y"]),C.addGetterSetter(Bt,"fillLinearGradientEndPointX",0),C.addGetterSetter(Bt,"strokeLinearGradientEndPointX",0),C.addGetterSetter(Bt,"fillLinearGradientEndPointY",0),C.addGetterSetter(Bt,"strokeLinearGradientEndPointY",0),C.addComponentsGetterSetter(Bt,"fillRadialGradientStartPoint",["x","y"]),C.addGetterSetter(Bt,"fillRadialGradientStartPointX",0),C.addGetterSetter(Bt,"fillRadialGradientStartPointY",0),C.addComponentsGetterSetter(Bt,"fillRadialGradientEndPoint",["x","y"]),C.addGetterSetter(Bt,"fillRadialGradientEndPointX",0),C.addGetterSetter(Bt,"fillRadialGradientEndPointY",0),C.addGetterSetter(Bt,"fillPatternRotation",0),C.backCompat(Bt,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var Ht=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Wt=Ht.length;class Yt extends ${constructor(t){super(t),this.canvas=new M,this.hitCanvas=new D({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){J.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!J.prototype.moveUp.call(this))return!1;var t=this.getStage();return!(!t||!t.content)&&(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(J.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(J.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return J.prototype.remove.call(this),t&&t.parentNode&&p._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&p.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),J.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){p.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){p.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,p.requestAnimFrame((()=>{this.draw(),this._waitingForDraw=!1}))),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,n=!1;;){for(let i=0;i<Wt;i++){const r=Ht[i],a=this._getIntersection({x:t.x+r.x*e,y:t.y+r.y*e}),o=a.shape;if(o)return o;if(n=!!a.antialiased,!a.antialiased)break}if(!n)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,i=n[3];if(255===i){const t=p._rgbToHex(n[0],n[1],n[2]),e=zt["#"+t];return e?{shape:e}:{antialiased:!0}}return i>0?{antialiased:!0}:{}}drawScene(t,e){var n=this.getLayer(),i=t||n&&n.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),$.prototype.drawScene.call(this,i,e),this._fire("draw",{node:this}),this}drawHit(t,e){var n=this.getLayer(),i=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),$.prototype.drawHit.call(this,i,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){p.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return p.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(this.parent&&this.parent.content){var t=this.parent;!!this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return p.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Yt.prototype.nodeType="Layer",a(Yt),C.addGetterSetter(Yt,"imageSmoothingEnabled",!0),C.addGetterSetter(Yt,"clearBeforeDraw",!0),C.addGetterSetter(Yt,"hitGraphEnabled",!0,w());class Xt extends Yt{constructor(t){super(t),this.listening(!1),p.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Xt.prototype.nodeType="FastLayer",a(Xt);class qt extends ${_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&p.throw("You may only add groups and shapes to groups.")}}qt.prototype.nodeType="Group",a(qt);var Ut=e.performance&&e.performance.now?function(){return e.performance.now()}:function(){return(new Date).getTime()};class Vt{constructor(t,e){this.id=Vt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Ut(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){var e=[];return e=t?t.length>0?t:[t]:[],this.layers=e,this}getLayers(){return this.layers}addLayer(t){var e,n=this.layers,i=n.length;for(e=0;e<i;e++)if(n[e]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){var t,e=Vt.animations,n=e.length;for(t=0;t<n;t++)if(e[t].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Ut(),Vt._addAnimation(this),this}stop(){return Vt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){var e,n=t.id,i=this.animations,r=i.length;for(e=0;e<r;e++)if(i[e].id===n){this.animations.splice(e,1);break}}static _runFrames(){var t,e,n,i,r,a,o,s,h={},l=this.animations;for(i=0;i<l.length;i++)if(e=(t=l[i]).layers,n=t.func,t._updateFrameObject(Ut()),a=e.length,!n||!1!==n.call(t,t.frame))for(r=0;r<a;r++)void 0!==(o=e[r])._id&&(h[o._id]=o);for(s in h)h.hasOwnProperty(s)&&h[s].batchDraw()}static _animationLoop(){var t=Vt;t.animations.length?(t._runFrames(),p.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,p.requestAnimFrame(this._animationLoop))}}Vt.animations=[],Vt.animIdCounter=0,Vt.animRunning=!1;var Kt={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Jt=0,Qt=["fill","stroke","shadowColor"];class $t{constructor(t,e,n,i,r,a,o){this.prop=t,this.propFunc=e,this.begin=i,this._pos=i,this.duration=a,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=r-this.begin,this.pause()}fire(t){var e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class Zt{constructor(t){var e,n,i=this,a=t.node,o=a._id,s=t.easing||te.Linear,h=!!t.yoyo;e=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=a,this._id=Jt++;var l=a.getLayer()||(a instanceof r.Stage?a.getLayers():null);for(n in l||p.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Vt((function(){i.tween.onEnterFrame()}),l),this.tween=new $t(n,(function(t){i._tweenFunc(t)}),s,0,1,1e3*e,h),this._addListeners(),Zt.attrs[o]||(Zt.attrs[o]={}),Zt.attrs[o][this._id]||(Zt.attrs[o][this._id]={}),Zt.tweens[o]||(Zt.tweens[o]={}),t)void 0===Kt[n]&&this._addAttr(n,t[n]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){var n,i,r,a,o,s,h,l,c=this.node,d=c._id;if((r=Zt.tweens[d][t])&&delete Zt.attrs[d][r][t],n=c.getAttr(t),p._isArray(e))if(i=[],o=Math.max(e.length,n.length),"points"===t&&e.length!==n.length&&(e.length>n.length?(h=n,n=p._prepareArrayForTween(n,e,c.closed())):(s=e,e=p._prepareArrayForTween(e,n,c.closed()))),0===t.indexOf("fill"))for(a=0;a<o;a++)if(a%2==0)i.push(e[a]-n[a]);else{var u=p.colorToRGBA(n[a]);l=p.colorToRGBA(e[a]),n[a]=u,i.push({r:l.r-u.r,g:l.g-u.g,b:l.b-u.b,a:l.a-u.a})}else for(a=0;a<o;a++)i.push(e[a]-n[a]);else-1!==Qt.indexOf(t)?(n=p.colorToRGBA(n),i={r:(l=p.colorToRGBA(e)).r-n.r,g:l.g-n.g,b:l.b-n.b,a:l.a-n.a}):i=e-n;Zt.attrs[d][this._id][t]={start:n,diff:i,end:e,trueEnd:s,trueStart:h},Zt.tweens[d][t]=this._id}_tweenFunc(t){var e,n,i,r,a,o,s,h,l=this.node,c=Zt.attrs[l._id][this._id];for(e in c){if(i=(n=c[e]).start,r=n.diff,h=n.end,p._isArray(i))if(a=[],s=Math.max(i.length,h.length),0===e.indexOf("fill"))for(o=0;o<s;o++)o%2==0?a.push((i[o]||0)+r[o]*t):a.push("rgba("+Math.round(i[o].r+r[o].r*t)+","+Math.round(i[o].g+r[o].g*t)+","+Math.round(i[o].b+r[o].b*t)+","+(i[o].a+r[o].a*t)+")");else for(o=0;o<s;o++)a.push((i[o]||0)+r[o]*t);else a=-1!==Qt.indexOf(e)?"rgba("+Math.round(i.r+r.r*t)+","+Math.round(i.g+r.g*t)+","+Math.round(i.b+r.b*t)+","+(i.a+r.a*t)+")":i+r*t;l.setAttr(e,a)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var t=this.node,e=Zt.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var t=this.node,e=Zt.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var t,e=this.node._id,n=this._id,i=Zt.tweens[e];for(t in this.pause(),i)delete Zt.tweens[e][t];delete Zt.attrs[e][n]}}Zt.attrs={},Zt.tweens={},J.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new Zt(t).play()};const te={BackEaseIn(t,e,n,i){var r=1.70158;return n*(t/=i)*t*((r+1)*t-r)+e},BackEaseOut(t,e,n,i){var r=1.70158;return n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut(t,e,n,i){var r=1.70158;return(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},ElasticEaseIn(t,e,n,i,r,a){var o=0;return 0===t?e:1==(t/=i)?e+n:(a||(a=.3*i),!r||r<Math.abs(n)?(r=n,o=a/4):o=a/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/a)+e)},ElasticEaseOut(t,e,n,i,r,a){var o=0;return 0===t?e:1==(t/=i)?e+n:(a||(a=.3*i),!r||r<Math.abs(n)?(r=n,o=a/4):o=a/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-o)*(2*Math.PI)/a)+n+e)},ElasticEaseInOut(t,e,n,i,r,a){var o=0;return 0===t?e:2==(t/=i/2)?e+n:(a||(a=i*(.3*1.5)),!r||r<Math.abs(n)?(r=n,o=a/4):o=a/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/a)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/a)*.5+n+e)},BounceEaseOut:(t,e,n,i)=>(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,n,i)=>n-te.BounceEaseOut(i-t,0,n,i)+e,BounceEaseInOut:(t,e,n,i)=>t<i/2?.5*te.BounceEaseIn(2*t,0,n,i)+e:.5*te.BounceEaseOut(2*t-i,0,n,i)+.5*n+e,EaseIn:(t,e,n,i)=>n*(t/=i)*t+e,EaseOut:(t,e,n,i)=>-n*(t/=i)*(t-2)+e,EaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,n,i)=>n*(t/=i)*t*t*t*t+e,StrongEaseOut:(t,e,n,i)=>n*((t=t/i-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,n,i)=>n*t/i+e},ee=p._assign(r,{Util:p,Transform:o,Node:J,Container:$,Stage:Mt,stages:Ot,Layer:Yt,FastLayer:Xt,Group:qt,DD:G,Shape:Bt,shapes:zt,Animation:Vt,Tween:Zt,Easings:te,Context:T,Canvas:O});class ne extends Bt{_sceneFunc(t){var e=r.getAngle(this.angle()),n=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,n),t.arc(0,0,this.innerRadius(),e,0,!n),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),n=this.clockwise(),i=r.getAngle(n?360-this.angle():this.angle()),a=Math.cos(Math.min(i,Math.PI)),o=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),s=Math.sin(Math.min(i,Math.PI/2)),h=a*(a>0?t:e),l=o*(o>0?t:e),c=s*(s>0?e:t);return{x:h,y:n?-1*c:l,width:1*e-h,height:c-l}}}function ie(t,e,n,i,r,a,o){var s=Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2)),h=Math.sqrt(Math.pow(r-n,2)+Math.pow(a-i,2)),l=o*s/(s+h),c=o*h/(s+h);return[n-l*(r-t),i-l*(a-e),n+c*(r-t),i+c*(a-e)]}function re(t,e){var n,i,r=t.length,a=[];for(n=2;n<r-2;n+=2)i=ie(t[n-2],t[n-1],t[n],t[n+1],t[n+2],t[n+3],e),isNaN(i[0])||(a.push(i[0]),a.push(i[1]),a.push(t[n]),a.push(t[n+1]),a.push(i[2]),a.push(i[3]));return a}ne.prototype._centroid=!0,ne.prototype.className="Arc",ne.prototype._attrsAffectingSize=["innerRadius","outerRadius"],a(ne),C.addGetterSetter(ne,"innerRadius",0,y()),C.addGetterSetter(ne,"outerRadius",0,y()),C.addGetterSetter(ne,"angle",0,y()),C.addGetterSetter(ne,"clockwise",!1,w());class ae extends Bt{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")}))}_sceneFunc(t){var e,n,i,r=this.points(),a=r.length,o=this.tension(),s=this.closed(),h=this.bezier();if(a){if(t.beginPath(),t.moveTo(r[0],r[1]),0!==o&&a>4){for(n=(e=this.getTensionPoints()).length,i=s?0:4,s||t.quadraticCurveTo(e[0],e[1],e[2],e[3]);i<n-2;)t.bezierCurveTo(e[i++],e[i++],e[i++],e[i++],e[i++],e[i++]);s||t.quadraticCurveTo(e[n-2],e[n-1],r[a-2],r[a-1])}else if(h)for(i=2;i<a;)t.bezierCurveTo(r[i++],r[i++],r[i++],r[i++],r[i++],r[i++]);else for(i=2;i<a;i+=2)t.lineTo(r[i],r[i+1]);s?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():re(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,n=this.tension(),i=ie(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),r=ie(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),a=re(t,n);return[i[2],i[3]].concat(a).concat([r[0],r[1],t[e-2],t[e-1],r[2],r[3],i[0],i[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};for(var e,n,i=(t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points())[0],r=t[0],a=t[1],o=t[1],s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],i=Math.min(i,e),r=Math.max(r,e),a=Math.min(a,n),o=Math.max(o,n);return{x:i,y:a,width:r-i,height:o-a}}}ae.prototype.className="Line",ae.prototype._attrsAffectingSize=["points","bezier","tension"],a(ae),C.addGetterSetter(ae,"closed",!1),C.addGetterSetter(ae,"bezier",!1),C.addGetterSetter(ae,"tension",0,y()),C.addGetterSetter(ae,"points",[],function(){if(r.isUnminified)return function(t,e){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&t instanceof n||(p._isArray(t)?t.forEach((function(t){p._isNumber(t)||p.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")})):p.warn(g(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());class oe extends Bt{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this.dataArray=oe.parsePathData(this.data()),this.pathLength=0;for(var e=0;e<this.dataArray.length;++e)this.pathLength+=this.dataArray[e].pathLength;this.on("dataChange.konva",(function(){this.dataArray=oe.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength}))}_sceneFunc(t){var e=this.dataArray;t.beginPath();for(var n=!1,i=0;i<e.length;i++){var r=e[i].command,a=e[i].points;switch(r){case"L":t.lineTo(a[0],a[1]);break;case"M":t.moveTo(a[0],a[1]);break;case"C":t.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"Q":t.quadraticCurveTo(a[0],a[1],a[2],a[3]);break;case"A":var o=a[0],s=a[1],h=a[2],l=a[3],c=a[4],d=a[5],u=a[6],f=a[7],p=h>l?h:l,g=h>l?1:h/l,v=h>l?l/h:1;t.translate(o,s),t.rotate(u),t.scale(g,v),t.arc(0,0,p,c,c+d,1-f),t.scale(1/g,1/v),t.rotate(-u),t.translate(-o,-s);break;case"z":n=!0,t.closePath()}}n||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach((function(e){if("A"===e.command){var n=e.points[4],i=e.points[5],r=e.points[4]+i,a=Math.PI/180;if(Math.abs(n-r)<a&&(a=Math.abs(n-r)),i<0)for(let i=n-a;i>r;i-=a){const n=oe.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],i,0);t.push(n.x,n.y)}else for(let i=n+a;i<r;i+=a){const n=oe.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],i,0);t.push(n.x,n.y)}}else if("C"===e.command)for(let n=0;n<=1;n+=.01){const i=oe.getPointOnCubicBezier(n,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);t.push(i.x,i.y)}else t=t.concat(e.points)}));for(var e,n,i=t[0],r=t[0],a=t[1],o=t[1],s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],isNaN(e)||(i=Math.min(i,e),r=Math.max(r,e)),isNaN(n)||(a=Math.min(a,n),o=Math.max(o,n));return{x:i,y:a,width:r-i,height:o-a}}getLength(){return this.pathLength}getPointAtLength(t){var e,n=0,i=this.dataArray.length;if(!i)return null;for(;n<i&&t>this.dataArray[n].pathLength;)t-=this.dataArray[n].pathLength,++n;if(n===i)return{x:(e=this.dataArray[n-1].points.slice(-2))[0],y:e[1]};if(t<.01)return{x:(e=this.dataArray[n].points.slice(0,2))[0],y:e[1]};var r=this.dataArray[n],a=r.points;switch(r.command){case"L":return oe.getPointOnLine(t,r.start.x,r.start.y,a[0],a[1]);case"C":return oe.getPointOnCubicBezier(t/r.pathLength,r.start.x,r.start.y,a[0],a[1],a[2],a[3],a[4],a[5]);case"Q":return oe.getPointOnQuadraticBezier(t/r.pathLength,r.start.x,r.start.y,a[0],a[1],a[2],a[3]);case"A":var o=a[0],s=a[1],h=a[2],l=a[3],c=a[4],d=a[5],u=a[6];return c+=d*t/r.pathLength,oe.getPointOnEllipticalArc(o,s,h,l,c,u)}return null}static getLineLength(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}static getPointOnLine(t,e,n,i,r,a,o){void 0===a&&(a=e),void 0===o&&(o=n);var s=(r-n)/(i-e+1e-8),h=Math.sqrt(t*t/(1+s*s));i<e&&(h*=-1);var l,c=s*h;if(i===e)l={x:a,y:o+c};else if((o-n)/(a-e+1e-8)===s)l={x:a+h,y:o+c};else{var d,u,f=this.getLineLength(e,n,i,r),p=(a-e)*(i-e)+(o-n)*(r-n);d=e+(p/=f*f)*(i-e),u=n+p*(r-n);var g=this.getLineLength(a,o,d,u),v=Math.sqrt(t*t-g*g);h=Math.sqrt(v*v/(1+s*s)),i<e&&(h*=-1),l={x:d+h,y:u+(c=s*h)}}return l}static getPointOnCubicBezier(t,e,n,i,r,a,o,s,h){function l(t){return t*t*t}function c(t){return 3*t*t*(1-t)}function d(t){return 3*t*(1-t)*(1-t)}function u(t){return(1-t)*(1-t)*(1-t)}return{x:s*l(t)+a*c(t)+i*d(t)+e*u(t),y:h*l(t)+o*c(t)+r*d(t)+n*u(t)}}static getPointOnQuadraticBezier(t,e,n,i,r,a,o){function s(t){return t*t}function h(t){return 2*t*(1-t)}function l(t){return(1-t)*(1-t)}return{x:a*s(t)+i*h(t)+e*l(t),y:o*s(t)+r*h(t)+n*l(t)}}static getPointOnEllipticalArc(t,e,n,i,r,a){var o=Math.cos(a),s=Math.sin(a),h=n*Math.cos(r),l=i*Math.sin(r);return{x:t+(h*o-l*s),y:e+(h*s+l*o)}}static parsePathData(t){if(!t)return[];var e=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var i=0;i<n.length;i++)e=e.replace(new RegExp(n[i],"g"),"|"+n[i]);var r,a=e.split("|"),o=[],s=[],h=0,l=0,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(i=1;i<a.length;i++){var d=a[i],u=d.charAt(0);for(d=d.slice(1),s.length=0;r=c.exec(d);)s.push(r[0]);for(var f=[],p=0,g=s.length;p<g;p++)if("00"!==s[p]){var v=parseFloat(s[p]);isNaN(v)?f.push(0):f.push(v)}else f.push(0,0);for(;f.length>0&&!isNaN(f[0]);){var y,m,b,x,_,w,S,k,C,P,T=null,A=[],L=h,E=l;switch(u){case"l":h+=f.shift(),l+=f.shift(),T="L",A.push(h,l);break;case"L":h=f.shift(),l=f.shift(),A.push(h,l);break;case"m":var O=f.shift(),M=f.shift();if(h+=O,l+=M,T="M",o.length>2&&"z"===o[o.length-1].command)for(var D=o.length-2;D>=0;D--)if("M"===o[D].command){h=o[D].points[0]+O,l=o[D].points[1]+M;break}A.push(h,l),u="l";break;case"M":h=f.shift(),l=f.shift(),T="M",A.push(h,l),u="L";break;case"h":h+=f.shift(),T="L",A.push(h,l);break;case"H":h=f.shift(),T="L",A.push(h,l);break;case"v":l+=f.shift(),T="L",A.push(h,l);break;case"V":l=f.shift(),T="L",A.push(h,l);break;case"C":A.push(f.shift(),f.shift(),f.shift(),f.shift()),h=f.shift(),l=f.shift(),A.push(h,l);break;case"c":A.push(h+f.shift(),l+f.shift(),h+f.shift(),l+f.shift()),h+=f.shift(),l+=f.shift(),T="C",A.push(h,l);break;case"S":m=h,b=l,"C"===(y=o[o.length-1]).command&&(m=h+(h-y.points[2]),b=l+(l-y.points[3])),A.push(m,b,f.shift(),f.shift()),h=f.shift(),l=f.shift(),T="C",A.push(h,l);break;case"s":m=h,b=l,"C"===(y=o[o.length-1]).command&&(m=h+(h-y.points[2]),b=l+(l-y.points[3])),A.push(m,b,h+f.shift(),l+f.shift()),h+=f.shift(),l+=f.shift(),T="C",A.push(h,l);break;case"Q":A.push(f.shift(),f.shift()),h=f.shift(),l=f.shift(),A.push(h,l);break;case"q":A.push(h+f.shift(),l+f.shift()),h+=f.shift(),l+=f.shift(),T="Q",A.push(h,l);break;case"T":m=h,b=l,"Q"===(y=o[o.length-1]).command&&(m=h+(h-y.points[0]),b=l+(l-y.points[1])),h=f.shift(),l=f.shift(),T="Q",A.push(m,b,h,l);break;case"t":m=h,b=l,"Q"===(y=o[o.length-1]).command&&(m=h+(h-y.points[0]),b=l+(l-y.points[1])),h+=f.shift(),l+=f.shift(),T="Q",A.push(m,b,h,l);break;case"A":x=f.shift(),_=f.shift(),w=f.shift(),S=f.shift(),k=f.shift(),C=h,P=l,h=f.shift(),l=f.shift(),T="A",A=this.convertEndpointToCenterParameterization(C,P,h,l,S,k,x,_,w);break;case"a":x=f.shift(),_=f.shift(),w=f.shift(),S=f.shift(),k=f.shift(),C=h,P=l,h+=f.shift(),l+=f.shift(),T="A",A=this.convertEndpointToCenterParameterization(C,P,h,l,S,k,x,_,w)}o.push({command:T||u,points:A,start:{x:L,y:E},pathLength:this.calcLength(L,E,T||u,A)})}"z"!==u&&"Z"!==u||o.push({command:"z",points:[],start:void 0,pathLength:0})}return o}static calcLength(t,e,n,i){var r,a,o,s,h=oe;switch(n){case"L":return h.getLineLength(t,e,i[0],i[1]);case"C":for(r=0,a=h.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),s=.01;s<=1;s+=.01)o=h.getPointOnCubicBezier(s,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),r+=h.getLineLength(a.x,a.y,o.x,o.y),a=o;return r;case"Q":for(r=0,a=h.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),s=.01;s<=1;s+=.01)o=h.getPointOnQuadraticBezier(s,t,e,i[0],i[1],i[2],i[3]),r+=h.getLineLength(a.x,a.y,o.x,o.y),a=o;return r;case"A":r=0;var l=i[4],c=i[5],d=i[4]+c,u=Math.PI/180;if(Math.abs(l-d)<u&&(u=Math.abs(l-d)),a=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),c<0)for(s=l-u;s>d;s-=u)o=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],s,0),r+=h.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(s=l+u;s<d;s+=u)o=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],s,0),r+=h.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],d,0),r+=h.getLineLength(a.x,a.y,o.x,o.y)}return 0}static convertEndpointToCenterParameterization(t,e,n,i,r,a,o,s,h){var l=h*(Math.PI/180),c=Math.cos(l)*(t-n)/2+Math.sin(l)*(e-i)/2,d=-1*Math.sin(l)*(t-n)/2+Math.cos(l)*(e-i)/2,u=c*c/(o*o)+d*d/(s*s);u>1&&(o*=Math.sqrt(u),s*=Math.sqrt(u));var f=Math.sqrt((o*o*(s*s)-o*o*(d*d)-s*s*(c*c))/(o*o*(d*d)+s*s*(c*c)));r===a&&(f*=-1),isNaN(f)&&(f=0);var p=f*o*d/s,g=f*-s*c/o,v=(t+n)/2+Math.cos(l)*p-Math.sin(l)*g,y=(e+i)/2+Math.sin(l)*p+Math.cos(l)*g,m=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},b=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(m(t)*m(e))},x=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(b(t,e))},_=x([1,0],[(c-p)/o,(d-g)/s]),w=[(c-p)/o,(d-g)/s],S=[(-1*c-p)/o,(-1*d-g)/s],k=x(w,S);return b(w,S)<=-1&&(k=Math.PI),b(w,S)>=1&&(k=0),0===a&&k>0&&(k-=2*Math.PI),1===a&&k<0&&(k+=2*Math.PI),[v,y,o,s,_,k,l,a]}}oe.prototype.className="Path",oe.prototype._attrsAffectingSize=["data"],a(oe),C.addGetterSetter(oe,"data");class se extends ae{_sceneFunc(t){super._sceneFunc(t);var e=2*Math.PI,n=this.points(),i=n,r=0!==this.tension()&&n.length>4;r&&(i=this.getTensionPoints());var a,o,s=this.pointerLength(),h=n.length;if(r){const t=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],n[h-2],n[h-1]],e=oe.calcLength(i[i.length-4],i[i.length-3],"C",t),r=oe.getPointOnQuadraticBezier(Math.min(1,1-s/e),t[0],t[1],t[2],t[3],t[4],t[5]);a=n[h-2]-r.x,o=n[h-1]-r.y}else a=n[h-2]-n[h-4],o=n[h-1]-n[h-3];var l=(Math.atan2(o,a)+e)%e,c=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(n[h-2],n[h-1]),t.rotate(l),t.moveTo(0,0),t.lineTo(-s,c/2),t.lineTo(-s,-c/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(n[0],n[1]),r?(a=(i[0]+i[2])/2-n[0],o=(i[1]+i[3])/2-n[1]):(a=n[2]-n[0],o=n[3]-n[1]),t.rotate((Math.atan2(-o,-a)+e)%e),t.moveTo(0,0),t.lineTo(-s,c/2),t.lineTo(-s,-c/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e}}}se.prototype.className="Arrow",a(se),C.addGetterSetter(se,"pointerLength",10,y()),C.addGetterSetter(se,"pointerWidth",10,y()),C.addGetterSetter(se,"pointerAtBeginning",!1),C.addGetterSetter(se,"pointerAtEnding",!0);class he extends Bt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}he.prototype._centroid=!0,he.prototype.className="Circle",he.prototype._attrsAffectingSize=["radius"],a(he),C.addGetterSetter(he,"radius",0,y());class le extends Bt{_sceneFunc(t){var e=this.radiusX(),n=this.radiusY();t.beginPath(),t.save(),e!==n&&t.scale(1,n/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}le.prototype.className="Ellipse",le.prototype._centroid=!0,le.prototype._attrsAffectingSize=["radiusX","radiusY"],a(le),C.addComponentsGetterSetter(le,"radius",["x","y"]),C.addGetterSetter(le,"radiusX",0,y()),C.addGetterSetter(le,"radiusY",0,y());class ce extends Bt{constructor(t){super(t),this.on("imageChange.konva",(()=>{this._setImageLoad()})),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",(()=>{this._requestDraw()}))}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),n=this.getHeight(),i=this.cornerRadius(),r=this.attrs.image;let a;if(r){const t=this.attrs.cropWidth,i=this.attrs.cropHeight;a=t&&i?[r,this.cropX(),this.cropY(),t,i,0,0,e,n]:[r,0,0,e,n]}(this.hasFill()||this.hasStroke()||i)&&(t.beginPath(),i?p.drawRoundedRectPath(t,e,n,i):t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)),r&&(i&&t.clip(),t.drawImage.apply(t,a))}_hitFunc(t){var e=this.width(),n=this.height(),i=this.cornerRadius();t.beginPath(),i?p.drawRoundedRectPath(t,e,n,i):t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,n=null){var i=p.createImageElement();i.onload=function(){var t=new ce({image:i});e(t)},i.onerror=n,i.crossOrigin="Anonymous",i.src=t}}ce.prototype.className="Image",a(ce),C.addGetterSetter(ce,"cornerRadius",0,m(4)),C.addGetterSetter(ce,"image"),C.addComponentsGetterSetter(ce,"crop",["x","y","width","height"]),C.addGetterSetter(ce,"cropX",0,y()),C.addGetterSetter(ce,"cropY",0,y()),C.addGetterSetter(ce,"cropWidth",0,y()),C.addGetterSetter(ce,"cropHeight",0,y());var de=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],ue="up",fe="right",pe="down",ge="left",ve=de.length;class ye extends qt{constructor(t){super(t),this.on("add.konva",(function(t){this._addListeners(t.child),this._sync()}))}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e,n=this,i=function(){n._sync()};for(e=0;e<ve;e++)t.on(de[e]+"Change.konva",i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t,e,n,i,r,a,o,s=this.getText(),h=this.getTag();if(s&&h){switch(t=s.width(),e=s.height(),n=h.pointerDirection(),i=h.pointerWidth(),o=h.pointerHeight(),r=0,a=0,n){case ue:r=t/2,a=-1*o;break;case fe:r=t+i,a=e/2;break;case pe:r=t/2,a=e+o;break;case ge:r=-1*i,a=e/2}h.setAttrs({x:-1*r,y:-1*a,width:t,height:e}),s.setAttrs({x:-1*r,y:-1*a})}}}ye.prototype.className="Label",a(ye);class me extends Bt{_sceneFunc(t){var e=this.width(),n=this.height(),i=this.pointerDirection(),r=this.pointerWidth(),a=this.pointerHeight(),o=this.cornerRadius();let s=0,h=0,l=0,c=0;"number"==typeof o?s=h=l=c=Math.min(o,e/2,n/2):(s=Math.min(o[0]||0,e/2,n/2),h=Math.min(o[1]||0,e/2,n/2),c=Math.min(o[2]||0,e/2,n/2),l=Math.min(o[3]||0,e/2,n/2)),t.beginPath(),t.moveTo(s,0),i===ue&&(t.lineTo((e-r)/2,0),t.lineTo(e/2,-1*a),t.lineTo((e+r)/2,0)),t.lineTo(e-h,0),t.arc(e-h,h,h,3*Math.PI/2,0,!1),i===fe&&(t.lineTo(e,(n-a)/2),t.lineTo(e+r,n/2),t.lineTo(e,(n+a)/2)),t.lineTo(e,n-c),t.arc(e-c,n-c,c,0,Math.PI/2,!1),i===pe&&(t.lineTo((e+r)/2,n),t.lineTo(e/2,n+a),t.lineTo((e-r)/2,n)),t.lineTo(l,n),t.arc(l,n-l,l,Math.PI/2,Math.PI,!1),i===ge&&(t.lineTo(0,(n+a)/2),t.lineTo(-1*r,n/2),t.lineTo(0,(n-a)/2)),t.lineTo(0,s),t.arc(s,s,s,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,n=this.pointerWidth(),i=this.pointerHeight(),r=this.pointerDirection(),a=this.width(),o=this.height();return r===ue?(e-=i,o+=i):r===pe?o+=i:r===ge?(t-=1.5*n,a+=n):r===fe&&(a+=1.5*n),{x:t,y:e,width:a,height:o}}}me.prototype.className="Tag",a(me),C.addGetterSetter(me,"pointerDirection","none"),C.addGetterSetter(me,"pointerWidth",0,y()),C.addGetterSetter(me,"pointerHeight",0,y()),C.addGetterSetter(me,"cornerRadius",0,m(4));class be extends Bt{_sceneFunc(t){var e=this.cornerRadius(),n=this.width(),i=this.height();t.beginPath(),e?p.drawRoundedRectPath(t,n,i,e):t.rect(0,0,n,i),t.closePath(),t.fillStrokeShape(this)}}be.prototype.className="Rect",a(be),C.addGetterSetter(be,"cornerRadius",0,m(4));class xe extends Bt{_sceneFunc(t){const e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,n=[];for(var i=0;i<t;i++)n.push({x:e*Math.sin(2*i*Math.PI/t),y:-1*e*Math.cos(2*i*Math.PI/t)});return n}getSelfRect(){const t=this._getPoints();var e=t[0].x,n=t[0].y,i=t[0].x,r=t[0].y;return t.forEach((t=>{e=Math.min(e,t.x),n=Math.max(n,t.x),i=Math.min(i,t.y),r=Math.max(r,t.y)})),{x:e,y:i,width:n-e,height:r-i}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}xe.prototype.className="RegularPolygon",xe.prototype._centroid=!0,xe.prototype._attrsAffectingSize=["radius"],a(xe),C.addGetterSetter(xe,"radius",0,y()),C.addGetterSetter(xe,"sides",0,y());var _e=2*Math.PI;class we extends Bt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,_e,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),_e,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}we.prototype.className="Ring",we.prototype._centroid=!0,we.prototype._attrsAffectingSize=["innerRadius","outerRadius"],a(we),C.addGetterSetter(we,"innerRadius",0,y()),C.addGetterSetter(we,"outerRadius",0,y());class Se extends Bt{constructor(t){super(t),this._updated=!0,this.anim=new Vt((()=>{var t=this._updated;return this._updated=!1,t})),this.on("animationChange.konva",(function(){this.frameIndex(0)})),this.on("frameIndexChange.konva",(function(){this._updated=!0})),this.on("frameRateChange.konva",(function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}))}_sceneFunc(t){var e=this.animation(),n=this.frameIndex(),i=4*n,r=this.animations()[e],a=this.frameOffsets(),o=r[i+0],s=r[i+1],h=r[i+2],l=r[i+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,h,l),t.closePath(),t.fillStrokeShape(this)),c)if(a){var d=a[e],u=2*n;t.drawImage(c,o,s,h,l,d[u+0],d[u+1],h,l)}else t.drawImage(c,o,s,h,l,0,0,h,l)}_hitFunc(t){var e=this.animation(),n=this.frameIndex(),i=4*n,r=this.animations()[e],a=this.frameOffsets(),o=r[i+2],s=r[i+3];if(t.beginPath(),a){var h=a[e],l=2*n;t.rect(h[l+0],h[l+1],o,s)}else t.rect(0,0,o,s);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval((function(){t._updateIndex()}),1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}Se.prototype.className="Sprite",a(Se),C.addGetterSetter(Se,"animation"),C.addGetterSetter(Se,"animations"),C.addGetterSetter(Se,"frameOffsets"),C.addGetterSetter(Se,"image"),C.addGetterSetter(Se,"frameIndex",0,y()),C.addGetterSetter(Se,"frameRate",17,y()),C.backCompat(Se,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class ke extends Bt{_sceneFunc(t){var e=this.innerRadius(),n=this.outerRadius(),i=this.numPoints();t.beginPath(),t.moveTo(0,0-n);for(var r=1;r<2*i;r++){var a=r%2==0?n:e,o=a*Math.sin(r*Math.PI/i),s=-1*a*Math.cos(r*Math.PI/i);t.lineTo(o,s)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}function Ce(t){return Array.from(t)}ke.prototype.className="Star",ke.prototype._centroid=!0,ke.prototype._attrsAffectingSize=["innerRadius","outerRadius"],a(ke),C.addGetterSetter(ke,"numPoints",5,y()),C.addGetterSetter(ke,"innerRadius",0,y()),C.addGetterSetter(ke,"outerRadius",0,y());var Pe,Te="auto",Ae="justify",Le="2d",Ee="left",Oe="middle",Me="normal",De=" ",Ge="none",Re=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Ie=Re.length;function Ne(){return Pe||(Pe=p.createCanvasElement().getContext(Le))}class Fe extends Bt{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<Ie;e++)this.on(Re[e]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,n=e.length;if(this.text()){var i,r=this.padding(),a=this.fontSize(),o=this.lineHeight()*a,s=this.verticalAlign(),h=0,l=this.align(),c=this.getWidth(),d=this.letterSpacing(),u=this.fill(),f=this.textDecoration(),p=-1!==f.indexOf("underline"),g=-1!==f.indexOf("line-through"),v=0,y=(v=o/2,0),m=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",Oe),t.setAttr("textAlign",Ee),s===Oe?h=(this.getHeight()-n*o-2*r)/2:"bottom"===s&&(h=this.getHeight()-n*o-2*r),t.translate(r,h+r),i=0;i<n;i++){y=0,m=0;var b,x,_,w=e[i],S=w.text,k=w.width,C=w.lastInParagraph;if(t.save(),"right"===l?y+=c-k-2*r:"center"===l&&(y+=(c-k-2*r)/2),p){t.save(),t.beginPath(),t.moveTo(y,v+m+Math.round(a/2)),x=0===(b=S.split(" ").length-1),_=l!==Ae||C?k:c-2*r,t.lineTo(y+Math.round(_),v+m+Math.round(a/2)),t.lineWidth=a/15;const e=this._getLinearGradient();t.strokeStyle=e||u,t.stroke(),t.restore()}if(g){t.save(),t.beginPath(),t.moveTo(y,v+m),x=0===(b=S.split(" ").length-1),_=l===Ae&&C&&!x?c-2*r:k,t.lineTo(y+Math.round(_),v+m),t.lineWidth=a/15;const e=this._getLinearGradient();t.strokeStyle=e||u,t.stroke(),t.restore()}if(0!==d||l===Ae){b=S.split(" ").length-1;for(var P=Ce(S),T=0;T<P.length;T++){var A=P[T];" "!==A||C||l!==Ae||(y+=(c-2*r-k)/b),this._partialTextX=y,this._partialTextY=v+m,this._partialText=A,t.fillStrokeShape(this),y+=this.measureSize(A).width+d}}else this._partialTextX=y,this._partialTextY=v+m,this._partialText=S,t.fillStrokeShape(this);t.restore(),n>1&&(v+=o)}}}_hitFunc(t){var e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=p._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===Te||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===Te||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return p.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,n=Ne(),i=this.fontSize();return n.save(),n.font=this._getContextFont(),e=n.measureText(t),n.restore(),{width:e.width,height:i}}_getContextFont(){return this.fontStyle()+De+this.fontVariant()+De+(this.fontSize()+"px ")+this.fontFamily().split(",").map((t=>{const e=(t=t.trim()).indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!n&&(t=`"${t}"`),t})).join(", ")}_addTextLine(t){this.align()===Ae&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),n=t.length;return Ne().measureText(t).width+(n?e*(n-1):0)}_setTextData(){var t=this.text().split("\n"),e=+this.fontSize(),n=0,i=this.lineHeight()*e,r=this.attrs.width,a=this.attrs.height,o=r!==Te&&void 0!==r,s=a!==Te&&void 0!==a,h=this.padding(),l=r-2*h,c=a-2*h,d=0,u=this.wrap(),f="char"!==u&&u!==Ge,p=this.ellipsis();this.textArr=[],Ne().font=this._getContextFont();for(var g=p?this._getTextWidth("…"):0,v=0,y=t.length;v<y;++v){var m=t[v],b=this._getTextWidth(m);if(o&&b>l)for(;m.length>0;){for(var x=0,_=m.length,w="",S=0;x<_;){var k=x+_>>>1,C=m.slice(0,k+1),P=this._getTextWidth(C)+g;P<=l?(x=k+1,w=C,S=P):_=k}if(!w)break;if(f){var T,A=m[w.length];(T=(A===De||"-"===A)&&S<=l?w.length:Math.max(w.lastIndexOf(De),w.lastIndexOf("-"))+1)>0&&(x=T,w=w.slice(0,x),S=this._getTextWidth(w))}if(w=w.trimRight(),this._addTextLine(w),n=Math.max(n,S),d+=i,this._shouldHandleEllipsis(d)){this._tryToAddEllipsisToLastLine();break}if((m=(m=m.slice(x)).trimLeft()).length>0&&(b=this._getTextWidth(m))<=l){this._addTextLine(m),d+=i,n=Math.max(n,b);break}}else this._addTextLine(m),d+=i,n=Math.max(n,b),this._shouldHandleEllipsis(d)&&v<y-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),s&&d+i>c)break}this.textHeight=e,this.textWidth=n}_shouldHandleEllipsis(t){var e=+this.fontSize(),n=this.lineHeight()*e,i=this.attrs.height,r=i!==Te&&void 0!==i,a=i-2*this.padding();return!(this.wrap()!==Ge)||r&&t+n>a}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e=t!==Te&&void 0!==t,n=t-2*this.padding(),i=this.ellipsis(),r=this.textArr[this.textArr.length-1];if(r&&i){if(e)this._getTextWidth(r.text+"…")<n||(r.text=r.text.slice(0,r.text.length-3));this.textArr.splice(this.textArr.length-1,1),this._addTextLine(r.text+"…")}}getStrokeScaleEnabled(){return!0}}Fe.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},Fe.prototype._strokeFunc=function(t){t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},Fe.prototype.className="Text",Fe.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],a(Fe),C.overWriteSetter(Fe,"width",b()),C.overWriteSetter(Fe,"height",b()),C.addGetterSetter(Fe,"fontFamily","Arial"),C.addGetterSetter(Fe,"fontSize",12,y()),C.addGetterSetter(Fe,"fontStyle",Me),C.addGetterSetter(Fe,"fontVariant",Me),C.addGetterSetter(Fe,"padding",0,y()),C.addGetterSetter(Fe,"align",Ee),C.addGetterSetter(Fe,"verticalAlign","top"),C.addGetterSetter(Fe,"lineHeight",1,y()),C.addGetterSetter(Fe,"wrap","word"),C.addGetterSetter(Fe,"ellipsis",!1,w()),C.addGetterSetter(Fe,"letterSpacing",0,y()),C.addGetterSetter(Fe,"text","",x()),C.addGetterSetter(Fe,"textDecoration","");var je="normal";function ze(t){t.fillText(this.partialText,0,0)}function Be(t){t.strokeText(this.partialText,0,0)}class He extends Bt{constructor(t){super(t),this.dummyCanvas=p.createCanvasElement(),this.dataArray=[],this.dataArray=oe.parsePathData(this.attrs.data),this.on("dataChange.konva",(function(){this.dataArray=oe.parsePathData(this.attrs.data),this._setTextData()})),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),n=this.fill(),i=this.fontSize(),r=this.glyphInfo;"underline"===e&&t.beginPath();for(var a=0;a<r.length;a++){t.save();var o=r[a].p0;t.translate(o.x,o.y),t.rotate(r[a].rotation),this.partialText=r[a].text,t.fillStrokeShape(this),"underline"===e&&(0===a&&t.moveTo(0,i/2+1),t.lineTo(i,i/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=n,t.lineWidth=i/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var n=e[0].p0;t.moveTo(n.x,n.y)}for(var i=0;i<e.length;i++){var r=e[i].p1;t.lineTo(r.x,r.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return p.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return Fe.prototype.setText.call(this,t)}_getContextFont(){return Fe.prototype._getContextFont.call(this)}_getTextSize(t){var e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();var n=e.measureText(t);return e.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}}_setTextData(){var t=this,e=this._getTextSize(this.attrs.text),n=this.letterSpacing(),i=this.align(),r=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var a=Math.max(this.textWidth+((this.attrs.text||"").length-1)*n,0);this.glyphInfo=[];for(var o=0,s=0;s<t.dataArray.length;s++)t.dataArray[s].pathLength>0&&(o+=t.dataArray[s].pathLength);var h=0;"center"===i&&(h=Math.max(0,o/2-a/2)),"right"===i&&(h=Math.max(0,o-a));for(var l,c,d,u=Ce(this.text()),f=this.text().split(" ").length-1,p=-1,g=0,v=function(){g=0;for(var e=t.dataArray,n=p+1;n<e.length;n++){if(e[n].pathLength>0)return p=n,e[n];"M"===e[n].command&&(l={x:e[n].points[0],y:e[n].points[1]})}return{}},y=function(e){var r=t._getTextSize(e).width+n;" "===e&&"justify"===i&&(r+=(o-a)/f);var s=0,h=0;for(c=void 0;Math.abs(r-s)/r>.01&&h<20;){h++;for(var u=s;void 0===d;)(d=v())&&u+d.pathLength<r&&(u+=d.pathLength,d=void 0);if(0===Object.keys(d).length||void 0===l)return;var p=!1;switch(d.command){case"L":oe.getLineLength(l.x,l.y,d.points[0],d.points[1])>r?c=oe.getPointOnLine(r,l.x,l.y,d.points[0],d.points[1],l.x,l.y):d=void 0;break;case"A":var y=d.points[4],m=d.points[5],b=d.points[4]+m;0===g?g=y+1e-8:r>s?g+=Math.PI/180*m/Math.abs(m):g-=Math.PI/360*m/Math.abs(m),(m<0&&g<b||m>=0&&g>b)&&(g=b,p=!0),c=oe.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],g,d.points[6]);break;case"C":0===g?g=r>d.pathLength?1e-8:r/d.pathLength:r>s?g+=(r-s)/d.pathLength/2:g=Math.max(g-(s-r)/d.pathLength/2,0),g>1&&(g=1,p=!0),c=oe.getPointOnCubicBezier(g,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3],d.points[4],d.points[5]);break;case"Q":0===g?g=r/d.pathLength:r>s?g+=(r-s)/d.pathLength:g-=(s-r)/d.pathLength,g>1&&(g=1,p=!0),c=oe.getPointOnQuadraticBezier(g,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3])}void 0!==c&&(s=oe.getLineLength(l.x,l.y,c.x,c.y)),p&&(p=!1,d=void 0)}},m=h/(t._getTextSize("C").width+n)-1,b=0;b<m&&(y("C"),void 0!==l&&void 0!==c);b++)l=c;for(var x=0;x<u.length&&(y(u[x]),void 0!==l&&void 0!==c);x++){var _=oe.getLineLength(l.x,l.y,c.x,c.y),w=0;if(r)try{w=r(u[x-1],u[x])*this.fontSize()}catch(t){w=0}l.x+=w,c.x+=w,this.textWidth+=w;var S=oe.getPointOnLine(w+_/2,l.x,l.y,c.x,c.y),k=Math.atan2(c.y-l.y,c.x-l.x);this.glyphInfo.push({transposeX:S.x,transposeY:S.y,text:u[x],rotation:k,p0:l,p1:c}),l=c}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach((function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)}));for(var e,n,i=t[0]||0,r=t[0]||0,a=t[1]||0,o=t[1]||0,s=0;s<t.length/2;s++)e=t[2*s],n=t[2*s+1],i=Math.min(i,e),r=Math.max(r,e),a=Math.min(a,n),o=Math.max(o,n);var h=this.fontSize();return{x:i-h/2,y:a-h/2,width:r-i+h,height:o-a+h}}destroy(){return p.releaseCanvas(this.dummyCanvas),super.destroy()}}He.prototype._fillFunc=ze,He.prototype._strokeFunc=Be,He.prototype._fillFuncHit=ze,He.prototype._strokeFuncHit=Be,He.prototype.className="TextPath",He.prototype._attrsAffectingSize=["text","fontSize","data"],a(He),C.addGetterSetter(He,"data"),C.addGetterSetter(He,"fontFamily","Arial"),C.addGetterSetter(He,"fontSize",12,y()),C.addGetterSetter(He,"fontStyle",je),C.addGetterSetter(He,"align","left"),C.addGetterSetter(He,"letterSpacing",0,y()),C.addGetterSetter(He,"textBaseline","middle"),C.addGetterSetter(He,"fontVariant",je),C.addGetterSetter(He,"text",""),C.addGetterSetter(He,"textDecoration",null),C.addGetterSetter(He,"kerningFunc",null);var We="tr-konva",Ye=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map((t=>t+`.${We}`)).join(" "),Xe="nodesRect",qe=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],Ue={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const Ve="ontouchstart"in r._global;var Ke=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Je(t,e,n){const i=n.x+(t.x-n.x)*Math.cos(e)-(t.y-n.y)*Math.sin(e),r=n.y+(t.x-n.x)*Math.sin(e)+(t.y-n.y)*Math.cos(e);return Object.assign(Object.assign({},t),{rotation:t.rotation+e,x:i,y:r})}function Qe(t,e){const n=function(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}(t);return Je(t,e,n)}class $e extends qt{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Ye,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return p.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return We+this._id}setNodes(t=[]){return this._nodes&&this._nodes.length&&this.detach(),this._nodes=t,1===t.length&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach((t=>{const e=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()},n=t._attrsAffectingSize.map((t=>t+"Change."+this._getEventNamespace())).join(" ");t.on(n,e),t.on(qe.map((t=>t+`.${this._getEventNamespace()}`)).join(" "),e),t.on(`absoluteTransformChange.${this._getEventNamespace()}`,e),this._proxyDrag(t)})),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,(n=>{e=t.getAbsolutePosition(),this.isDragging()||t===this.findOne(".back")||this.startDrag(n,!1)})),t.on(`dragmove.${this._getEventNamespace()}`,(n=>{if(!e)return;const i=t.getAbsolutePosition(),r=i.x-e.x,a=i.y-e.y;this.nodes().forEach((e=>{if(e===t)return;if(e.isDragging())return;const i=e.getAbsolutePosition();e.setAbsolutePosition({x:i.x+r,y:i.y+a}),e.startDrag(n)})),e=null}))}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach((t=>{t.off("."+this._getEventNamespace())})),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Xe),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Xe,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),n){var i=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),a=t.getAbsoluteScale(n),o=t.getAbsolutePosition(n),s=i.x*a.x-t.offsetX()*a.x,h=i.y*a.y-t.offsetY()*a.y;const l=(r.getAngle(t.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return Je({x:o.x+s*Math.cos(l)+h*Math.sin(-l),y:o.y+h*Math.cos(l)+s*Math.sin(l),width:i.width*a.x,height:i.height*a.y,rotation:l},-r.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map((e=>{const n=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var i=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}],r=e.getAbsoluteTransform();i.forEach((function(e){var n=r.point(e);t.push(n)}))}));const e=new o;var n,i,a,s;e.rotate(-r.getAngle(this.rotation())),t.forEach((function(t){var r=e.point(t);void 0===n&&(n=a=r.x,i=s=r.y),n=Math.min(n,r.x),i=Math.min(i,r.y),a=Math.max(a,r.x),s=Math.max(s,r.y)})),e.invert();const h=e.point({x:n,y:i});return{x:h.x,y:h.y,width:a-n,height:s-i,rotation:r.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Ke.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new be({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Ve?10:"auto"}),n=this;e.on("mousedown touchstart",(function(t){n._handleMouseDown(t)})),e.on("dragstart",(t=>{e.stopDrag(),t.cancelBubble=!0})),e.on("dragend",(t=>{t.cancelBubble=!0})),e.on("mouseenter",(()=>{var n=r.getAngle(this.rotation()),i=function(t,e){if("rotater"===t)return"crosshair";e+=p.degToRad(Ue[t]||0);var n=(p.radToDeg(e)%360+360)%360;return p._inRange(n,337.5,360)||p._inRange(n,0,22.5)?"ns-resize":p._inRange(n,22.5,67.5)?"nesw-resize":p._inRange(n,67.5,112.5)?"ew-resize":p._inRange(n,112.5,157.5)?"nwse-resize":p._inRange(n,157.5,202.5)?"ns-resize":p._inRange(n,202.5,247.5)?"nesw-resize":p._inRange(n,247.5,292.5)?"ew-resize":p._inRange(n,292.5,337.5)?"nwse-resize":(p.error("Transformer has unknown angle for cursor detection: "+n),"pointer")}(t,n);e.getStage().content&&(e.getStage().content.style.cursor=i),this._cursorChange=!0})),e.on("mouseout",(()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1})),this.add(e)}_createBack(){var t=new Bt({name:"back",width:0,height:0,draggable:!0,sceneFunc(t){var e=this.getParent(),n=e.padding();t.beginPath(),t.rect(-n,-n,this.width()+2*n,this.height()+2*n),t.moveTo(this.width()/2,-n),e.rotateEnabled()&&t.lineTo(this.width()/2,-e.rotateAnchorOffset()*p._sign(this.height())-n),t.fillStrokeShape(this)},hitFunc:(t,e)=>{if(this.shouldOverdrawWholeArea()){var n=this.padding();t.beginPath(),t.rect(-n,-n,e.width()+2*n,e.height()+2*n),t.fillStrokeShape(e)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",(t=>{t.cancelBubble=!0})),t.on("dragmove",(t=>{t.cancelBubble=!0})),t.on("dragend",(t=>{t.cancelBubble=!0})),this.on("dragmove",(t=>{this.update()}))}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),n=e.width,i=e.height,r=Math.sqrt(Math.pow(n,2)+Math.pow(i,2));this.sin=Math.abs(i/r),this.cos=Math.abs(n/r),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var a=t.target.getAbsolutePosition(),o=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:o.x-a.x,y:o.y-a.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach((e=>{e._fire("transformstart",{evt:t.evt,target:e})}))}_handleMouseMove(t){var e,n,i,a=this.findOne("."+this._movingAnchorName),o=a.getStage();o.setPointersPositions(t);const s=o.getPointerPosition();let h={x:s.x-this._anchorDragOffset.x,y:s.y-this._anchorDragOffset.y};const l=a.getAbsolutePosition();this.anchorDragBoundFunc()&&(h=this.anchorDragBoundFunc()(l,h,t)),a.setAbsolutePosition(h);const c=a.getAbsolutePosition();if(l.x!==c.x||l.y!==c.y)if("rotater"!==this._movingAnchorName){var d=this.keepRatio()||t.shiftKey,u=this.centeredScaling()||t.altKey;if("top-left"===this._movingAnchorName){if(d){var f=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(f.x-a.x(),2)+Math.pow(f.y-a.y(),2));var p=this.findOne(".top-left").x()>f.x?-1:1,g=this.findOne(".top-left").y()>f.y?-1:1;e=i*this.cos*p,n=i*this.sin*g,this.findOne(".top-left").x(f.x-e),this.findOne(".top-left").y(f.y-n)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(a.y());else if("top-right"===this._movingAnchorName){if(d){f=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(a.x()-f.x,2)+Math.pow(f.y-a.y(),2));p=this.findOne(".top-right").x()<f.x?-1:1,g=this.findOne(".top-right").y()>f.y?-1:1;e=i*this.cos*p,n=i*this.sin*g,this.findOne(".top-right").x(f.x+e),this.findOne(".top-right").y(f.y-n)}var v=a.position();this.findOne(".top-left").y(v.y),this.findOne(".bottom-right").x(v.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(a.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(a.x());else if("bottom-left"===this._movingAnchorName){if(d){f=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(f.x-a.x(),2)+Math.pow(a.y()-f.y,2));p=f.x<a.x()?-1:1,g=a.y()<f.y?-1:1;e=i*this.cos*p,n=i*this.sin*g,a.x(f.x-e),a.y(f.y+n)}v=a.position(),this.findOne(".top-left").x(v.x),this.findOne(".bottom-right").y(v.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(a.y());else if("bottom-right"===this._movingAnchorName){if(d){f=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(a.x()-f.x,2)+Math.pow(a.y()-f.y,2));p=this.findOne(".bottom-right").x()<f.x?-1:1,g=this.findOne(".bottom-right").y()<f.y?-1:1;e=i*this.cos*p,n=i*this.sin*g,this.findOne(".bottom-right").x(f.x+e),this.findOne(".bottom-right").y(f.y+n)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(u=this.centeredScaling()||t.altKey){var y=this.findOne(".top-left"),m=this.findOne(".bottom-right"),b=y.x(),x=y.y(),_=this.getWidth()-m.x(),w=this.getHeight()-m.y();m.move({x:-b,y:-x}),y.move({x:_,y:w})}var S=this.findOne(".top-left").getAbsolutePosition();e=S.x,n=S.y;var k=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),C=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:n,width:k,height:C,rotation:r.getAngle(this.rotation())},t)}else{var P=this._getNodeRect();e=a.x()-P.width/2,n=-a.y()+P.height/2;let i=Math.atan2(-n,e)+Math.PI/2;P.height<0&&(i-=Math.PI);const o=r.getAngle(this.rotation())+i,s=r.getAngle(this.rotationSnapTolerance()),h=Qe(P,function(t,e,n){let i=e;for(let a=0;a<t.length;a++){const o=r.getAngle(t[a]),s=Math.abs(o-e)%(2*Math.PI);Math.min(s,2*Math.PI-s)<n&&(i=o)}return i}(this.rotationSnaps(),o,s)-P.rotation);this._fitNodesInto(h,t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach((e=>{e._fire("transformend",{evt:t,target:e})})),this._movingAnchorName=null}}_fitNodesInto(t,e){var n=this._getNodeRect();if(p._inRange(t.width,2*-this.padding()-1,1))return void this.update();if(p._inRange(t.height,2*-this.padding()-1,1))return void this.update();const i=this.flipEnabled();var a=new o;if(a.rotate(r.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const e=a.point({x:2*-this.padding(),y:0});if(t.x+=e.x,t.y+=e.y,t.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,!i)return void this.update()}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const e=a.point({x:2*this.padding(),y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.width+=2*this.padding(),!i)return void this.update()}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const e=a.point({x:0,y:2*-this.padding()});if(t.x+=e.x,t.y+=e.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!i)return void this.update()}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const e=a.point({x:0,y:2*this.padding()});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!i)return void this.update()}if(this.boundBoxFunc()){const e=this.boundBoxFunc()(n,t);e?t=e:p.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const s=1e7,h=new o;h.translate(n.x,n.y),h.rotate(n.rotation),h.scale(n.width/s,n.height/s);const l=new o;l.translate(t.x,t.y),l.rotate(t.rotation),l.scale(t.width/s,t.height/s);const c=l.multiply(h.invert());this._nodes.forEach((t=>{var n;const i=t.getParent().getAbsoluteTransform(),r=t.getTransform().copy();r.translate(t.offsetX(),t.offsetY());const a=new o;a.multiply(i.copy().invert()).multiply(c).multiply(i).multiply(r);const s=a.decompose();t.setAttrs(s),this._fire("transform",{evt:e,target:t}),t._fire("transform",{evt:e,target:t}),null===(n=t.getLayer())||void 0===n||n.batchDraw()})),this.rotation(p._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(p._getRotation(e.rotation));var n=e.width,i=e.height,r=this.enabledAnchors(),a=this.resizeEnabled(),o=this.padding(),s=this.anchorSize();this.find("._anchor").forEach((t=>{t.setAttrs({width:s,height:s,offsetX:s/2,offsetY:s/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})})),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:s/2+o,offsetY:s/2+o,visible:a&&r.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:n/2,y:0,offsetY:s/2+o,visible:a&&r.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:n,y:0,offsetX:s/2-o,offsetY:s/2+o,visible:a&&r.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:s/2+o,visible:a&&r.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:n,y:i/2,offsetX:s/2-o,visible:a&&r.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:s/2+o,offsetY:s/2-o,visible:a&&r.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:n/2,y:i,offsetY:s/2-o,visible:a&&r.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:n,y:i,offsetX:s/2-o,offsetY:s/2-o,visible:a&&r.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:n/2,y:-this.rotateAnchorOffset()*p._sign(i)-o,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:n,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),null===(t=this.getLayer())||void 0===t||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),qt.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return J.prototype.toObject.call(this)}clone(t){return J.prototype.clone.call(this,t)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}$e.prototype.className="Transformer",a($e),C.addGetterSetter($e,"enabledAnchors",Ke,(function(t){return t instanceof Array||p.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach((function(t){-1===Ke.indexOf(t)&&p.warn("Unknown anchor name: "+t+". Available names are: "+Ke.join(", "))})),t||[]})),C.addGetterSetter($e,"flipEnabled",!0,w()),C.addGetterSetter($e,"resizeEnabled",!0),C.addGetterSetter($e,"anchorSize",10,y()),C.addGetterSetter($e,"rotateEnabled",!0),C.addGetterSetter($e,"rotationSnaps",[]),C.addGetterSetter($e,"rotateAnchorOffset",50,y()),C.addGetterSetter($e,"rotationSnapTolerance",5,y()),C.addGetterSetter($e,"borderEnabled",!0),C.addGetterSetter($e,"anchorStroke","rgb(0, 161, 255)"),C.addGetterSetter($e,"anchorStrokeWidth",1,y()),C.addGetterSetter($e,"anchorFill","white"),C.addGetterSetter($e,"anchorCornerRadius",0,y()),C.addGetterSetter($e,"borderStroke","rgb(0, 161, 255)"),C.addGetterSetter($e,"borderStrokeWidth",1,y()),C.addGetterSetter($e,"borderDash"),C.addGetterSetter($e,"keepRatio",!0),C.addGetterSetter($e,"centeredScaling",!1),C.addGetterSetter($e,"ignoreStroke",!1),C.addGetterSetter($e,"padding",0,y()),C.addGetterSetter($e,"node"),C.addGetterSetter($e,"nodes"),C.addGetterSetter($e,"boundBoxFunc"),C.addGetterSetter($e,"anchorDragBoundFunc"),C.addGetterSetter($e,"shouldOverdrawWholeArea",!1),C.addGetterSetter($e,"useSingleNodeRotation",!0),C.backCompat($e,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Ze extends Bt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,r.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}function tn(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}Ze.prototype.className="Wedge",Ze.prototype._centroid=!0,Ze.prototype._attrsAffectingSize=["radius"],a(Ze),C.addGetterSetter(Ze,"radius",0,y()),C.addGetterSetter(Ze,"angle",0,y()),C.addGetterSetter(Ze,"clockwise",!1),C.backCompat(Ze,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var en=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],nn=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];C.addGetterSetter(J,"blurRadius",0,y(),C.afterSetFilter);C.addGetterSetter(J,"brightness",0,y(),C.afterSetFilter);C.addGetterSetter(J,"contrast",0,y(),C.afterSetFilter);function rn(t,e,n,i,r){var a=n-e,o=r-i;return 0===a?i+o/2:0===o?i:o*((t-e)/a)+i}C.addGetterSetter(J,"embossStrength",.5,y(),C.afterSetFilter),C.addGetterSetter(J,"embossWhiteLevel",.5,y(),C.afterSetFilter),C.addGetterSetter(J,"embossDirection","top-left",null,C.afterSetFilter),C.addGetterSetter(J,"embossBlend",!1,null,C.afterSetFilter);C.addGetterSetter(J,"enhance",0,y(),C.afterSetFilter);C.addGetterSetter(J,"hue",0,y(),C.afterSetFilter),C.addGetterSetter(J,"saturation",0,y(),C.afterSetFilter),C.addGetterSetter(J,"luminance",0,y(),C.afterSetFilter);C.addGetterSetter(J,"hue",0,y(),C.afterSetFilter),C.addGetterSetter(J,"saturation",0,y(),C.afterSetFilter),C.addGetterSetter(J,"value",0,y(),C.afterSetFilter);function an(t,e,n){var i=4*(n*t.width+e),r=[];return r.push(t.data[i++],t.data[i++],t.data[i++],t.data[i++]),r}function on(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}C.addGetterSetter(J,"kaleidoscopePower",2,y(),C.afterSetFilter),C.addGetterSetter(J,"kaleidoscopeAngle",0,y(),C.afterSetFilter);C.addGetterSetter(J,"threshold",0,y(),C.afterSetFilter);C.addGetterSetter(J,"noise",.2,y(),C.afterSetFilter);C.addGetterSetter(J,"pixelSize",8,y(),C.afterSetFilter);C.addGetterSetter(J,"levels",.5,y(),C.afterSetFilter);C.addGetterSetter(J,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),C.addGetterSetter(J,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),C.addGetterSetter(J,"blue",0,v,C.afterSetFilter);C.addGetterSetter(J,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),C.addGetterSetter(J,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),C.addGetterSetter(J,"blue",0,v,C.afterSetFilter),C.addGetterSetter(J,"alpha",1,(function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t}));C.addGetterSetter(J,"threshold",.5,y(),C.afterSetFilter);const sn=ee.Util._assign(ee,{Arc:ne,Arrow:se,Circle:he,Ellipse:le,Image:ce,Label:ye,Tag:me,Line:ae,Path:oe,Rect:be,RegularPolygon:xe,Ring:we,Sprite:Se,Star:ke,Text:Fe,TextPath:He,Transformer:$e,Wedge:Ze,Filters:{Blur:function(t){var e=Math.round(this.blurRadius());e>0&&function(t,e){var n,i,r,a,o,s,h,l,c,d,u,f,p,g,v,y,m,b,x,_,w,S,k,C,P=t.data,T=t.width,A=t.height,L=e+e+1,E=T-1,O=A-1,M=e+1,D=M*(M+1)/2,G=new tn,R=null,I=G,N=null,F=null,j=en[e],z=nn[e];for(r=1;r<L;r++)I=I.next=new tn,r===M&&(R=I);for(I.next=G,h=s=0,i=0;i<A;i++){for(y=m=b=x=l=c=d=u=0,f=M*(_=P[s]),p=M*(w=P[s+1]),g=M*(S=P[s+2]),v=M*(k=P[s+3]),l+=D*_,c+=D*w,d+=D*S,u+=D*k,I=G,r=0;r<M;r++)I.r=_,I.g=w,I.b=S,I.a=k,I=I.next;for(r=1;r<M;r++)a=s+((E<r?E:r)<<2),l+=(I.r=_=P[a])*(C=M-r),c+=(I.g=w=P[a+1])*C,d+=(I.b=S=P[a+2])*C,u+=(I.a=k=P[a+3])*C,y+=_,m+=w,b+=S,x+=k,I=I.next;for(N=G,F=R,n=0;n<T;n++)P[s+3]=k=u*j>>z,0!==k?(k=255/k,P[s]=(l*j>>z)*k,P[s+1]=(c*j>>z)*k,P[s+2]=(d*j>>z)*k):P[s]=P[s+1]=P[s+2]=0,l-=f,c-=p,d-=g,u-=v,f-=N.r,p-=N.g,g-=N.b,v-=N.a,a=h+((a=n+e+1)<E?a:E)<<2,l+=y+=N.r=P[a],c+=m+=N.g=P[a+1],d+=b+=N.b=P[a+2],u+=x+=N.a=P[a+3],N=N.next,f+=_=F.r,p+=w=F.g,g+=S=F.b,v+=k=F.a,y-=_,m-=w,b-=S,x-=k,F=F.next,s+=4;h+=T}for(n=0;n<T;n++){for(m=b=x=y=c=d=u=l=0,f=M*(_=P[s=n<<2]),p=M*(w=P[s+1]),g=M*(S=P[s+2]),v=M*(k=P[s+3]),l+=D*_,c+=D*w,d+=D*S,u+=D*k,I=G,r=0;r<M;r++)I.r=_,I.g=w,I.b=S,I.a=k,I=I.next;for(o=T,r=1;r<=e;r++)s=o+n<<2,l+=(I.r=_=P[s])*(C=M-r),c+=(I.g=w=P[s+1])*C,d+=(I.b=S=P[s+2])*C,u+=(I.a=k=P[s+3])*C,y+=_,m+=w,b+=S,x+=k,I=I.next,r<O&&(o+=T);for(s=n,N=G,F=R,i=0;i<A;i++)P[3+(a=s<<2)]=k=u*j>>z,k>0?(k=255/k,P[a]=(l*j>>z)*k,P[a+1]=(c*j>>z)*k,P[a+2]=(d*j>>z)*k):P[a]=P[a+1]=P[a+2]=0,l-=f,c-=p,d-=g,u-=v,f-=N.r,p-=N.g,g-=N.b,v-=N.a,a=n+((a=i+M)<O?a:O)*T<<2,l+=y+=N.r=P[a],c+=m+=N.g=P[a+1],d+=b+=N.b=P[a+2],u+=x+=N.a=P[a+3],N=N.next,f+=_=F.r,p+=w=F.g,g+=S=F.b,v+=k=F.a,y-=_,m-=w,b-=S,x-=k,F=F.next,s+=T}}(t,e)},Brighten:function(t){var e,n=255*this.brightness(),i=t.data,r=i.length;for(e=0;e<r;e+=4)i[e]+=n,i[e+1]+=n,i[e+2]+=n},Contrast:function(t){var e,n=Math.pow((this.contrast()+100)/100,2),i=t.data,r=i.length,a=150,o=150,s=150;for(e=0;e<r;e+=4)a=i[e],o=i[e+1],s=i[e+2],a/=255,a-=.5,a*=n,a+=.5,o/=255,o-=.5,o*=n,o+=.5,s/=255,s-=.5,s*=n,s+=.5,a=(a*=255)<0?0:a>255?255:a,o=(o*=255)<0?0:o>255?255:o,s=(s*=255)<0?0:s>255?255:s,i[e]=a,i[e+1]=o,i[e+2]=s},Emboss:function(t){var e=10*this.embossStrength(),n=255*this.embossWhiteLevel(),i=this.embossDirection(),r=this.embossBlend(),a=0,o=0,s=t.data,h=t.width,l=t.height,c=4*h,d=l;switch(i){case"top-left":a=-1,o=-1;break;case"top":a=-1,o=0;break;case"top-right":a=-1,o=1;break;case"right":a=0,o=1;break;case"bottom-right":a=1,o=1;break;case"bottom":a=1,o=0;break;case"bottom-left":a=1,o=-1;break;case"left":a=0,o=-1;break;default:p.error("Unknown emboss direction: "+i)}do{var u=(d-1)*c,f=a;d+f<1&&(f=0),d+f>l&&(f=0);var g=(d-1+f)*h*4,v=h;do{var y=u+4*(v-1),m=o;v+m<1&&(m=0),v+m>h&&(m=0);var b=g+4*(v-1+m),x=s[y]-s[b],_=s[y+1]-s[b+1],w=s[y+2]-s[b+2],S=x,k=S>0?S:-S;if((_>0?_:-_)>k&&(S=_),(w>0?w:-w)>k&&(S=w),S*=e,r){var C=s[y]+S,P=s[y+1]+S,T=s[y+2]+S;s[y]=C>255?255:C<0?0:C,s[y+1]=P>255?255:P<0?0:P,s[y+2]=T>255?255:T<0?0:T}else{var A=n-S;A<0?A=0:A>255&&(A=255),s[y]=s[y+1]=s[y+2]=A}}while(--v)}while(--d)},Enhance:function(t){var e,n,i,r,a=t.data,o=a.length,s=a[0],h=s,l=a[1],c=l,d=a[2],u=d,f=this.enhance();if(0!==f){for(r=0;r<o;r+=4)(e=a[r+0])<s?s=e:e>h&&(h=e),(n=a[r+1])<l?l=n:n>c&&(c=n),(i=a[r+2])<d?d=i:i>u&&(u=i);var p,g,v,y,m,b,x,_,w;for(h===s&&(h=255,s=0),c===l&&(c=255,l=0),u===d&&(u=255,d=0),f>0?(g=h+f*(255-h),v=s-f*(s-0),m=c+f*(255-c),b=l-f*(l-0),_=u+f*(255-u),w=d-f*(d-0)):(g=h+f*(h-(p=.5*(h+s))),v=s+f*(s-p),m=c+f*(c-(y=.5*(c+l))),b=l+f*(l-y),_=u+f*(u-(x=.5*(u+d))),w=d+f*(d-x)),r=0;r<o;r+=4)a[r+0]=rn(a[r+0],s,h,v,g),a[r+1]=rn(a[r+1],l,c,b,m),a[r+2]=rn(a[r+2],d,u,w,_)}},Grayscale:function(t){var e,n,i=t.data,r=i.length;for(e=0;e<r;e+=4)n=.34*i[e]+.5*i[e+1]+.16*i[e+2],i[e]=n,i[e+1]=n,i[e+2]=n},HSL:function(t){var e,n,i,r,a,o=t.data,s=o.length,h=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,c=127*this.luminance(),d=1*h*Math.cos(l*Math.PI/180),u=1*h*Math.sin(l*Math.PI/180),f=.299+.701*d+.167*u,p=.587-.587*d+.33*u,g=.114-.114*d-.497*u,v=.299-.299*d-.328*u,y=.587+.413*d+.035*u,m=.114-.114*d+.293*u,b=.299-.3*d+1.25*u,x=.587-.586*d-1.05*u,_=.114+.886*d-.2*u;for(e=0;e<s;e+=4)n=o[e+0],i=o[e+1],r=o[e+2],a=o[e+3],o[e+0]=f*n+p*i+g*r+c,o[e+1]=v*n+y*i+m*r+c,o[e+2]=b*n+x*i+_*r+c,o[e+3]=a},HSV:function(t){var e,n,i,r,a,o=t.data,s=o.length,h=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,d=h*l*Math.cos(c*Math.PI/180),u=h*l*Math.sin(c*Math.PI/180),f=.299*h+.701*d+.167*u,p=.587*h-.587*d+.33*u,g=.114*h-.114*d-.497*u,v=.299*h-.299*d-.328*u,y=.587*h+.413*d+.035*u,m=.114*h-.114*d+.293*u,b=.299*h-.3*d+1.25*u,x=.587*h-.586*d-1.05*u,_=.114*h+.886*d-.2*u;for(e=0;e<s;e+=4)n=o[e+0],i=o[e+1],r=o[e+2],a=o[e+3],o[e+0]=f*n+p*i+g*r,o[e+1]=v*n+y*i+m*r,o[e+2]=b*n+x*i+_*r,o[e+3]=a},Invert:function(t){var e,n=t.data,i=n.length;for(e=0;e<i;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2]},Kaleidoscope:function(t){var e,n,i,r,a,o,s,h,l,c=t.width,d=t.height,u=Math.round(this.kaleidoscopePower()),f=Math.round(this.kaleidoscopeAngle()),g=Math.floor(c*(f%360)/360);if(!(u<1)){var v=p.createCanvasElement();v.width=c,v.height=d;var y=v.getContext("2d").getImageData(0,0,c,d);p.releaseCanvas(v),function(t,e,n){var i,r,a,o,s=t.data,h=e.data,l=t.width,c=t.height,d=n.polarCenterX||l/2,u=n.polarCenterY||c/2,f=0,p=0,g=0,v=0,y=Math.sqrt(d*d+u*u);r=l-d,a=c-u,y=(o=Math.sqrt(r*r+a*a))>y?o:y;var m,b,x,_,w=c,S=l,k=360/S*Math.PI/180;for(b=0;b<S;b+=1)for(x=Math.sin(b*k),_=Math.cos(b*k),m=0;m<w;m+=1)r=Math.floor(d+y*m/w*_),f=s[0+(i=4*((a=Math.floor(u+y*m/w*x))*l+r))],p=s[i+1],g=s[i+2],v=s[i+3],h[0+(i=4*(b+m*l))]=f,h[i+1]=p,h[i+2]=g,h[i+3]=v}(t,y,{polarCenterX:c/2,polarCenterY:d/2});for(var m=c/Math.pow(2,u);m<=8;)m*=2,u-=1;var b=m=Math.ceil(m),x=0,_=b,w=1;for(g+m>c&&(x=b,_=0,w=-1),n=0;n<d;n+=1)for(e=x;e!==_;e+=w)h=4*(c*n+Math.round(e+g)%c),r=y.data[h+0],a=y.data[h+1],o=y.data[h+2],s=y.data[h+3],l=4*(c*n+e),y.data[l+0]=r,y.data[l+1]=a,y.data[l+2]=o,y.data[l+3]=s;for(n=0;n<d;n+=1)for(b=Math.floor(m),i=0;i<u;i+=1){for(e=0;e<b+1;e+=1)h=4*(c*n+e),r=y.data[h+0],a=y.data[h+1],o=y.data[h+2],s=y.data[h+3],l=4*(c*n+2*b-e-1),y.data[l+0]=r,y.data[l+1]=a,y.data[l+2]=o,y.data[l+3]=s;b*=2}!function(t,e,n){var i,r,a,o,s,h,l=t.data,c=e.data,d=t.width,u=t.height,f=n.polarCenterX||d/2,p=n.polarCenterY||u/2,g=0,v=0,y=0,m=0,b=Math.sqrt(f*f+p*p);r=d-f,a=u-p,b=(h=Math.sqrt(r*r+a*a))>b?h:b;var x,_,w,S=u,k=d,C=n.polarRotation||0;for(r=0;r<d;r+=1)for(a=0;a<u;a+=1)o=r-f,s=a-p,x=Math.sqrt(o*o+s*s)*S/b,_=(_=(180*Math.atan2(s,o)/Math.PI+360+C)%360)*k/360,w=Math.floor(_),g=l[0+(i=4*(Math.floor(x)*d+w))],v=l[i+1],y=l[i+2],m=l[i+3],c[0+(i=4*(a*d+r))]=g,c[i+1]=v,c[i+2]=y,c[i+3]=m}(y,t,{polarRotation:0})}},Mask:function(t){var e=function(t,e){var n=an(t,0,0),i=an(t,t.width-1,0),r=an(t,0,t.height-1),a=an(t,t.width-1,t.height-1),o=e||10;if(on(n,i)<o&&on(i,a)<o&&on(a,r)<o&&on(r,n)<o){for(var s=function(t){for(var e=[0,0,0],n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}([i,n,a,r]),h=[],l=0;l<t.width*t.height;l++){var c=on(s,[t.data[4*l],t.data[4*l+1],t.data[4*l+2]]);h[l]=c<o?0:255}return h}}(t,this.threshold());return e&&function(t,e){for(var n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}(t,e=function(t,e,n){for(var i=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],r=Math.round(Math.sqrt(i.length)),a=Math.floor(r/2),o=[],s=0;s<n;s++)for(var h=0;h<e;h++){for(var l=s*e+h,c=0,d=0;d<r;d++)for(var u=0;u<r;u++){var f=s+d-a,p=h+u-a;if(f>=0&&f<n&&p>=0&&p<e){var g=i[d*r+u];c+=t[f*e+p]*g}}o[l]=c}return o}(e=function(t,e,n){for(var i=[1,1,1,1,1,1,1,1,1],r=Math.round(Math.sqrt(i.length)),a=Math.floor(r/2),o=[],s=0;s<n;s++)for(var h=0;h<e;h++){for(var l=s*e+h,c=0,d=0;d<r;d++)for(var u=0;u<r;u++){var f=s+d-a,p=h+u-a;if(f>=0&&f<n&&p>=0&&p<e){var g=i[d*r+u];c+=t[f*e+p]*g}}o[l]=c>=1020?255:0}return o}(e=function(t,e,n){for(var i=[1,1,1,1,0,1,1,1,1],r=Math.round(Math.sqrt(i.length)),a=Math.floor(r/2),o=[],s=0;s<n;s++)for(var h=0;h<e;h++){for(var l=s*e+h,c=0,d=0;d<r;d++)for(var u=0;u<r;u++){var f=s+d-a,p=h+u-a;if(f>=0&&f<n&&p>=0&&p<e){var g=i[d*r+u];c+=t[f*e+p]*g}}o[l]=2040===c?255:0}return o}(e,t.width,t.height),t.width,t.height),t.width,t.height)),t},Noise:function(t){var e,n=255*this.noise(),i=t.data,r=i.length,a=n/2;for(e=0;e<r;e+=4)i[e+0]+=a-2*a*Math.random(),i[e+1]+=a-2*a*Math.random(),i[e+2]+=a-2*a*Math.random()},Pixelate:function(t){var e,n,i,r,a,o,s,h,l,c,d,u,f,g,v=Math.ceil(this.pixelSize()),y=t.width,m=t.height,b=Math.ceil(y/v),x=Math.ceil(m/v),_=t.data;if(v<=0)p.error("pixelSize value can not be <= 0");else for(u=0;u<b;u+=1)for(f=0;f<x;f+=1){for(r=0,a=0,o=0,s=0,l=(h=u*v)+v,d=(c=f*v)+v,g=0,e=h;e<l;e+=1)if(!(e>=y))for(n=c;n<d;n+=1)n>=m||(r+=_[(i=4*(y*n+e))+0],a+=_[i+1],o+=_[i+2],s+=_[i+3],g+=1);for(r/=g,a/=g,o/=g,s/=g,e=h;e<l;e+=1)if(!(e>=y))for(n=c;n<d;n+=1)n>=m||(_[(i=4*(y*n+e))+0]=r,_[i+1]=a,_[i+2]=o,_[i+3]=s)}},Posterize:function(t){var e,n=Math.round(254*this.levels())+1,i=t.data,r=i.length,a=255/n;for(e=0;e<r;e+=1)i[e]=Math.floor(i[e]/a)*a},RGB:function(t){var e,n,i=t.data,r=i.length,a=this.red(),o=this.green(),s=this.blue();for(e=0;e<r;e+=4)n=(.34*i[e]+.5*i[e+1]+.16*i[e+2])/255,i[e]=n*a,i[e+1]=n*o,i[e+2]=n*s,i[e+3]=i[e+3]},RGBA:function(t){var e,n,i=t.data,r=i.length,a=this.red(),o=this.green(),s=this.blue(),h=this.alpha();for(e=0;e<r;e+=4)n=1-h,i[e]=a*h+i[e]*n,i[e+1]=o*h+i[e+1]*n,i[e+2]=s*h+i[e+2]*n},Sepia:function(t){var e,n,i,r,a=t.data,o=a.length;for(e=0;e<o;e+=4)n=a[e+0],i=a[e+1],r=a[e+2],a[e+0]=Math.min(255,.393*n+.769*i+.189*r),a[e+1]=Math.min(255,.349*n+.686*i+.168*r),a[e+2]=Math.min(255,.272*n+.534*i+.131*r)},Solarize:function(t){var e=t.data,n=t.width,i=4*n,r=t.height;do{var a=(r-1)*i,o=n;do{var s=a+4*(o-1),h=e[s],l=e[s+1],c=e[s+2];h>127&&(h=255-h),l>127&&(l=255-l),c>127&&(c=255-c),e[s]=h,e[s+1]=l,e[s+2]=c}while(--o)}while(--r)},Threshold:function(t){var e,n=255*this.threshold(),i=t.data,r=i.length;for(e=0;e<r;e+=1)i[e]=i[e]<n?0:255}}});function hn(t){return hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hn(t)}function ln(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function cn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ln(Object(n),!0).forEach((function(e){dn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ln(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function dn(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==hn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==hn(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===hn(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var un=[],fn=function(){return un},pn=function(){un.forEach((function(t){t.conva_line.destroy(),t.conva_text.destroy()})),un=[]};function gn(t){var e=["#6fd08c","#8bc76d","#a5bc53","#beae40","#d49f39","#e88d3f","#f67a4f","#ff6666"],n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:100)/e.length,i=Math.floor(t.connection.weight/n);t.conva_line.stroke(e[i])}function vn(t){var e=t.connection.node_a.conva_circle.radius(),n=t.connection.node_b.conva_circle.radius(),i=t.connection.node_a.conva_circle.x(),r=t.connection.node_a.conva_circle.y(),a=t.connection.node_b.conva_circle.x(),o=t.connection.node_b.conva_circle.y(),s=Math.sqrt(Math.pow(a-i,2)+Math.pow(o-r,2)),h=i+e/s*(a-i),l=r+e/s*(o-r),c=a+n/s*(i-a),d=o+n/s*(r-o),u=[h,l,c,d];t.conva_line.points(u);var f=(h+c)/2,p=(l+d)/2;t.conva_text.x(f),t.conva_text.y(p)}function yn(t){t.conva_line.strokeWidth(2),t.conva_line.moveToBottom(),t.conva_text.moveToBottom(),t.conva_text.text(t.connection.weight.toString()),vn(t),gn(t)}var mn=n(683),bn=document.getElementById("node-tooltip"),xn=bn.firstElementChild,_n=0,wn=0;function Sn(t){var e=bn.style.display;bn.style.display="block",_n=xn.clientWidth,wn=xn.clientHeight,bn.style.display=e,bn.style.display="fixed",xn.classList.add("fade-in"),bn.style.display="block"}function kn(){document.getElementById("node-tooltip").style.display="none",xn.classList.remove("fade-in")}function Cn(t){var e=t.conva_circle.absolutePosition(),n=t.conva_circle.getRelativePointerPosition(),i=window.innerWidth,r=window.innerHeight,a=e.x,o=e.y+wn;a+_n>i?e.x-=_n+2*t.conva_circle.radius()+5:e.x+=t.conva_circle.radius(),o>r?e.y-=wn-2*t.conva_circle.radius():e.y+=3*t.conva_circle.radius(),bn.style.left="".concat(e.x+n.x,"px"),bn.style.top="".concat(e.y+n.y,"px")}var Pn=document.getElementById("node-rightclick"),Tn=Pn.firstElementChild,An=0,Ln=0,En=(document.getElementById("open"),document.getElementById("shutdown")),On=document.getElementById("graceful-shutdown"),Mn=document.getElementById("reboot"),Dn=document.getElementById("graceful-reboot");function Gn(t){var e=Pn.style.display;Pn.style.display="block",An=Tn.clientWidth,Ln=Tn.clientHeight,Pn.style.display=e,Pn.style.display="fixed",Tn.classList.add("fade-in"),Pn.style.display="block",function(t){var e=t.conva_circle.absolutePosition(),n=t.conva_circle.getRelativePointerPosition(),i=window.innerWidth,r=window.innerHeight,a=e.x,o=e.y+Ln;a+An>i?e.x-=An+2*t.conva_circle.radius()+5:e.x+=t.conva_circle.radius();o>r?e.y-=Ln-2*t.conva_circle.radius():e.y+=3*t.conva_circle.radius();Pn.style.left="".concat(e.x+n.x,"px"),Pn.style.top="".concat(e.y+n.y,"px")}(t)}function Rn(){Pn.style.display="none",Tn.classList.remove("fade-in")}En.addEventListener("click",(function(){(0,mn.y6)((function(){}),(function(){}),"Are you sure you want to shutdown this server? This will cause all users to be disconnected.")})),On.addEventListener("click",(function(){(0,mn.y6)((function(){}),(function(){}),"Are you sure you want to shutdown this server? This will cause the server to stop accepting new connections, but will allow current connections to finish.")})),Mn.addEventListener("click",(function(){(0,mn.y6)((function(){}),(function(){}),"Are you sure you want to reboot this server? This will cause all users to be disconnected.")})),Dn.addEventListener("click",(function(){(0,mn.y6)((function(){}),(function(){}),"Are you sure you want to reboot this server? This will cause the server to stop accepting new connections, but will allow current connections to finish.")}));var In=n(78),Nn=n(888),Fn=!0;function jn(t,e){var n,i,r,a,o,s;Ci().forEach((function(e){t.nodes.find((function(t){return t.node_id===e.node.node_id}))||(Pi(e.node.node_id),!1===Fn&&(0,mn.Xj)("info","Node Removed","Node ".concat(e.node.node_id," has been removed from the network")))})),n=t.nodes.filter((function(t){return"Ingress"===t.node_type})).length,i=t.nodes.filter((function(t){return"Relay"===t.node_type})).length,r=t.nodes.filter((function(t){return"Edge"===t.node_type})).length,Ci().forEach((function(t){var e,a,o;switch(t.node.node_type){case"Ingress":if((null===(e=t.node)||void 0===e?void 0:e.z)>n)return n=t.node.z;break;case"Relay":if((null===(a=t.node)||void 0===a?void 0:a.z)>i)return i=t.node.z;break;case"Edge":if((null===(o=t.node)||void 0===o?void 0:o.z)>r)return r=t.node.z}})),a=n,o=i,s=r;var h=function(t,e,n){var i=Math.max(t,e,n),r=i*xi,a=3*bi+_i,o=Ri.width()/2-a/2,s=Ri.height()/2-r/5;return{x:o,y:s}}(n,i,r),l=h.x,c=h.y;t.nodes.forEach((function(t){switch(t.node_type){case"Ingress":t.z=--a;break;case"Relay":t.z=--o;break;case"Edge":t.z=--s}var n=e.find((function(e){return e.id===t.node_name}))||void 0,h=function(t,e,n,i,r){var a,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:150,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:200,h=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return yi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yi(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(ki);try{for(c.s();!(a=c.n()).done;){var d=a.value,u=d;if(u.node.node_id===t.node_id)return u.node.node_type=t.node_type,u.node.node_latency=t.node_latency,u.node.node_usage=t.node_usage,Ti(u.node,e,n,o,s),Ai(d.conva_text,d.conva_circle),u.focused&&wi(u),u}}catch(t){c.e(t)}finally{c.f()}var f=new sn.Circle({radius:20,fill:"transparent",stroke:"black",strokeWidth:3,draggable:!0}),p=new sn.Text({text:t.node_id.toString(),fontSize:20,fontFamily:"Calibri",fill:"white"});r.add(f),i.add(p);var g=Ti(t,e,n,o,s);f.x(g.x),f.y(g.y),f.stroke(g.color),Ai(p,f);var v=gi(gi({},t),g),y={node:v,conva_circle:f,conva_text:p,focused:!1},m=!1,b=!1,x=!1;f.on("mouseover",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(m=!0,b){t.next=4;break}return t.next=4,(0,mn._v)(500);case 4:if(m){t.next=6;break}return t.abrupt("return");case 6:if(!x){t.next=8;break}return t.abrupt("return");case 8:b=!0,Sn(y),Cn(y);case 11:case"end":return t.stop()}}),t)})))),f.on("mousemove",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Cn(y));case 1:case"end":return t.stop()}}),t)})))),f.on("dragmove",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f.moveToTop(),p.moveToTop(),kn(),Rn();case 4:case"end":return t.stop()}}),t)})))),f.on("mouseout",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:kn(),m=!1,b=!1;case 3:case"end":return t.stop()}}),t)})))),f.on("dragend",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(b){t.next=3;break}return t.next=3,(0,mn._v)(500);case 3:if(m){t.next=5;break}return t.abrupt("return");case 5:Sn(y),Cn(y);case 7:case"end":return t.stop()}}),t)})))),f.on("contextmenu",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:kn(),Gn(y),x=!0;case 3:case"end":return t.stop()}}),t)})))),f.on("click",function(){var t=fi(di().mark((function t(e){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(2!==e.evt.button){t.next=2;break}return t.abrupt("return");case 2:x=!1,y.focused=!0,kn(),Rn();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),f.on("dblclick",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==l){t.next=2;break}return t.abrupt("return");case 2:hi(l,y);case 3:case"end":return t.stop()}}),t)}))));var _=!1;f.on("touchstart",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return _=!0,t.next=3,(0,mn._v)(1500);case 3:if(null!==l){t.next=5;break}return t.abrupt("return");case 5:hi(l,y);case 6:case"end":return t.stop()}}),t)})))),f.on("touchend",fi(di().mark((function t(){return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:_&&wi(y),_=!1;case 2:case"end":return t.stop()}}),t)})))),!1===h&&(0,mn.Xj)("success","Node Added","Node ".concat(t.node_id," has been added to the network."));return function(t){t.conva_circle.on("dragmove",(function(e){t.node.x=e.target.x(),t.node.y=e.target.y(),Ai(t.conva_text,t.conva_circle);var n=t.focused;Ci().forEach((function(t){return Si(t)})),n&&wi(t)})),t.conva_circle.on("click",(function(e){2!==e.evt.button&&(Ci().forEach((function(t){return Si(t)})),t.focused?Si(t):wi(t))}))}(y),ki.push(y),y}(t,r,i,ji,Ni,l,c,Fn,n);n&&(h.conva_text.text(n.slug),Ai(h.conva_text,h.conva_circle))}));var d=Ci();pn(),t.connections.forEach((function(t){var e=d.find((function(e){return e.node.node_id===t.node_a_id})),n=d.find((function(e){return e.node.node_id===t.node_b_id}));e&&n&&function(t,e,n,i,r){var a=new sn.Line({stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"}),o=new sn.Text({text:t.weight.toString(),fontSize:23,fontFamily:"Calibri",fill:"white"});r.add(o),i.add(a);var s={connection:cn(cn({},t),{},{node_a:e,node_b:n,weight:t.weight}),conva_line:a,conva_text:o};gn(s),vn(s),un.push(s)}(t,e,n,Fi,ji)})),d.forEach((function(t){t.focused&&wi(t)})),Fn=!1}function zn(t){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zn(t)}function Bn(){Bn=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof u?e:u,o=Object.create(a.prototype),s=new C(r||[]);return i(o,"_invoke",{value:_(t,n,s)}),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function f(){}function p(){}var g={};h(g,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(P([])));y&&y!==e&&n.call(y,a)&&(g=y);var m=p.prototype=u.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,a,o,s){var h=c(t[i],t,a);if("throw"!==h.type){var l=h.arg,d=l.value;return d&&"object"==zn(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,s)}),(function(t){r("throw",t,o,s)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,s)}))}s(h.arg)}var a;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return a=a?a.then(i,i):i()}})}function _(t,e,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return T()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var h=c(t,e,n);if("normal"===h.type){if(i=n.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i="completed",n.method="throw",n.arg=h.arg)}}}function w(t,e){var n=e.method,i=t.iterator[n];if(void 0===i)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=c(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,i(m,"constructor",{value:p,configurable:!0}),i(p,"constructor",{value:f,configurable:!0}),f.displayName=h(p,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,h(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(x.prototype),h(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new x(l(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(m),h(m,s,"Generator"),h(m,a,(function(){return this})),h(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=P,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return o.type="throw",o.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(s&&h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function Hn(t,e,n,i,r,a,o){try{var s=t[a](o),h=s.value}catch(t){return void n(t)}s.done?e(h):Promise.resolve(h).then(i,r)}function Wn(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){Hn(a,i,r,o,s,"next",t)}function s(t){Hn(a,i,r,o,s,"throw",t)}o(void 0)}))}}var Yn=function(){var t=Wn(Bn().mark((function t(){return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,Nn.AO)("GET",Gi.srr_tree_url,Gi.csrf_token,{}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Xn=function(){var t=Wn(Bn().mark((function t(e){return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,Nn.AO)("GET",Gi.proxy_request_url,{},{"p-headers":'{ "NodeSecret": "'+e.secret+'" }',"p-url":e.http_url+"/statistics/server"}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),qn=function(){var t=Wn(Bn().mark((function t(e){var n;return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=function(){var t=Wn(Bn().mark((function t(){var e,n;return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Yn();case 2:if(200===(e=t.sent).code){t.next=5;break}return t.abrupt("return",(0,mn.Xj)("error","Oops! There appears to be an issue",e.message,5e3));case 5:jn((n=e).data.tree,n.data.servers),console.log("Updated tree");case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),t.next=3,n();case 3:setInterval(Wn(Bn().mark((function t(){return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n();case 2:case"end":return t.stop()}}),t)}))),e);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function Vn(){Vn=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof u?e:u,o=Object.create(a.prototype),s=new C(r||[]);return i(o,"_invoke",{value:_(t,n,s)}),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function f(){}function p(){}var g={};h(g,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(P([])));y&&y!==e&&n.call(y,a)&&(g=y);var m=p.prototype=u.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,a,o,s){var h=c(t[i],t,a);if("throw"!==h.type){var l=h.arg,d=l.value;return d&&"object"==Un(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,s)}),(function(t){r("throw",t,o,s)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,s)}))}s(h.arg)}var a;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return a=a?a.then(i,i):i()}})}function _(t,e,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return T()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var h=c(t,e,n);if("normal"===h.type){if(i=n.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i="completed",n.method="throw",n.arg=h.arg)}}}function w(t,e){var n=e.method,i=t.iterator[n];if(void 0===i)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=c(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,i(m,"constructor",{value:p,configurable:!0}),i(p,"constructor",{value:f,configurable:!0}),f.displayName=h(p,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,h(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(x.prototype),h(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new x(l(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(m),h(m,s,"Generator"),h(m,a,(function(){return this})),h(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=P,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return o.type="throw",o.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(s&&h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function Kn(t,e,n,i,r,a,o){try{var s=t[a](o),h=s.value}catch(t){return void n(t)}s.done?e(h):Promise.resolve(h).then(i,r)}function Jn(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){Kn(a,i,r,o,s,"next",t)}function s(t){Kn(a,i,r,o,s,"throw",t)}o(void 0)}))}}var Qn=document.querySelector("#node-panel");if(!Qn)throw(0,mn.Xj)("error","Fatal Error","Could not find the side panel"),new Error("Could not find the side panel");Qn.querySelector("#close").addEventListener("click",(function(){ai=null,$n.innerHTML="",Zn.innerHTML="",ti.innerHTML="",ei.innerHTML="",ni.innerHTML="",ii.innerHTML="",Qn.classList.remove("visable"),Qn.classList.add("hidden")}));var $n=Qn.querySelector("#node-name"),Zn=Qn.querySelector("#node-type"),ti=Qn.querySelector("#node-id"),ei=Qn.querySelector("#node-router-id"),ni=Qn.querySelector("#node-rtmp"),ii=Qn.querySelector("#node-http"),ri=(Qn.querySelector("#node-graphs-tabs"),Qn.querySelector("#node-graphs-tabs-content"),Qn.querySelector("#node-io")),ai=(Qn.querySelector("#node-logs"),null),oi=!0,si=null;function hi(t,e){ai=t,$n.innerHTML=t.slug,Zn.innerHTML=e.node.node_type,ti.innerHTML=t.id,ei.innerHTML=e.node.node_id.toString(),ni.innerHTML=t.rtmp_url,ii.innerHTML=t.http_url,Qn.classList.remove("hidden"),Qn.classList.add("visable"),oi&&(oi=!1,si=new In.Chart(ri,{title:"Node Server Metrics",type:"axis-mixed",colors:["#E3C567","#FF6666","#6FD08C","#39A9DB"],data:{datasets:[{name:"CPU%",type:"line",values:[]},{name:"RAM%",type:"line",values:[]},{name:"NET RX (Mbps)",type:"line",values:[]},{name:"NET TX (Mbps)",type:"line",values:[]}]}}),function(){li.apply(this,arguments)}())}function li(){return(li=Jn(Vn().mark((function t(){return Vn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:setInterval(Jn(Vn().mark((function t(){var e,n;return Vn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Xn(ai);case 4:if(200===(e=t.sent).code){t.next=7;break}return t.abrupt("return",(0,mn.Xj)("error","Oops! There appears to be an issue",e.message,5e3));case 7:n=e,si.update(n.data);case 9:case"end":return t.stop()}}),t)}))),2e3);case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ci(t){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ci(t)}function di(){di=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof u?e:u,o=Object.create(a.prototype),s=new C(r||[]);return i(o,"_invoke",{value:_(t,n,s)}),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function f(){}function p(){}var g={};h(g,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(P([])));y&&y!==e&&n.call(y,a)&&(g=y);var m=p.prototype=u.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,a,o,s){var h=c(t[i],t,a);if("throw"!==h.type){var l=h.arg,d=l.value;return d&&"object"==ci(d)&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,o,s)}),(function(t){r("throw",t,o,s)})):e.resolve(d).then((function(t){l.value=t,o(l)}),(function(t){return r("throw",t,o,s)}))}s(h.arg)}var a;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){r(t,n,e,i)}))}return a=a?a.then(i,i):i()}})}function _(t,e,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return T()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var h=c(t,e,n);if("normal"===h.type){if(i=n.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i="completed",n.method="throw",n.arg=h.arg)}}}function w(t,e){var n=e.method,i=t.iterator[n];if(void 0===i)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var r=c(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function P(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,i(m,"constructor",{value:p,configurable:!0}),i(p,"constructor",{value:f,configurable:!0}),f.displayName=h(p,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,h(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(x.prototype),h(x.prototype,o,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,i,r,a){void 0===a&&(a=Promise);var o=new x(l(e,n,i,r),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(m),h(m,s,"Generator"),h(m,a,(function(){return this})),h(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=P,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return o.type="throw",o.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(s&&h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;k(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function ui(t,e,n,i,r,a,o){try{var s=t[a](o),h=s.value}catch(t){return void n(t)}s.done?e(h):Promise.resolve(h).then(i,r)}function fi(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){ui(a,i,r,o,s,"next",t)}function s(t){ui(a,i,r,o,s,"throw",t)}o(void 0)}))}}function pi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function gi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?pi(Object(n),!0).forEach((function(e){vi(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function vi(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==ci(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==ci(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ci(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function mi(t){return t*(Math.PI/180)}var bi=200,xi=200,_i=25;function wi(t){t.focused=!0,t.conva_circle.fill(t.conva_circle.stroke()),fn().forEach((function(e){e.connection.node_a.node.node_id===t.node.node_id||e.connection.node_b.node.node_id===t.node.node_id?function(t){t.conva_line.strokeWidth(3),t.conva_line.moveToTop(),t.conva_text.moveToTop(),t.conva_text.text(t.connection.weight.toString()),vn(t),gn(t)}(e):function(t){t.conva_line.strokeWidth(2),t.conva_line.moveToBottom(),t.conva_text.moveToBottom(),t.conva_line.stroke("black"),t.conva_text.text(""),vn(t)}(e)}))}function Si(t){t.focused=!1,t.conva_circle.fill("transparent"),fn().forEach((function(t){yn(t)}))}var ki=[],Ci=function(){return ki},Pi=function(t){ki.filter((function(e){return e.node.node_id===t})).forEach((function(t){t.conva_circle.destroy(),t.conva_text.destroy()})),ki=ki.filter((function(e){return e.node.node_id!==t}))};function Ti(t,e,n,i,r){var a=50*e,o=25*e;switch(t.node_type){case"Ingress":return{z:t.z,x:0+i,y:r+t.z*xi,color:Ii.ingress};case"Relay":return{z:t.z,x:bi+i+t.z%2*_i,y:r+t.z/2*xi*1.5-xi/n,color:Ii.relay};case"Edge":var s=mi(180/(e-1)*t.z),h=Math.cos(s+mi(-90))*o,l=Math.sin(s+mi(-90))*a;return{z:t.z,x:h+i+2*bi+_i,y:l+r+xi/2,color:Ii.edge}}}function Ai(t,e){var n=e.x(),i=e.y(),r=n-t.width()/2,a=i-t.height()/2;t.x(r),t.y(a)}var Li=.1,Ei=2,Oi=.2;var Mi=document.getElementById("config");function Di(t,e){var n=t.getAttribute(e);return n||((0,mn.Xj)("error","Configuration Error","No '".concat(e,"' found, please reload the page")),setTimeout((function(){return window.location.reload()}),3e3)),n}var Gi={csrf_token:Di(Mi,"data-csrf-token"),srr_tree_url:Di(Mi,"data-get-ssr-tree"),proxy_request_url:Di(Mi,"data-proxy-request")};qn(5e3);var Ri=new sn.Stage({container:"app",width:window.innerWidth,height:window.innerHeight}),Ii={ingress:"#6FD08C",relay:"#39A9DB",edge:"#FF6666"},Ni=new sn.Layer,Fi=new sn.Layer,ji=new sn.Layer;Ri.add(Ni),Ri.add(Fi),Ri.add(ji),Fi.zIndex(0),Ni.zIndex(1),ji.zIndex(2),function(t){var e=document.getElementById("zoom-in"),n=document.getElementById("zoom-out"),i=document.getElementById("zoom-level");e.addEventListener("click",(function(){if(!(t.scaleX()>=Ei)){var e=t.scaleX()+Li;t.scale({x:e,y:e}),i.value="".concat(Math.trunc(100*e),"%"),Rn()}})),n.addEventListener("click",(function(){if(!(t.scaleX()<=Oi)){var e=t.scaleX()-Li;t.scale({x:e,y:e}),i.value="".concat(Math.trunc(100*e),"%"),Rn()}}));var r=100;i.addEventListener("input",(function(){(r=parseInt(i.value)||100*Oi)>100*Ei&&(r=100*Ei),r<100*Oi&&(r=100*Oi);var e=r/100;t.scale({x:e,y:e})})),i.addEventListener("blur",(function(){i.value="".concat(r,"%"),Rn()})),t.on("wheel",(function(e){e.evt.preventDefault();var n=t.scaleX(),r=t.getPointerPosition().x/n-t.x()/n,a=t.getPointerPosition().y/n-t.y()/n,o=e.evt.deltaY>0?.9*n:n/.9;if(o<Oi)return t.scale({x:Oi,y:Oi}),t.batchDraw(),i.value="".concat(Math.trunc(100*Oi),"%"),void Rn();if(o>Ei)return t.scale({x:Ei,y:Ei}),t.batchDraw(),i.value="".concat(Math.trunc(100*Ei),"%"),void Rn();i.value="".concat(Math.trunc(100*o),"%"),t.scale({x:o,y:o});var s=-(r-t.getPointerPosition().x/o)*o,h=-(a-t.getPointerPosition().y/o)*o;t.position({x:s,y:h}),t.batchDraw(),Rn()}))}(Ri),function(t){var e=!1,n=document.getElementById("ui"),i=document.getElementById("zoom-level"),r=function(t){1===t.target._id&&(e=!0,document.body.style.cursor="grabbing",n.classList.add("no-pointer-events"))};t.on("mousedown",(function(t){return r(t)})),t.on("touchstart",(function(t){return r(t)}));var a=function(){e=!1,document.body.style.cursor="default",n.classList.remove("no-pointer-events")};t.on("mouseup",a),t.on("touchend",a),t.on("mousemove",(function(n){e&&(t.position({x:t.x()+n.evt.movementX,y:t.y()+n.evt.movementY}),t.batchDraw())}));var o=null,s=null,h=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}};t.on("touchmove",(function(e){e.evt.preventDefault();var n=e.evt.touches[0],r=e.evt.touches[1];if(n&&r){t.isDragging()&&t.stopDrag();var a={x:n.clientX,y:n.clientY},l={x:r.clientX,y:r.clientY};if(!o)return void(o=h(a,l));var c=h(a,l),d=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}(a,l);if(!s)return void(s=d);var u={x:(c.x-t.x())/t.scaleX(),y:(c.y-t.y())/t.scaleY()},f=t.scaleX()*(d/s);f<Oi&&(f=Oi),f>Ei&&(f=Ei),i.value="".concat(Math.trunc(100*f),"%"),t.scale({x:f,y:f});var p=c.x-o.x,g=c.y-o.y;t.position({x:c.x-u.x*f+p,y:c.y-u.y*f+g}),t.batchDraw(),o=c,s=d}else if(n){if(1!==e.target._id)return;if(t.isDragging())return;t.startDrag();var v={x:n.clientX,y:n.clientY};if(!o)return void(o=v);var y=v,m=y.x-o.x,b=y.y-o.y;t.position({x:t.x()+m,y:t.y()+b}),t.batchDraw(),o=y}})),t.on("touchend",(function(t){o=null,s=0}));var l=document.getElementById("x-coord"),c=document.getElementById("y-coord"),d=!1,u=!1;l.addEventListener("focus",(function(){d=!0})),l.addEventListener("blur",(function(){d=!1,l.value="".concat(t.x().toFixed(2),"x")})),c.addEventListener("focus",(function(){u=!0})),c.addEventListener("blur",(function(){u=!1,c.value="".concat(t.y().toFixed(2),"y")})),l.addEventListener("input",(function(){t.x(parseInt(l.value)||0),t.batchDraw()})),c.addEventListener("input",(function(){t.y(parseInt(c.value)||0),t.batchDraw()})),t.on("xChange",(function(){d||(l.value="".concat(t.x().toFixed(2),"x"),Rn())})),t.on("yChange",(function(){u||(c.value="".concat(t.y().toFixed(2),"y"),Rn())}))}(Ri),function(t,e){var n=document.getElementById(e),i=function(){t.width(n.clientWidth),t.height(n.clientHeight),t.batchDraw()};window.addEventListener("resize",i),i()}(Ri,"app"),Fi.listening(!1),ji.listening(!1),function(t){t.on("click",(function(t){1===t.target._id&&(fn().forEach((function(t){yn(t)})),Ci().forEach((function(t){Si(t)})),Rn())}))}(Ri)})()})();